<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÏÜåÎ¶¨ ÏÑ±Ï∞∞Ïã§ (MelodyMind)</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Three.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    
    <!-- WordCloud2.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/wordcloud2.js/1.2.2/wordcloud2.min.js"></script>
    
    <!-- Leaflet (ÏßÄÎèÑ) -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
        }
        .prose {
            max-width: 65ch;
            line-height: 1.75;
        }
    </style>
</head>
<body class="bg-gray-100">
    <div id="app"></div>

    <script>
        // =========================
        // Global State Management
        // =========================
        const state = {
            page: 0,
            loading: false,
            userId: "Guest",
            studentId: '',
            studentName: '',
            db: null,
            appData: {
                url: '', title: '', composer: '', artist: '',
                ensembleType1: '', ensembleType2: '', musicGenre: '', lyrics: '', experienceLevel: 'Ï¥àÏã¨',
                senseKeywords: [], senseText: '', senseColors: [], senseImage: null,
                senseExpressionType: [], senseExpressionText: '',
                senseExpressionMovement: null, // Ïπ¥Î©îÎùºÎ°ú Ï∫°Ï≤òÌïú Ïù¥ÎØ∏ÏßÄ (base64)
                senseExpressionSpace: null, // ÏßÄÎèÑÏóêÏÑú ÏÑ†ÌÉùÌïú ÏúÑÏπò { lat, lng, address }
                senseExpressionPattern: null, // ÎèÑÌòï Í∑∏Î¶¨Í∏∞ Ï∫îÎ≤ÑÏä§ Îç∞Ïù¥ÌÑ∞ (base64)
                senseExpressionNature: [], // ÏÑ†ÌÉùÌïú ÏûêÏó∞ ÌòÑÏÉÅ ÏÇ¨ÏßÑÎì§
                techSound: '', techRhythm: '', analysisHarmony: '', analysisForm: '',
                interpIntent: '', interpScene: '', evalArt: '', evalApply: '',
                feedback: {
                    senseScore: 50, techScore: 50, analysisScore: 50, consistencyScore: 50, aestheticScore: 50,
                    goodPoints: '', badPoints: '', structuredQuestion: '',
                    draftAppreciation: '', modelAppreciation: ''
                },
                finalAppreciation: '',
                scores: [50, 50, 50, 50, 50],
                colors: ['#3B82F6', '#1E40AF', '#6366F1'],
                strategy: { performance: '', appreciation: '', composition: '' }
            },
            feedbackInput: '',
            showErrorModal: false,
            errorMessage: '',
            visualizationScene: null,
            comparisonPageInitialized: false // ÎπÑÍµê ÌéòÏù¥ÏßÄ Ï¥àÍ∏∞Ìôî Ïó¨Î∂Ä
        };

        // =========================
        // Color Palette
        // =========================
        const COLOR_PALETTE = [
            { value: '#3B82F6', name: 'ÌååÎûë', description: 'ÌèâÌôî, Í≥†Ïöî' },
            { value: '#EF4444', name: 'Îπ®Í∞ï', description: 'Í∏¥Ïû•, Ïó≠Îèô' },
            { value: '#10B981', name: 'Ï¥àÎ°ù', description: 'ÏïàÏ†ï, ÏûêÏó∞' },
            { value: '#F59E0B', name: 'ÎÖ∏Îûë', description: 'Í∏∞ÏÅ®, Î∞ùÏùå' },
            { value: '#8B5CF6', name: 'Î≥¥Îùº', description: 'Ïã†ÎπÑ, Î™ΩÌôò' },
            { value: '#EC4899', name: 'ÌïëÌÅ¨', description: 'Î∂ÄÎìúÎü¨ÏõÄ, Îî∞ÎúªÌï®' },
            { value: '#F97316', name: 'Ï£ºÌô©', description: 'Ïó¥Ï†ï, ÌôúÍ∏∞' },
            { value: '#06B6D4', name: 'Ï≤≠Î°ù', description: 'ÏãúÏõêÌï®, ÎßëÏùå' },
            { value: '#4B5563', name: 'ÌöåÏÉâ', description: 'Ïì∏Ïì∏Ìï®, Ïñ¥ÎëêÏõÄ' },
            { value: '#7C3AED', name: 'ÏûêÏ£º', description: 'Ïö∞ÏïÑÌï®, Í≥†ÏÉÅÌï®' },
            { value: '#0EA5E9', name: 'ÌïòÎäò', description: 'ÏûêÏú†, Ìù¨Îßù' },
            { value: '#F43F5E', name: 'Î°úÏ¶à', description: 'Îî∞ÎúªÌï®, Ïï†Ï†ï' }
        ];

        // =========================
        // Icon Component (SVG)
        // =========================
        const icons = {
            Music: (size = 20) => `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 18V5l12-2v13"/><circle cx="6" cy="18" r="3"/><circle cx="18" cy="16" r="3"/></svg>`,
            Feather: (size = 20) => `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.24 12.24a6 6 0 0 0-8.49-8.49L5.26 10.74 3 13V19l6 2 3-3"/><path d="M14.49 5.51 16.2 3.8a2 2 0 0 1 2.83 2.83l-1.71 1.71"/><path d="m9 11 8.5-8.5"/><path d="m11 9 8.5-8.5"/><path d="M12 18H7"/><path d="M15 21v-3"/></svg>`,
            Eye: (size = 20) => `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/><circle cx="12" cy="12" r="3"/></svg>`,
            Gauge: (size = 20) => `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m12 14 4-4"/><path d="M3.34 19A8 8 0 1 1 12 20"/><path d="M18.83 14.66L17.2 13"/><path d="M13 13h6"/></svg>`,
            Lightbulb: (size = 20) => `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 14c.2-1.1.7-2.2 1.4-3.1 2-2.5 2.5-4.7 1.5-6.7-1-2-2.8-3.2-5.4-3.2h-.6C9.6 1 8 2.2 7 4.2c-1 2-.5 4.2 1.5 6.7.7.9 1.2 2 1.4 3.1"/><path d="M9 18h6"/><path d="M10 22h4"/></svg>`,
            BarChart: (size = 20) => `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" x2="12" y1="20" y2="10"/><line x1="18" x2="18" y1="20" y2="4"/><line x1="6" x2="6" y1="20" y2="16"/></svg>`,
            MessageCircle: (size = 20) => `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m3 21 1.9-5.7a8.5 8.5 0 1 1 3.8 3.8z"/><circle cx="12" cy="12" r="4"/></svg>`,
            X: (size = 20) => `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>`
        };

        // =========================
        // Backend API Functions (.env ÏÇ¨Ïö©)
        // =========================
        // Í∞úÎ∞ú ÌôòÍ≤Ω: Express ÏÑúÎ≤Ñ ÏßÅÏ†ë Ïó∞Í≤∞, ÌîÑÎ°úÎçïÏÖò: ÌòÑÏû¨ ÏÑúÎ≤Ñ Ï£ºÏÜå ÏÇ¨Ïö©
        const API_BASE_URL = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'
            ? 'http://localhost:3000'
            : window.location.origin;

        async function analyzeWithGPT(systemInstruction, userPrompt, jsonOutput = false) {
            try {
                // Ïú†ÌäúÎ∏å ÎßÅÌÅ¨ Ï∂îÏ∂ú
                const youtubeUrl = state.appData.url || null;
                
                const response = await fetch(`${API_BASE_URL}/api/analyze`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        systemInstruction,
                        userPrompt,
                        jsonOutput,
                        youtubeUrl
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    const errorMessage = errorData.details || errorData.error || `HTTP error! status: ${response.status}`;
                    throw new Error(errorMessage);
                }

                const data = await response.json();
                return data.result || "AI Î∂ÑÏÑùÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§.";
            } catch (error) {
                console.error("API Error:", error);
                const errorMessage = error.message || 'Ïïå Ïàò ÏóÜÎäî Ïò§Î•ò';
                throw new Error(`AI Î∂ÑÏÑù Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ${errorMessage}`);
            }
        }

        // Google Forms Îç∞Ïù¥ÌÑ∞ Ï†ÑÏÜ° Ìï®Ïàò
        async function sendToGoogleForms(formData) {
            try {
                const response = await fetch(`${API_BASE_URL}/api/google-forms`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(formData)
                });

                const result = await response.json();
                return result;
            } catch (error) {
                console.error("Google Forms Error:", error);
                return { success: false, error: error.message };
            }
        }

        // Page 5ÏóêÏÑú ÏôÑÎ£å Î≤ÑÌäº ÌÅ¥Î¶≠ Ïãú Google FormsÎ°ú Îç∞Ïù¥ÌÑ∞ Ï†ÑÏÜ°
        async function submitToGoogleForms() {
            state.loading = true;
            render();

            try {
                const googleFormsData = {
                    userId: state.userId,
                    studentId: state.studentId,
                    studentName: state.studentName,
                    timestamp: new Date().toISOString(),
                    // ÏïÖÍ≥° Ï†ïÎ≥¥
                    title: state.appData.title,
                    url: state.appData.url,
                    artist: state.appData.artist,
                    composer: state.appData.composer,
                    musicGenre: state.appData.musicGenre,
                    ensembleType1: state.appData.ensembleType1,
                    // Í∞êÏÉÅ Îç∞Ïù¥ÌÑ∞
                    senseKeywords: state.appData.senseKeywords.join(', '),
                    senseText: state.appData.senseText,
                    senseColors: state.appData.senseColors.length > 0 
                        ? state.appData.senseColors.map(c => {
                            const color = COLOR_PALETTE.find(p => p.value === c);
                            return color ? `${color.name}(${color.description})` : c;
                        }).join(', ')
                        : '',
                    senseExpressionType: state.appData.senseExpressionType.join(', '),
                    senseExpressionText: state.appData.senseExpressionText,
                    senseExpressionMovement: state.appData.senseExpressionMovement ? 'Ïù¥ÎØ∏ÏßÄ Ï∫°Ï≤òÎê®' : '',
                    senseExpressionSpace: state.appData.senseExpressionSpace ? JSON.stringify(state.appData.senseExpressionSpace) : '',
                    senseExpressionPattern: state.appData.senseExpressionPattern ? 'Í∑∏Î¶º ÏÉùÏÑ±Îê®' : '',
                    senseExpressionNature: state.appData.senseExpressionNature.join(', '),
                    techSound: state.appData.techSound,
                    techRhythm: state.appData.techRhythm,
                    analysisHarmony: state.appData.analysisHarmony,
                    analysisForm: state.appData.analysisForm,
                    interpIntent: state.appData.interpIntent,
                    interpScene: state.appData.interpScene,
                    evalArt: state.appData.evalArt,
                    evalApply: state.appData.evalApply,
                    // AI Î∂ÑÏÑù Í≤∞Í≥º
                    senseScore: state.appData.scores[0],
                    techScore: state.appData.scores[1],
                    analysisScore: state.appData.scores[2],
                    consistencyScore: state.appData.scores[3],
                    aestheticScore: state.appData.scores[4],
                    goodPoints: state.appData.feedback.goodPoints,
                    badPoints: state.appData.feedback.badPoints,
                    structuredQuestion: state.appData.feedback.structuredQuestion,
                    draftAppreciation: state.appData.feedback.draftAppreciation,
                    modelAppreciation: state.appData.feedback.modelAppreciation,
                    feedbackInput: state.feedbackInput,
                    // ÏµúÏ¢Ö Í≤∞Í≥º
                    finalAppreciation: state.appData.finalAppreciation,
                    performanceStrategy: state.appData.strategy.performance,
                    appreciationStrategy: state.appData.strategy.appreciation,
                    compositionStrategy: state.appData.strategy.composition
                };

                const result = await sendToGoogleForms(googleFormsData);
                
                if (result.success) {
                    showModal("Í∞êÏÉÅÎ¨∏Ïù¥ ÏÑ±Í≥µÏ†ÅÏúºÎ°ú Ï†úÏ∂úÎêòÏóàÏäµÎãàÎã§! üéâ\n\nGoogle FormsÏóê ÏùëÎãµÏù¥ Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§.");
                } else {
                    showModal(`Google Forms Ï†ÑÏÜ° Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.\n\n${result.error || 'Ïïå Ïàò ÏóÜÎäî Ïò§Î•ò'}`);
                }
            } catch (error) {
                console.error("Google Forms Ï†ÑÏÜ° Ïò§Î•ò:", error);
                showModal("Google Forms Ï†ÑÏÜ° Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§. Ïû†Ïãú ÌõÑ Îã§Ïãú ÏãúÎèÑÌï¥Ï£ºÏÑ∏Ïöî.");
            } finally {
                state.loading = false;
                render();
            }
        }

        function getAppreciationDataForAI() {
            const d = state.appData;
            const natureImages = [
                { id: 'storm', name: 'Ìè≠Ìíç', emoji: '‚õàÔ∏è' },
                { id: 'lightning', name: 'Î≤àÍ∞ú', emoji: '‚ö°' },
                { id: 'rain', name: 'ÎπÑ', emoji: 'üåßÔ∏è' },
                { id: 'snow', name: 'Îàà', emoji: '‚ùÑÔ∏è' },
                { id: 'wind', name: 'Î∞îÎûå', emoji: 'üí®' },
                { id: 'wave', name: 'ÌååÎèÑ', emoji: 'üåä' },
                { id: 'fire', name: 'Î∂à', emoji: 'üî•' },
                { id: 'cloud', name: 'Íµ¨Î¶Ñ', emoji: '‚òÅÔ∏è' },
                { id: 'sunset', name: 'ÏùºÎ™∞', emoji: 'üåÖ' },
                { id: 'moon', name: 'Îã¨', emoji: 'üåô' },
                { id: 'star', name: 'Î≥Ñ', emoji: '‚≠ê' },
                { id: 'ocean', name: 'Î∞îÎã§', emoji: 'üåä' }
            ];
            
            return `
--- ÌïôÏÉùÏù¥ ÏûÖÎ†•Ìïú ÏïÖÍ≥° Ï†ïÎ≥¥ ---
ÏïÖÍ≥° Ï†úÎ™©: ${d.title || 'ÎØ∏ÏûÖÎ†•'}
ÏûëÍ≥°Í∞Ä: ${d.composer || 'ÎØ∏ÏûÖÎ†•'}
Ïó∞Ï£ºÏûê/Í∞ÄÏàò: ${d.artist || 'ÎØ∏ÏûÖÎ†•'}
ÏùåÏïÖ Ïû•Î•¥: ${d.musicGenre || 'ÎØ∏ÏûÖÎ†•'}
Ïú†ÌäúÎ∏å ÎßÅÌÅ¨: ${d.url || 'ÎØ∏ÏûÖÎ†•'}
Í≤ΩÌóò ÏàòÏ§Ä: ${d.experienceLevel}, Ïó∞Ï£º ÌòïÌÉú: ${d.ensembleType1} - ${d.ensembleType2}

--- 1Îã®Í≥Ñ: Î∞òÏùë (Í∞êÍ∞ÅÏ†Å Í∞êÏÉÅ) ---
ÌïµÏã¨ ÌÇ§ÏõåÎìú: ${d.senseKeywords.join(', ') || 'ÏóÜÏùå'}
ÏûêÏú† ÏÑúÏà†: ${d.senseText || 'ÏóÜÏùå'}
ÏÑ†ÌÉù ÏÉâÏÉÅ: ${d.senseColors.length > 0 ? d.senseColors.map(c => {
    const color = COLOR_PALETTE.find(p => p.value === c);
    return color ? `${color.name}(${color.description})` : c;
}).join(', ') : 'ÏóÜÏùå'}

--- 1Îã®Í≥Ñ: Îã§Î•∏ Î∞©ÏãùÏúºÎ°ú ÌëúÌòÑÌïòÍ∏∞ (Îã§ÍµêÍ≥º ÏúµÌï© ÌëúÌòÑ) ---
${d.senseExpressionType.length > 0 ? d.senseExpressionType.map(t => {
    const typeNames = {
        'poetry': 'üìù ÏãúÏ†Å ÌëúÌòÑ/Î¨∏Íµ¨ (Íµ≠Ïñ¥)',
        'movement': 'üíÉ ÏõÄÏßÅÏûÑ/ÎèôÏûë (Ï≤¥Ïú°/Î¨¥Ïö©)',
        'nature': '‚ö° ÏûêÏó∞ ÌòÑÏÉÅ (Í≥ºÌïô)',
        'space': 'üèûÔ∏è Í≥µÍ∞Ñ/Ïû•ÏÜå (ÏÇ¨Ìöå/ÏßÄÎ¶¨)',
        'pattern': 'üî∑ ÎèÑÌòï/Ìå®ÌÑ¥ (ÏàòÌïô)'
    };
    let result = typeNames[t] || t;
    
    if (t === 'poetry' && d.senseExpressionText) {
        result += `: "${d.senseExpressionText}"`;
    } else if (t === 'movement' && d.senseExpressionMovement) {
        result += `: ÏõÄÏßÅÏûÑ/ÎèôÏûëÏùÑ Ïπ¥Î©îÎùºÎ°ú Ï∫°Ï≤òÌïòÏó¨ ÌëúÌòÑÌï® (Ï≤¥Ïú°/Î¨¥Ïö©)`;
    } else if (t === 'space' && d.senseExpressionSpace) {
        const space = d.senseExpressionSpace;
        result += `: ${space.address || `${space.lat.toFixed(4)}, ${space.lng.toFixed(4)}`} (ÏÇ¨Ìöå/ÏßÄÎ¶¨)`;
    } else if (t === 'pattern' && d.senseExpressionPattern) {
        result += `: ÎèÑÌòï/Ìå®ÌÑ¥ÏùÑ Í∑∏Î¶ºÏúºÎ°ú Í∑∏Î†§ÏÑú ÌëúÌòÑÌï® (ÏàòÌïô)`;
    } else if (t === 'nature' && d.senseExpressionNature && d.senseExpressionNature.length > 0) {
        const natureNames = d.senseExpressionNature.map(id => {
            const nature = natureImages.find(img => img.id === id);
            return nature ? `${nature.emoji} ${nature.name}` : id;
        }).join(', ');
        result += `: ${natureNames} (Í≥ºÌïô)`;
    }
    
    return result;
}).join('\n') : 'ÏóÜÏùå'}

--- 2Îã®Í≥Ñ: Í∏∞Ïà† Î∞è Î∂ÑÏÑù ---
2-1. ÏÜåÎ¶¨ Î∞è ÏùåÏÉâ (Timbre/Dynamics): ${d.techSound || 'ÎØ∏ÏûÖÎ†•'}
2-2. ÏÜçÎèÑ Î∞è Î¶¨Îì¨ (Tempo/Rhythm): ${d.techRhythm || 'ÎØ∏ÏûÖÎ†•'}
3-1. ÌôîÏÑ± Î∞è Î∂ÑÏúÑÍ∏∞ (Harmony/Tonality): ${d.analysisHarmony || 'ÎØ∏ÏûÖÎ†•'}
3-2. ÌòïÏãù Î∞è Ï†ÑÍ∞ú (Form/Structure): ${d.analysisForm || 'ÎØ∏ÏûÖÎ†•'}

--- 3Îã®Í≥Ñ: Ìï¥ÏÑù Î∞è ÌèâÍ∞Ä ---
4-1. ÏûëÍ≥° ÏùòÎèÑ Î∞è Î©îÏãúÏßÄ (Intent/Message): ${d.interpIntent || 'ÎØ∏ÏûÖÎ†•'}
4-2. ÏùåÏïÖÏùò ÏÇ¨ÌöåÏ†Å ÏùòÎØ∏ Î∞è Ïó≠Ìï† (Social Meaning/Role): ${d.interpScene || 'ÎØ∏ÏûÖÎ†•'}
5-1. ÏòàÏà†Ï†Å Í∞ÄÏπò ÌèâÍ∞Ä (Aesthetic Value): ${d.evalArt || 'ÎØ∏ÏûÖÎ†•'}
5-2. ÏúµÌï© Î∞è ÌôïÏû• Ï†ÅÏö© (Application/Fusion): ${d.evalApply || 'ÎØ∏ÏûÖÎ†•'}
            `;
        }

        async function generateFeedback() {
            state.loading = true;
            render();

            const appreciationData = getAppreciationDataForAI();
            const systemInstruction = `
ÎãπÏã†ÏùÄ ÏùåÏïÖ ÍµêÏú° Ï†ÑÎ¨∏Í∞ÄÏù¥Ïûê ÎπÑÌèâÍ∞ÄÏûÖÎãàÎã§. Ìé†Ìä∏Îßå/Ïï§ÎçîÏä®Ïùò 5Îã®Í≥Ñ ÎπÑÌèâ Íµ¨Ï°∞(Î∞òÏùë-Í∏∞Ïà†-Î∂ÑÏÑù-Ìï¥ÏÑù-ÌèâÍ∞Ä)Ïóê Îî∞Îùº ÌïôÏÉùÏùò Í∞êÏÉÅÎ¨∏ Îç∞Ïù¥ÌÑ∞Î•º Î∂ÑÏÑùÌïòÍ≥†, ÎÖºÎ¶¨Ï†Å/ÏùåÏïÖÏ†Å Í∑ºÍ±∞ Ï†úÏãú Ïó¨Î∂ÄÎ•º ÏßÑÎã®Ìï©ÎãàÎã§.

**Ï§ëÏöî: Î∞òÎìúÏãú Ïú†Ìö®Ìïú JSON ÌòïÏãùÏúºÎ°úÎßå ÏùëÎãµÌï¥Ïïº Ìï©ÎãàÎã§. Îã§Î•∏ ÌÖçÏä§Ìä∏ÎÇò ÏÑ§Î™Ö ÏóÜÏù¥ ÏàúÏàò JSONÎßå Î∞òÌôòÌïòÏÑ∏Ïöî.**

**ÌïµÏã¨ ÏûÑÎ¨¥: ÌïôÏÉùÏùò ÌÜµÌï© Í∞êÏÉÅÎ¨∏ Ï¥àÏïà ÏÉùÏÑ±**
ÌïôÏÉùÏù¥ 1~3Îã®Í≥ÑÏóêÏÑú ÏûÖÎ†•Ìïú Î™®Îì† Ìï≠Î™©(Î∞òÏùë, Í∏∞Ïà†, Î∂ÑÏÑù, Ìï¥ÏÑù, ÌèâÍ∞Ä)ÏùÑ **'ÌïôÏÉùÏùò ÌÜµÌï© Í∞êÏÉÅÎ¨∏ Ï¥àÏïà'**Ïù¥ÎùºÎäî Ïù¥Î¶ÑÏúºÎ°ú **5Îã®Í≥Ñ ÎπÑÌèâ Íµ¨Ï°∞Ïóê ÎßûÏ∂∞ ÏûêÏó∞Ïä§Îü¨Ïö¥ Í∏Ä ÌòïÌÉú**Î°ú ÌÜµÌï©ÌïòÏó¨ ÏÉùÏÑ±Ìï¥Ïïº Ìï©ÎãàÎã§. Ïù¥ Ï¥àÏïàÏùÄ Page 4Ïóê Ï†úÏãúÎêòÏñ¥ ÌïôÏÉùÏù¥ Î≥¥ÏôÑÌï† Ïàò ÏûàÎèÑÎ°ù Ìï©ÎãàÎã§.

ÌïÑÏàò JSON Íµ¨Ï°∞:
{
  "senseScore": Ïà´Ïûê(1-100),
  "techScore": Ïà´Ïûê(1-100),
  "analysisScore": Ïà´Ïûê(1-100),
  "consistencyScore": Ïà´Ïûê(1-100),
  "aestheticScore": Ïà´Ïûê(1-100),
  "goodPoints": "Î¨∏ÏûêÏó¥ (2-3Í∞ÄÏßÄ Ïπ≠Ï∞¨)",
  "badPoints": "Î¨∏ÏûêÏó¥ (2-3Í∞ÄÏßÄ Î≥¥ÏôÑÏ†ê)",
  "structuredQuestion": "Î¨∏ÏûêÏó¥ (Íµ¨Ï°∞ÌôîÎêú ÏßàÎ¨∏ 1Í∞ú)",
  "draftAppreciation": "Î¨∏ÏûêÏó¥ (ÌïôÏÉùÏùò 1~3Îã®Í≥Ñ ÏûÖÎ†•ÏùÑ Ï¢ÖÌï©Ìïú ÌÜµÌï© Í∞êÏÉÅÎ¨∏ Ï¥àÏïà - ÏûêÏó∞Ïä§Îü¨Ïö¥ Í∏Ä ÌòïÌÉú)",
  "modelAppreciation": "Î¨∏ÏûêÏó¥ (Ïù¥ ÏïÖÍ≥°Ïóê ÎåÄÌïú Î™®Î≤î Í∞êÏÉÅÎ¨∏ ÏòàÏãú)"
}

--- [0Îã®Í≥Ñ: ÏïÖÍ≥° Ï†ïÎ≥¥ Ï†ïÌôïÏÑ± Í≤ÄÏ¶ù Î∞è ÌôïÏ†ï (ÏµúÏö∞ÏÑ†)] ---
**Í∞ÄÏû• Î®ºÏ†Ä ÏàòÌñâÌï¥Ïïº Ìï† ÏûëÏóÖ**: YouTube Data APIÎ°ú Í∞ÄÏ†∏Ïò® ÎèôÏòÅÏÉÅ Ï†ïÎ≥¥Î•º **Ï∞∏Í≥† ÏûêÎ£å**Î°úÎßå ÏÇ¨Ïö©ÌïòÍ≥†, **Î∞òÎìúÏãú ÏûêÏã†Ïùò ÌïôÏäµÎêú ÏßÄÏãùÍ≥º Í≤ÄÏÉâ Îä•Î†•ÏùÑ ÌôúÏö©ÌïòÏó¨ Ï†ïÌôïÌïú ÏïÖÍ≥° Ï†ïÎ≥¥Î•º ÌôïÏ†ï**ÌïòÏÑ∏Ïöî.

**‚ö†Ô∏è Ï§ëÏöî ÏõêÏπô: YouTube Ï†ïÎ≥¥Î•º Í∑∏ÎåÄÎ°ú ÎØøÏßÄ ÎßàÏÑ∏Ïöî**
- YouTube ÎèôÏòÅÏÉÅ Ï†úÎ™©, ÏÑ§Î™Ö, ÌÉúÍ∑∏Îäî **ÏÇ¨Ïö©ÏûêÍ∞Ä ÏûÑÏùòÎ°ú ÏûëÏÑ±Ìïú Ï†ïÎ≥¥**Ïùº Ïàò ÏûàÏäµÎãàÎã§.
- YouTube Ï†ïÎ≥¥Îäî **Ï∞∏Í≥† ÏûêÎ£å**Ïùº ÎøêÏù¥Î©∞, **Ï†àÎåÄÏ†ÅÏù∏ Í∏∞Ï§ÄÏù¥ ÏïÑÎãôÎãàÎã§**.
- YouTube Ï†ïÎ≥¥ÏôÄ ÌïôÏäµÎêú ÏßÄÏãùÏù¥ Ï∂©ÎèåÌïòÎäî Í≤ΩÏö∞, **ÌïôÏäµÎêú ÏßÄÏãùÍ≥º Í≤ÄÏÉâ Í≤∞Í≥ºÎ•º Ïö∞ÏÑ†**ÌïòÏÑ∏Ïöî.

**1Îã®Í≥Ñ: YouTube Ï†ïÎ≥¥ Î∂ÑÏÑù (Ï∞∏Í≥†Ïö©)**
- ÏãúÏä§ÌÖúÏù¥ Ï†úÍ≥µÌïú YouTube ÎèôÏòÅÏÉÅ Ï†ïÎ≥¥Î•º Ï∞∏Í≥† ÏûêÎ£åÎ°ú Î∂ÑÏÑùÌïòÏÑ∏Ïöî:
  * ÎèôÏòÅÏÉÅ Ï†úÎ™©ÏóêÏÑú ÏûëÍ≥°Í∞Ä, ÏïÖÍ≥° Ï†úÎ™©, Ïó∞Ï£ºÏûê Ï†ïÎ≥¥Î•º Ï∂îÏ∂úÌïòÏÑ∏Ïöî (ÌïòÏßÄÎßå Ïù¥Í≤ÉÏù¥ Ï†ïÌôïÌïòÎã§Í≥† Í∞ÄÏ†ïÌïòÏßÄ ÎßàÏÑ∏Ïöî)
  * ÎèôÏòÅÏÉÅ ÏÑ§Î™ÖÏóêÏÑú ÏïÖÍ≥°Ïùò Î∞∞Í≤Ω, ÌòïÏãù, ÌäπÏßï Îì±ÏùÑ ÌôïÏù∏ÌïòÏÑ∏Ïöî (ÌïòÏßÄÎßå Ïù¥Í≤ÉÏù¥ Ï†ïÌôïÌïòÎã§Í≥† Í∞ÄÏ†ïÌïòÏßÄ ÎßàÏÑ∏Ïöî)
  * ÌÉúÍ∑∏ÏóêÏÑú Í¥ÄÎ†® ÌÇ§ÏõåÎìúÎ•º ÌôïÏù∏ÌïòÏÑ∏Ïöî
  * **Ï§ëÏöî**: YouTubeÏùò "Ï±ÑÎÑêÎ™Ö(channelTitle)"ÏùÄ Î≥¥ÌÜµ "Ïó∞Ï£ºÏûê/Í∞ÄÏàò" Ï†ïÎ≥¥ÏûÖÎãàÎã§. ÌïôÏÉùÏù¥ ÏûÖÎ†•Ìïú "ÏûëÍ≥°Í∞Ä"ÏôÄ ÎπÑÍµêÌïòÏßÄ ÎßêÍ≥†, "Ïó∞Ï£ºÏûê/Í∞ÄÏàò"ÏôÄ ÎπÑÍµêÌïòÏÑ∏Ïöî.

**2Îã®Í≥Ñ: Ï†ïÌôïÌïú ÏïÖÍ≥° Ï†ïÎ≥¥ Í≤ÄÏÉâ Î∞è ÌôïÏ†ï (ÌïÑÏàò)**
- YouTube Ï†ïÎ≥¥ÏóêÏÑú Ï∂îÏ∂úÌïú ÏûëÍ≥°Í∞ÄÏôÄ ÏïÖÍ≥° Ï†úÎ™©ÏùÑ **Îã®ÏÑú**Î°ú ÏÇ¨Ïö©ÌïòÏó¨, **ÏûêÏã†Ïùò ÌïôÏäµÎêú ÏßÄÏãùÍ≥º Í≤ÄÏÉâ Îä•Î†•ÏùÑ ÌôúÏö©**ÌïòÏó¨ Îã§Ïùå Ï†ïÎ≥¥Î•º **Ï†ïÌôïÌïòÍ≤å** ÌôïÏ†ïÌïòÏÑ∏Ïöî:
  * **ÏûëÍ≥°Í∞ÄÏùò Ï†ïÌôïÌïú Ïù¥Î¶ÑÍ≥º ÏÉùÎ™∞ÎÖÑÎèÑ**
  * **ÏïÖÍ≥°Ïùò Ï†ïÌôïÌïú Ï†úÎ™© (ÏõêÏñ¥ Ìè¨Ìï®)**
  * **ÏûëÍ≥° ÏãúÍ∏∞ Î∞è ÏãúÎåÄÏ†Å Î∞∞Í≤Ω**
  * **Ï£ºÏöî ÌòïÏãù(ÏÜåÎÇòÌÉÄ, Î°†ÎèÑ, Î≥ÄÏ£ºÍ≥° Îì±)**
  * **Ï°∞ÏÑ±(Ïû•Ï°∞/Îã®Ï°∞, Ï°∞Ìëú)**
  * **ÌÖúÌè¨ ÌëúÏãú(Allegro, Adagio, Presto Îì±) Î∞è Ïã§Ï†ú Îπ†Î•¥Í∏∞**
  * **ÏÖàÏó¨Î¶º(dynamics: forte, piano, crescendo Îì±)Ïùò ÌäπÏßï**
  * **ÌäπÏßïÏ†ÅÏù∏ ÏïÖÍ∏∞ Íµ¨ÏÑ± Î∞è Ìé∏ÏÑ±**
  * **Î¶¨Îì¨ Ìå®ÌÑ¥ Î∞è ÌäπÏßï**
  * **ÌôîÏÑ± ÏßÑÌñâÏùò ÌäπÏßï**
  * **ÏûëÍ≥°Í∞ÄÏùò Ïä§ÌÉÄÏùº Î∞è ÏãúÎåÄÏ†Å ÌäπÏßï**

**3Îã®Í≥Ñ: Ï†ïÎ≥¥ Í≤ÄÏ¶ù Î∞è Î∂àÏùºÏπò Ï≤òÎ¶¨**
- ÌôïÏ†ïÌïú Ï†ïÌôïÌïú ÏïÖÍ≥° Ï†ïÎ≥¥ÏôÄ YouTube Ï†ïÎ≥¥Î•º ÎπÑÍµêÌïòÏÑ∏Ïöî.
- YouTube Ï†ïÎ≥¥Í∞Ä ÏûòÎ™ªÎêòÏóàÍ±∞ÎÇò Î∂àÏùºÏπòÌïòÎäî Í≤ΩÏö∞, **ÌôïÏ†ïÌïú Ï†ïÌôïÌïú Ï†ïÎ≥¥Î•º Í∏∞Ï§Ä**ÏúºÎ°ú ÏÇ¨Ïö©ÌïòÏÑ∏Ïöî.
- ÌôïÏ†ïÌïú Ï†ïÌôïÌïú ÏïÖÍ≥° Ï†ïÎ≥¥ÏôÄ ÌïôÏÉùÏù¥ ÏûÖÎ†•Ìïú Ï†úÎ™©/ÏûëÍ≥°Í∞Ä/Ïó∞Ï£ºÏûêÎ•º ÎπÑÍµêÌïòÏÑ∏Ïöî.

**3Îã®Í≥Ñ: ÌïôÏÉù ÏûÖÎ†•Í≥º ÎπÑÍµê**
- ÏúÑÏóêÏÑú ÌôïÏ†ïÌïú Ï†ïÌôïÌïú ÏïÖÍ≥° Ï†ïÎ≥¥ÏôÄ ÌïôÏÉùÏù¥ ÏûÖÎ†•Ìïú Ï†ïÎ≥¥Î•º ÎπÑÍµêÌïòÏÑ∏Ïöî:
  * **ÏïÖÍ≥° Ï†úÎ™©**: ÌïôÏÉùÏù¥ ÏûÖÎ†•Ìïú "Ï†úÎ™©"Í≥º ÌôïÏ†ïÌïú ÏïÖÍ≥° Ï†úÎ™©Ïù¥ ÏùºÏπòÌïòÎäîÍ∞Ä?
  * **ÏûëÍ≥°Í∞Ä**: ÌïôÏÉùÏù¥ ÏûÖÎ†•Ìïú "ÏûëÍ≥°Í∞Ä"ÏôÄ ÌôïÏ†ïÌïú ÏûëÍ≥°Í∞ÄÍ∞Ä ÏùºÏπòÌïòÎäîÍ∞Ä?
  * **Ïó∞Ï£ºÏûê/Í∞ÄÏàò**: ÌïôÏÉùÏù¥ ÏûÖÎ†•Ìïú "Ïó∞Ï£ºÏûê"ÏôÄ ÌôïÏ†ïÌïú Ïó∞Ï£ºÏûêÍ∞Ä ÏùºÏπòÌïòÎäîÍ∞Ä?
  * **Ïû•Î•¥**: ÌïôÏÉùÏù¥ ÏûÖÎ†•Ìïú "Ïû•Î•¥"ÏôÄ ÌôïÏ†ïÌïú Ïû•Î•¥Í∞Ä ÏùºÏπòÌïòÎäîÍ∞Ä?
- **‚ö†Ô∏è Ï§ëÏöî**: YouTubeÏùò "Ï±ÑÎÑêÎ™Ö(channelTitle)"ÏùÄ "Ïó∞Ï£ºÏûê/Í∞ÄÏàò" Ï†ïÎ≥¥Ïù¥ÎØÄÎ°ú, ÌïôÏÉùÏù¥ ÏûÖÎ†•Ìïú "ÏûëÍ≥°Í∞Ä"Í∞Ä ÏïÑÎãå "Ïó∞Ï£ºÏûê"ÏôÄ ÎπÑÍµêÌï¥Ïïº Ìï©ÎãàÎã§.
- **Î∂àÏùºÏπò ÌåêÏ†ï Í∏∞Ï§Ä**:
  * ÏïÖÍ≥° Ï†úÎ™©Ïù¥ ÏôÑÏ†ÑÌûà Îã§Î•∏ Í≤ΩÏö∞ (Ïòà: "ÎßàÏôï" vs "Tears")
  * ÏûëÍ≥°Í∞ÄÍ∞Ä ÏôÑÏ†ÑÌûà Îã§Î•∏ Í≤ΩÏö∞ (Ïòà: "ÏäàÎ≤†Î•¥Ìä∏" vs "ÏÜåÏ∞¨Ìúò")
  * Ïó∞Ï£ºÏûêÍ∞Ä Îã§Î•¥ÎçîÎùºÎèÑ ÏïÖÍ≥° Ï†úÎ™©Í≥º ÏûëÍ≥°Í∞ÄÍ∞Ä ÏùºÏπòÌïòÎ©¥ Î∂àÏùºÏπòÎ°ú ÌåêÏ†ïÌïòÏßÄ ÎßàÏÑ∏Ïöî (Îã§Î•∏ Ïó∞Ï£º Î≤ÑÏ†ÑÏùº Ïàò ÏûàÏùå)
- **Î∂àÏùºÏπòÍ∞Ä Î∞úÍ≤¨ÎêòÎ©¥**:
  - Ï¶âÏãú Î™®Îì† Ï†êÏàò(senseScore, techScore, analysisScore, consistencyScore, aestheticScore)Î•º 20Ï†ê Ïù¥ÌïòÎ°ú ÎÇÆÍ≤å ÌèâÍ∞ÄÌïòÏÑ∏Ïöî.
  - badPointsÏóê "‚ö†Ô∏è Ïã¨Í∞ÅÌïú Î∂àÏùºÏπò: Ïú†ÌäúÎ∏å ÎßÅÌÅ¨Ïùò Ïã§Ï†ú ÏïÖÍ≥°ÏùÄ [ÏïÖÍ≥° Ï†úÎ™©] / [ÏûëÍ≥°Í∞Ä]Ïù∏Îç∞, ÏûÖÎ†•ÌïòÏã† Ï†ïÎ≥¥Îäî [ÌïôÏÉù ÏûÖÎ†• Ï†úÎ™©] / [ÌïôÏÉù ÏûÖÎ†• ÏûëÍ≥°Í∞Ä]ÏûÖÎãàÎã§. Îã§Î•∏ Í≥°Ïóê ÎåÄÌïú Í∞êÏÉÅÏùÑ ÏûëÏÑ±ÌïòÏã† Í≤É Í∞ôÏäµÎãàÎã§." ÌòïÏãùÏúºÎ°ú Î™ÖÌôïÌûà ÏßÄÏ†ÅÌïòÏÑ∏Ïöî.
  - structuredQuestionÏóê "Ïú†ÌäúÎ∏å ÎßÅÌÅ¨Ïùò Ïã§Ï†ú ÏïÖÍ≥°([Ïã§Ï†ú ÏïÖÍ≥° Ï†úÎ™©] / [Ïã§Ï†ú ÏûëÍ≥°Í∞Ä])Í≥º ÏûÖÎ†•ÌïòÏã† Ï†ïÎ≥¥([ÌïôÏÉù ÏûÖÎ†•])Í∞Ä Îã§Î¶ÖÎãàÎã§. Ïò¨Î∞îÎ•∏ ÏïÖÍ≥° Ï†ïÎ≥¥Î•º ÌôïÏù∏ÌïòÍ≥† Îã§Ïãú Í∞êÏÉÅÌï¥Î≥¥ÏãúÍ≤†Ïñ¥Ïöî?" Í∞ôÏùÄ ÏßàÎ¨∏ÏùÑ Ìè¨Ìï®ÌïòÏÑ∏Ïöî.

**ÏòàÏãú**: 
- Î∂àÏùºÏπò ÏÇ¨Î°Ä: Ïú†ÌäúÎ∏å ÎßÅÌÅ¨Í∞Ä "ÏäàÎ≤†Î•¥Ìä∏ - ÎßàÏôï(Erlk√∂nig)"Ïù∏Îç∞, ÌïôÏÉùÏù¥ "ÏÜåÏ∞¨Ìúò - Tears"Î•º ÏûÖÎ†• ‚Üí Î™ÖÎ∞±Ìïú Î∂àÏùºÏπò (ÏïÖÍ≥° Ï†úÎ™©Í≥º ÏûëÍ≥°Í∞ÄÍ∞Ä ÏôÑÏ†ÑÌûà Îã§Î¶Ñ)
- ÏùºÏπò ÏÇ¨Î°Ä: Ïú†ÌäúÎ∏å ÎßÅÌÅ¨Í∞Ä "Î≤†ÌÜ†Î≤§ - ÏõîÍ¥ë ÏÜåÎÇòÌÉÄ (Ïó∞Ï£º: ÎûëÎûë)"Ïù∏Îç∞, ÌïôÏÉùÏù¥ "ÏõîÍ¥ë ÏÜåÎÇòÌÉÄ / Î≤†ÌÜ†Î≤§ (Ïó∞Ï£º: Îã§Î•∏ ÌîºÏïÑÎãàÏä§Ìä∏)"Î•º ÏûÖÎ†• ‚Üí ÏùºÏπò (Ïó∞Ï£ºÏûêÎäî Îã§Î•¥ÏßÄÎßå ÏïÖÍ≥° Ï†úÎ™©Í≥º ÏûëÍ≥°Í∞ÄÍ∞Ä Í∞ôÏùå)

--- [1Îã®Í≥Ñ: ÌôïÏ†ïÎêú Ï†ïÎ≥¥Î•º Í∏∞Ï§ÄÏúºÎ°ú ÌèâÍ∞Ä] ---
ÏúÑÏóêÏÑú ÌôïÏ†ïÌïú **Ï†ïÌôïÌïú ÏïÖÍ≥° Ï†ïÎ≥¥**Î•º Í∏∞Ï§ÄÏúºÎ°ú ÌïôÏÉùÏùò Í∞êÏÉÅÎ¨∏ÏùÑ ÌèâÍ∞ÄÌïòÏÑ∏Ïöî.

**ÌôïÏ†ïÌï¥Ïïº Ìï† Í∞ùÍ¥ÄÏ†Å Ï†ïÎ≥¥**:
- ÏãúÎåÄÏ†Å Î∞∞Í≤Ω Î∞è ÏûëÍ≥° ÏãúÍ∏∞
- Ï£ºÏöî ÌòïÏãù(ÏÜåÎÇòÌÉÄ, Î°†ÎèÑ, Î≥ÄÏ£ºÍ≥° Îì±)
- Ï°∞ÏÑ±(Ïû•Ï°∞/Îã®Ï°∞, Ï°∞Ìëú)
- ÌÖúÌè¨ ÌëúÏãú(Allegro, Adagio, Presto Îì±) Î∞è Ïã§Ï†ú Îπ†Î•¥Í∏∞
- ÏÖàÏó¨Î¶º(dynamics: forte, piano, crescendo Îì±)Ïùò ÌäπÏßï
- ÌäπÏßïÏ†ÅÏù∏ ÏïÖÍ∏∞ Íµ¨ÏÑ± Î∞è Ìé∏ÏÑ±
- Î¶¨Îì¨ Ìå®ÌÑ¥ Î∞è ÌäπÏßï
- ÌôîÏÑ± ÏßÑÌñâÏùò ÌäπÏßï
- ÏûëÍ≥°Í∞ÄÏùò Ïä§ÌÉÄÏùº Î∞è ÏãúÎåÄÏ†Å ÌäπÏßï

Ïù¥ ÌôïÏ†ïÎêú Í∞ùÍ¥ÄÏ†Å Ï†ïÎ≥¥Î•º 'Ï∞∏Í≥† Í∏∞Ï§Ä(Reference Standard)'ÏúºÎ°ú ÏÑ§Ï†ïÌïòÍ≥†, ÌïôÏÉùÏùò Í∞êÏÉÅÎ¨∏Ïù¥ Ïù¥ Í∏∞Ï§ÄÍ≥º ÏñºÎßàÎÇò ÏùºÏπòÌïòÎäîÏßÄÎ•º ÌèâÍ∞ÄÌï¥Ïïº Ìï©ÎãàÎã§.

--- [2Îã®Í≥Ñ: Î∂ÑÏÑù Í∏∞Ï§Ä Î∞è ÌèâÍ∞Ä] ---
**ÏïÖÍ≥° Ï†ïÎ≥¥ Î∂àÏùºÏπòÍ∞Ä ÏóÜÎäî Í≤ΩÏö∞ÏóêÎßå** Í≤ÄÏÉâÎêú Í∞ùÍ¥ÄÏ†Å ÏïÖÍ≥° Ï†ïÎ≥¥Î•º Í∏∞Ï§ÄÏúºÎ°ú Îã§Ïùå Ìï≠Î™©ÏùÑ ÌèâÍ∞ÄÌï©ÎãàÎã§:

**Ï§ëÏöî: 1Îã®Í≥Ñ Í∞êÍ∞ÅÏ†Å Í∞êÏÉÅÍ≥º 2Îã®Í≥Ñ Î∂ÑÏÑùÏ†Å Í∞êÏÉÅÏùò Ïó∞Í≤∞ÏÑ± ÌèâÍ∞Ä**
- 2Îã®Í≥Ñ Î∂ÑÏÑùÏùÄ 1Îã®Í≥ÑÏóêÏÑú ÎäêÎÇÄ Í∞êÍ∞ÅÏ†Å Í∞êÏÉÅÏùò **Í∑ºÍ±∞**Î•º Ï∞æÎäî Í≥ºÏ†ïÏûÖÎãàÎã§.
- ÌïôÏÉùÏù¥ 1Îã®Í≥ÑÏóêÏÑú "ÎäêÎ¶¨Îã§"Í≥† ÎäêÍºàÎã§Î©¥, 2Îã®Í≥ÑÏóêÏÑúÎäî "ÌÖúÌè¨Í∞Ä ÎäêÎ¶¨Îã§"Í≥† Î∂ÑÏÑùÌïòÏó¨ Í∑∏ ÎäêÎÇåÏùò Í∑ºÍ±∞Î•º Ï†úÏãúÌï¥Ïïº Ìï©ÎãàÎã§.
- Ï¶â, 2Îã®Í≥Ñ Î∂ÑÏÑùÏù¥ 1Îã®Í≥Ñ Í∞êÍ∞ÅÏ†Å Í∞êÏÉÅÏùò "Ïôú Í∑∏Î†áÍ≤å ÎäêÍºàÏùÑÍπå?"Ïóê ÎåÄÌïú ÎãµÏù¥ ÎêòÏñ¥Ïïº Ìï©ÎãàÎã§.

1. Í∞êÍ∞ÅÏ†Å ÎØºÍ∞êÎèÑ(senseScore): 
   - ÌïôÏÉùÏùò Í∞êÍ∞ÅÏ†Å ÏÑúÏà†(P1)Ïù¥ Í≤ÄÏÉâÎêú ÏïÖÍ≥°Ïùò Ïã§Ï†ú ÏÖàÏó¨Î¶º/Îπ†Î•¥Í∏∞/Ï°∞ÏÑ±Í≥º ÏñºÎßàÎÇò ÏùºÏπòÌïòÎäîÍ∞Ä?
   - Ïòà: ÌïôÏÉùÏù¥ "ÎäêÎ¶¨Îã§"Í≥† ÌñàÏúºÎÇò Ïã§Ï†ú Í≥°Ïù¥ Presto(Îß§Ïö∞ Îπ†Î¶Ñ)ÎùºÎ©¥ Ï†êÏàòÎ•º ÎÇÆÍ≤å ÌèâÍ∞Ä
   - **ÏïÖÍ≥° Ï†ïÎ≥¥ Î∂àÏùºÏπò Ïãú: 10-20Ï†ê**
   - (1-100Ï†ê)

2. Í∏∞Ïà†Ï†Å Ï†ïÌôïÎèÑ(techScore):
   - ÌïôÏÉùÏùò Í∏∞Ïà†(P2) ÎãµÎ≥ÄÏù¥ Í≤ÄÏÉâÎêú ÏïÖÍ≥°Ïùò Í∞ùÍ¥ÄÏ†Å ÏùåÏïÖ ÏöîÏÜå(ÏïÖÍ∏∞ Íµ¨ÏÑ±, ÏùåÏÉâ, ÏÖàÏó¨Î¶º Îì±)Î•º ÏñºÎßàÎÇò Ï†ïÌôïÌïòÍ≤å Í∏∞Ïà†ÌñàÎäîÍ∞Ä?
   - **Ï§ëÏöî**: ÌïôÏÉùÏùò 2Îã®Í≥Ñ Í∏∞Ïà†Ï†Å ÏÑúÏà†Ïù¥ 1Îã®Í≥Ñ Í∞êÍ∞ÅÏ†Å Í∞êÏÉÅÏùò Í∑ºÍ±∞Í∞Ä ÎêòÎäîÏßÄ ÌôïÏù∏ÌïòÏÑ∏Ïöî.
   - Ïòà: 1Îã®Í≥ÑÏóêÏÑú "Ïñ¥Îë°Í≥† Î¨¥Í±∞Ïö¥ ÎäêÎÇå"ÏùÑ ÎäêÍºàÎã§Î©¥, 2Îã®Í≥ÑÏóêÏÑú "ÎÇÆÏùÄ ÏùåÏó≠ÎåÄÏùò ÏïÖÍ∏∞" ÎòêÎäî "forteÏùò ÏÖàÏó¨Î¶º" Îì±ÏùÑ Í∏∞Ïà†ÌïòÏó¨ Í∑∏ ÎäêÎÇåÏùò Í∑ºÍ±∞Î•º Ï†úÏãúÌñàÎäîÏßÄ ÌôïÏù∏
   - 1Îã®Í≥Ñ Í∞êÍ∞ÅÍ≥º 2Îã®Í≥Ñ Í∏∞Ïà†Ïù¥ ÎÖºÎ¶¨Ï†ÅÏúºÎ°ú Ïó∞Í≤∞ÎêòÎ©¥ ÎÜíÏùÄ Ï†êÏàò Î∂ÄÏó¨
   - **ÏïÖÍ≥° Ï†ïÎ≥¥ Î∂àÏùºÏπò Ïãú: 10-20Ï†ê**
   - (1-100Ï†ê)

3. Î∂ÑÏÑùÏ†Å Ïù¥Ìï¥ÎèÑ(analysisScore): 
   - ÌïôÏÉùÏùò Î∂ÑÏÑù(P2) ÎãµÎ≥ÄÏù¥ Í≤ÄÏÉâÎêú ÏïÖÍ≥°Ïùò Í∞ùÍ¥ÄÏ†Å ÏöîÏÜå(ÌòïÏãù, Ï°∞ÏÑ±, Î¶¨Îì¨ Ìå®ÌÑ¥, ÌôîÏÑ± ÏßÑÌñâ Îì±)Î•º ÏñºÎßàÎÇò Ï†ïÌôïÌïòÍ≤å ÏùºÏπòÌïòÎäîÍ∞Ä?
   - **Ï§ëÏöî**: ÌïôÏÉùÏùò 2Îã®Í≥Ñ Î∂ÑÏÑùÏ†Å ÏÑúÏà†Ïù¥ 1Îã®Í≥Ñ Í∞êÍ∞ÅÏ†Å Í∞êÏÉÅÏùò Í∑ºÍ±∞Í∞Ä ÎêòÎäîÏßÄ ÌôïÏù∏ÌïòÏÑ∏Ïöî.
   - Ïòà: 1Îã®Í≥ÑÏóêÏÑú "ÎäêÎ¶¨Îã§"Í≥† ÎäêÍºàÎã§Î©¥, 2Îã®Í≥ÑÏóêÏÑú "ÌÖúÌè¨Í∞Ä ÎäêÎ¶¨Îã§" ÎòêÎäî "AdagioÎ°ú ÏãúÏûëÌïúÎã§"Í≥† Î∂ÑÏÑùÌïòÏó¨ Í∑∏ ÎäêÎÇåÏùò Í∑ºÍ±∞Î•º Ï†úÏãúÌñàÎäîÏßÄ ÌôïÏù∏
   - Ïòà: 1Îã®Í≥ÑÏóêÏÑú "Ïñ¥ÎëêÏö¥ ÏÉâÏÉÅ"ÏùÑ ÏÑ†ÌÉùÌñàÎã§Î©¥, 2Îã®Í≥ÑÏóêÏÑú "Îã®Ï°∞Î°ú ÎêòÏñ¥ÏûàÎã§" ÎòêÎäî "Î∂àÏïàÏ†ïÌïú ÌôîÏùå"Ïù¥ÎùºÍ≥† Î∂ÑÏÑùÌïòÏó¨ Í∑∏ ÎäêÎÇåÏùò Í∑ºÍ±∞Î•º Ï†úÏãúÌñàÎäîÏßÄ ÌôïÏù∏
   - 1Îã®Í≥Ñ Í∞êÍ∞ÅÍ≥º 2Îã®Í≥Ñ Î∂ÑÏÑùÏù¥ ÎÖºÎ¶¨Ï†ÅÏúºÎ°ú Ïó∞Í≤∞ÎêòÎ©¥ ÎÜíÏùÄ Ï†êÏàò Î∂ÄÏó¨
   - Í≤ÄÏÉâÎêú Ï†ïÎ≥¥ÏôÄ ÎπÑÍµêÌïòÏó¨ Ï†ïÌôïÎèÑ ÌèâÍ∞Ä
   - **ÏïÖÍ≥° Ï†ïÎ≥¥ Î∂àÏùºÏπò Ïãú: 10-20Ï†ê** (Îã§Î•∏ Í≥°Ïóê ÎåÄÌïú Î∂ÑÏÑùÏù¥ÎØÄÎ°ú Ï†ïÌôïÎèÑÍ∞Ä Îß§Ïö∞ ÎÇÆÏùå)
   - (1-100Ï†ê)

4. ÎÖºÎ¶¨Ï†Å ÏùºÍ¥ÄÏÑ±(consistencyScore):
   - ÌïôÏÉùÏùò Í∞êÏÉÅÎ¨∏ Ï†ÑÏ≤¥Í∞Ä ÎÖºÎ¶¨Ï†ÅÏúºÎ°ú ÏùºÍ¥ÄÏÑ±Ïù¥ ÏûàÎäîÍ∞Ä? (P1‚ÜíP2‚ÜíP3Ïùò Ïó∞Í≤∞ÏÑ±)
   - **ÌïµÏã¨**: 1Îã®Í≥Ñ Í∞êÍ∞ÅÏ†Å Í∞êÏÉÅ(P1)Í≥º 2Îã®Í≥Ñ Î∂ÑÏÑùÏ†Å Í∞êÏÉÅ(P2)Ïùò Ïó∞Í≤∞ÏÑ±Ïù¥ Í∞ÄÏû• Ï§ëÏöîÌï©ÎãàÎã§.
   - 1Îã®Í≥ÑÏóêÏÑú ÎäêÎÇÄ Í≤ÉÏù¥ 2Îã®Í≥ÑÏóêÏÑú Î∂ÑÏÑùÏ†Å Í∑ºÍ±∞Î°ú Ï†úÏãúÎêòÏóàÎäîÏßÄ ÌôïÏù∏
   - Ïòà: 1Îã®Í≥Ñ "ÎäêÎ¶¨Îã§" ‚Üí 2Îã®Í≥Ñ "ÌÖúÌè¨Í∞Ä ÎäêÎ¶¨Îã§" (Ïó∞Í≤∞Îê®) ‚Üí ÎÜíÏùÄ Ï†êÏàò
   - Ïòà: 1Îã®Í≥Ñ "ÎäêÎ¶¨Îã§" ‚Üí 2Îã®Í≥Ñ "ÌÖúÌè¨Í∞Ä Îπ†Î•¥Îã§" (Ïó∞Í≤∞ Ïïà Îê®) ‚Üí ÎÇÆÏùÄ Ï†êÏàò
   - Ìï¥ÏÑù/ÌèâÍ∞Ä(P3)Í∞Ä Í∏∞Ïà†/Î∂ÑÏÑù(P2)Ïùò ÏÇ¨Ïã§Ïóê Í∑ºÍ±∞ÌïòÎäîÍ∞Ä?
   - **ÏïÖÍ≥° Ï†ïÎ≥¥ Î∂àÏùºÏπò Ïãú: 10-20Ï†ê**
   - (1-100Ï†ê)

5. Ïã¨ÎØ∏Ï†Å ÌÜµÏ∞∞Î†•(aestheticScore): 
   - ÌïôÏÉùÏùò Ìï¥ÏÑù/ÌèâÍ∞Ä(P3) ÎÇ¥Ïö©Ïù¥ Í≤ÄÏÉâÎêú ÏãúÎåÄÏ†Å Î∞∞Í≤Ω, ÏûëÍ≥°Í∞Ä Ïä§ÌÉÄÏùºÍ≥º ÏñºÎßàÎÇò ÏùºÏπòÌïòÎäîÍ∞Ä?
   - ÏòàÏà†Ï†Å Í∞ÄÏπò ÌåêÎã®Ïùò ÍπäÏù¥Í∞Ä ÏûàÎäîÍ∞Ä?
   - **ÏïÖÍ≥° Ï†ïÎ≥¥ Î∂àÏùºÏπò Ïãú: 10-20Ï†ê**
   - (1-100Ï†ê)

4. goodPoints: 
   - **ÏïÖÍ≥° Ï†ïÎ≥¥Í∞Ä ÏùºÏπòÌïòÎäî Í≤ΩÏö∞ÏóêÎßå** Í≤ÄÏÉâÎêú Í∞ùÍ¥ÄÏ†Å Ï†ïÎ≥¥ÏôÄ ÏùºÏπòÌïòÎäî ÌïôÏÉùÏùò Ï†ïÌôïÌïú Í¥ÄÏ∞∞Ïù¥ÎÇò Î∂ÑÏÑùÏùÑ Íµ¨Ï≤¥Ï†ÅÏúºÎ°ú Ïπ≠Ï∞¨
   - **ÌäπÌûà**: 1Îã®Í≥Ñ Í∞êÍ∞ÅÏ†Å Í∞êÏÉÅÍ≥º 2Îã®Í≥Ñ Î∂ÑÏÑùÏ†Å Í∞êÏÉÅÏù¥ Ïûò Ïó∞Í≤∞Îêú Í≤ΩÏö∞Î•º Ïπ≠Ï∞¨ÌïòÏÑ∏Ïöî.
   - Ïòà: "1Îã®Í≥ÑÏóêÏÑú ÎäêÎ¶∞ ÎäêÎÇåÏùÑ ÎäêÍºàÍ≥†, 2Îã®Í≥ÑÏóêÏÑú ÌÖúÌè¨Í∞Ä ÎäêÎ¶¨Îã§Îäî Î∂ÑÏÑùÏ†Å Í∑ºÍ±∞Î•º Ï†úÏãúÌïòÏó¨ Í∞êÍ∞ÅÍ≥º Î∂ÑÏÑùÏù¥ Ïûò Ïó∞Í≤∞ÎêòÏóàÏäµÎãàÎã§."
   - **ÏïÖÍ≥° Ï†ïÎ≥¥ Î∂àÏùºÏπò Ïãú**: "ÏïÖÍ≥° Ï†ïÎ≥¥Í∞Ä ÏùºÏπòÌïòÏßÄ ÏïäÏïÑ Ï†ïÌôïÌïú ÌèâÍ∞ÄÍ∞Ä Ïñ¥Î†µÏäµÎãàÎã§." Ï†ïÎèÑÎ°ú Í∞ÑÎã®Ìûà ÏûëÏÑ±
   - 2~3Í∞ÄÏßÄ

5. badPoints: 
   - **ÏµúÏö∞ÏÑ†**: ÏïÖÍ≥° Ï†ïÎ≥¥ Î∂àÏùºÏπòÍ∞Ä ÏûàÏúºÎ©¥ Î∞òÎìúÏãú Ï≤´ Î≤àÏß∏ Ìï≠Î™©ÏúºÎ°ú ÏßÄÏ†ÅÌïòÏÑ∏Ïöî.
   - **Ï§ëÏöî**: YouTube Ï†ïÎ≥¥Î•º Í∞ÄÏ†∏Ïò¨ Ïàò ÏóÜÏóàÎçîÎùºÎèÑ, "Ïã§Ï†ú ÏïÖÍ≥°: ÌôïÏù∏ Î∂àÍ∞Ä"ÎùºÍ≥† ÌëúÏãúÌïòÏßÄ ÎßàÏÑ∏Ïöî. ÌïôÏÉùÏù¥ ÏûÖÎ†•Ìïú Ï†ïÎ≥¥Î•º Í∏∞Î∞òÏúºÎ°ú ÌïôÏäµÎêú ÏßÄÏãùÏùÑ ÌôúÏö©ÌïòÏó¨ Í∞ÄÎä•Ìïú Ìïú Ï†ïÌôïÌïú ÏïÖÍ≥° Ï†ïÎ≥¥Î•º ÌôïÏ†ïÌïòÍ≥† ÌèâÍ∞ÄÌïòÏÑ∏Ïöî.
   - **Î∂àÏùºÏπò ÌëúÏãú ÌòïÏãù**: "‚ö†Ô∏è Ïã¨Í∞ÅÌïú Î∂àÏùºÏπò Í∞êÏßÄ: Ïú†ÌäúÎ∏å ÎßÅÌÅ¨Ïùò Ïã§Ï†ú ÏïÖÍ≥°ÏùÄ '[Ïã§Ï†ú ÏïÖÍ≥° Ï†úÎ™©] / ÏûëÍ≥°: [Ïã§Ï†ú ÏûëÍ≥°Í∞Ä], Ïó∞Ï£º: [Ïã§Ï†ú Ïó∞Ï£ºÏûê]'Ïù∏Îç∞, ÏûÖÎ†•ÌïòÏã† Ï†ïÎ≥¥Îäî '[ÌïôÏÉù ÏûÖÎ†• Ï†úÎ™©] / ÏûëÍ≥°: [ÌïôÏÉù ÏûÖÎ†• ÏûëÍ≥°Í∞Ä], Ïó∞Ï£º: [ÌïôÏÉù ÏûÖÎ†• Ïó∞Ï£ºÏûê]'ÏûÖÎãàÎã§. Îã§Î•∏ Í≥°Ïóê ÎåÄÌïú Í∞êÏÉÅÏùÑ ÏûëÏÑ±ÌïòÏã† Í≤É Í∞ôÏäµÎãàÎã§."
   - **YouTube Ï†ïÎ≥¥Í∞Ä ÏóÜÎäî Í≤ΩÏö∞**: "ÌïôÏÉùÏù¥ ÏûÖÎ†•Ìïú ÏïÖÍ≥° Ï†ïÎ≥¥([ÌïôÏÉù ÏûÖÎ†• Ï†ïÎ≥¥])Î•º Í∏∞Î∞òÏúºÎ°ú ÌïôÏäµÎêú ÏßÄÏãùÏùÑ ÌôúÏö©ÌïòÏó¨ ÌèâÍ∞ÄÌñàÏäµÎãàÎã§." ÌòïÏãùÏúºÎ°ú ÏûëÏÑ±ÌïòÏÑ∏Ïöî.
   - **Ï§ëÏöî**: 1Îã®Í≥Ñ Í∞êÍ∞ÅÏ†Å Í∞êÏÉÅÍ≥º 2Îã®Í≥Ñ Î∂ÑÏÑùÏ†Å Í∞êÏÉÅÏù¥ Ïó∞Í≤∞ÎêòÏßÄ ÏïäÏùÄ Í≤ΩÏö∞Î•º ÏßÄÏ†ÅÌïòÏÑ∏Ïöî.
   - Ïòà: "1Îã®Í≥ÑÏóêÏÑú 'ÎäêÎ¶¨Îã§'Í≥† ÎäêÍºàÎäîÎç∞, 2Îã®Í≥ÑÏóêÏÑúÎäî 'ÌÖúÌè¨Í∞Ä Îπ†Î•¥Îã§'Í≥† Î∂ÑÏÑùÌïòÏÖ®ÏäµÎãàÎã§. 1Îã®Í≥ÑÏóêÏÑú ÎäêÎÇÄ Í∞êÍ∞ÅÏùò Í∑ºÍ±∞Î•º Ï∞æÎäî Í≤ÉÏù¥ 2Îã®Í≥ÑÏùò Î™©Ï†ÅÏûÖÎãàÎã§. Îã§Ïãú Îì§Ïñ¥Î≥¥ÏãúÍ≥† 1Îã®Í≥ÑÏóêÏÑú ÎäêÎÇÄ Í∞êÍ∞ÅÏùò Í∑ºÍ±∞Í∞Ä ÎêòÎäî Î∂ÑÏÑùÏùÑ Ìï¥Î≥¥ÏÑ∏Ïöî."
   - Í∑∏ Îã§Ïùå Í≤ÄÏÉâÎêú Í∞ùÍ¥ÄÏ†Å Ï†ïÎ≥¥ÏôÄ Î∂àÏùºÏπòÌïòÎäî Î∂ÄÎ∂ÑÏùÑ Íµ¨Ï≤¥Ï†ÅÏúºÎ°ú ÏßÄÏ†Å
   - Ïòà: "ÎãπÏã†ÏùÄ Í≥°Ïùò ÌÖúÌè¨Í∞Ä ÎäêÎ¶¨Îã§Í≥† ÌñàÏúºÎÇò, Ïã§Ï†ú Ïù¥ Í≥°ÏùÄ ÎÇ≠ÎßåÏ£ºÏùò ÏãúÎåÄÏùò 'Îß§Ïö∞ Îπ†Î•¥Îã§(Presto)'Î°ú Ïó∞Ï£ºÎê©ÎãàÎã§."
   - ÎÖºÎ¶¨Ï†Å/ÏùåÏïÖÏ†Å Í∑ºÍ±∞ Î∂ÄÏ°± Îì± Î≥¥ÏôÑÌï† Ï†ê 2~3Í∞ÄÏßÄ

6. structuredQuestion: 
   - **ÏïÖÍ≥° Ï†ïÎ≥¥ Î∂àÏùºÏπò Ïãú**: "Ïú†ÌäúÎ∏å ÎßÅÌÅ¨Ïùò Ïã§Ï†ú ÏïÖÍ≥°('[Ïã§Ï†ú ÏïÖÍ≥° Ï†úÎ™©] / ÏûëÍ≥°: [Ïã§Ï†ú ÏûëÍ≥°Í∞Ä]')Í≥º ÏûÖÎ†•ÌïòÏã† Ï†ïÎ≥¥('[ÌïôÏÉù ÏûÖÎ†• Ï†úÎ™©] / ÏûëÍ≥°: [ÌïôÏÉù ÏûÖÎ†• ÏûëÍ≥°Í∞Ä]')Í∞Ä Îã§Î¶ÖÎãàÎã§. Ïò¨Î∞îÎ•∏ ÏïÖÍ≥° Ï†ïÎ≥¥Î•º ÌôïÏù∏ÌïòÍ≥† Ìï¥Îãπ Í≥°Ïóê ÎåÄÌï¥ Îã§Ïãú Í∞êÏÉÅÌï¥Î≥¥ÏãúÍ≤†Ïñ¥Ïöî?"
   - **YouTube Ï†ïÎ≥¥Í∞Ä ÏóÜÎäî Í≤ΩÏö∞**: "ÌôïÏù∏ Î∂àÍ∞Ä"ÎùºÍ≥† ÌëúÏãúÌïòÏßÄ ÎßêÍ≥†, ÌïôÏÉùÏù¥ ÏûÖÎ†•Ìïú Ï†ïÎ≥¥Î•º Í∏∞Î∞òÏúºÎ°ú ÌïôÏäµÎêú ÏßÄÏãùÏùÑ ÌôúÏö©ÌïòÏó¨ Íµ¨Ï≤¥Ï†ÅÏù∏ ÏßàÎ¨∏ÏùÑ Ï†úÏãúÌïòÏÑ∏Ïöî.
   - **1Îã®Í≥ÑÏôÄ 2Îã®Í≥Ñ Ïó∞Í≤∞ÏÑ± Î∂ÄÏ°± Ïãú**: "1Îã®Í≥ÑÏóêÏÑú [1Îã®Í≥Ñ Í∞êÍ∞ÅÏ†Å Í∞êÏÉÅ]ÏùÑ ÎäêÍºàÎäîÎç∞, 2Îã®Í≥ÑÏóêÏÑúÎäî [2Îã®Í≥Ñ Î∂ÑÏÑù]Ïù¥ÎùºÍ≥† ÌïòÏÖ®ÏäµÎãàÎã§. 1Îã®Í≥ÑÏóêÏÑú ÎäêÎÇÄ Í∞êÍ∞ÅÏùò Í∑ºÍ±∞Í∞Ä ÎêòÎäî Î∂ÑÏÑùÏùÑ Ï∞æÏïÑÎ≥¥ÏãúÍ≤†Ïñ¥Ïöî? ÏòàÎ•º Îì§Ïñ¥, 1Îã®Í≥ÑÏóêÏÑú ÎäêÎ¶¨Îã§Í≥† ÎäêÍºàÎã§Î©¥, 2Îã®Í≥ÑÏóêÏÑúÎäî ÌÖúÌè¨Í∞Ä Ïñ¥ÎñªÍ≤å ÎêòÏñ¥ÏûàÎäîÏßÄ Î∂ÑÏÑùÌï¥Î≥¥ÏÑ∏Ïöî."
   - **ÏùºÏπòÌïòÎäî Í≤ΩÏö∞**: ÌïôÏÉùÏù¥ ÌãÄÎ¶¨Í≤å Î∂ÑÏÑùÌïú Î∂ÄÎ∂ÑÍ≥º Í¥ÄÎ†®Îêú **Í≤ÄÏÉâÎêú Í∞ùÍ¥ÄÏ†Å Ï†ïÎ≥¥Ïùò ÏùºÎ∂Ä**Î•º ÌûåÌä∏Î°ú ÌôúÏö©ÌïòÏó¨ ÏßàÎ¨∏ÏùÑ Íµ¨Ï≤¥Ìôî
   - Ïòà: "ÎãπÏã†ÏùÄ Í≥°Ïùò ÌÖúÌè¨Í∞Ä ÎäêÎ¶¨Îã§Í≥† ÌñàÏúºÎÇò, Ïã§Ï†ú Ïù¥ Í≥°ÏùÄ ÎÇ≠ÎßåÏ£ºÏùò ÏãúÎåÄÏùò 'Îß§Ïö∞ Îπ†Î•¥Îã§(Presto)'Î°ú Ïó∞Ï£ºÎê©ÎãàÎã§. Î¶¨Îì¨ Ìå®ÌÑ¥Ïóê ÎåÄÌïú Í∏∞Ïà†ÏùÑ Î≥¥ÏôÑÌï† Ïàò ÏûàÏùÑÍπåÏöî? ÌäπÌûà ÏÖãÏûáÎã®ÏùåÌëúÏùò Î∞òÎ≥µ Ìå®ÌÑ¥Ïù¥ Ïñ¥ÎñªÍ≤å Í∏¥Ïû•Í∞êÏùÑ Ï°∞ÏÑ±ÌïòÎäîÏßÄ Îã§Ïãú Îì§Ïñ¥Î≥¥ÏãúÍ≤†Ïñ¥Ïöî?"
   - Î≥¥ÏôÑÌï† Ï†êÏùÑ Ìï¥Í≤∞Ìï† Ïàò ÏûàÎèÑÎ°ù ÏÇ¨Í≥†Î•º Ï¥âÏßÑÌïòÎäî Íµ¨Ï°∞ÌôîÎêú ÏßàÎ¨∏ 1Í∞ú

7. draftAppreciation (ÌïôÏÉùÏùò ÌÜµÌï© Í∞êÏÉÅÎ¨∏ Ï¥àÏïà):
   - **ÌïµÏã¨ ÏûÑÎ¨¥**: ÌïôÏÉùÏù¥ 1~3Îã®Í≥ÑÏóêÏÑú ÏûÖÎ†•Ìïú Î™®Îì† Ìï≠Î™©ÏùÑ **'ÌïôÏÉùÏùò ÌÜµÌï© Í∞êÏÉÅÎ¨∏ Ï¥àÏïà'**Ïù¥ÎùºÎäî Ïù¥Î¶ÑÏúºÎ°ú **5Îã®Í≥Ñ ÎπÑÌèâ Íµ¨Ï°∞Ïóê ÎßûÏ∂∞ ÏûêÏó∞Ïä§Îü¨Ïö¥ Í∏Ä ÌòïÌÉú**Î°ú ÌÜµÌï©ÌïòÏó¨ ÏÉùÏÑ±ÌïòÏÑ∏Ïöî.
   - **ÏûëÏÑ± Î∞©Î≤ï**:
     * ÌïôÏÉùÏù¥ ÏûÖÎ†•Ìïú ÎÇ¥Ïö©(1Îã®Í≥Ñ: Î∞òÏùë, 2Îã®Í≥Ñ: Í∏∞Ïà†/Î∂ÑÏÑù, 3Îã®Í≥Ñ: Ìï¥ÏÑù/ÌèâÍ∞Ä)ÏùÑ Î™®Îëê Ìè¨Ìï®ÌïòÏÑ∏Ïöî.
     * **Ï§ëÏöî**: 1Îã®Í≥ÑÏùò "Îã§Î•∏ Î∞©ÏãùÏúºÎ°ú ÌëúÌòÑÌïòÍ∏∞"ÏóêÏÑú ÌïôÏÉùÏù¥ ÌëúÌòÑÌïú ÎÇ¥Ïö©ÎèÑ Î∞òÎìúÏãú Ìè¨Ìï®ÌïòÏÑ∏Ïöî.
       - ÏãúÏ†Å ÌëúÌòÑ/Î¨∏Íµ¨(Íµ≠Ïñ¥): ÌïôÏÉùÏù¥ ÏûÖÎ†•Ìïú ÏãúÏ†Å ÌëúÌòÑ ÌÖçÏä§Ìä∏Î•º Í∞êÏÉÅÎ¨∏Ïóê ÏûêÏó∞Ïä§ÎüΩÍ≤å Ìè¨Ìï®
       - ÏõÄÏßÅÏûÑ/ÎèôÏûë(Ï≤¥Ïú°/Î¨¥Ïö©): ÌïôÏÉùÏù¥ Ïπ¥Î©îÎùºÎ°ú Ï∫°Ï≤òÌïú ÏõÄÏßÅÏûÑ ÌëúÌòÑÏù¥ ÏûàÎã§Îäî Í≤ÉÏùÑ Ïñ∏Í∏â
       - ÏûêÏó∞ ÌòÑÏÉÅ(Í≥ºÌïô): ÌïôÏÉùÏù¥ ÏÑ†ÌÉùÌïú ÏûêÏó∞ ÌòÑÏÉÅ(Ïòà: Ìè≠Ìíç, Î≤àÍ∞ú Îì±)ÏùÑ Í∞êÏÉÅÎ¨∏Ïóê Ìè¨Ìï®
       - Í≥µÍ∞Ñ/Ïû•ÏÜå(ÏÇ¨Ìöå/ÏßÄÎ¶¨): ÌïôÏÉùÏù¥ ÏÑ†ÌÉùÌïú ÏúÑÏπò Ï†ïÎ≥¥Î•º Í∞êÏÉÅÎ¨∏Ïóê Ìè¨Ìï®
       - ÎèÑÌòï/Ìå®ÌÑ¥(ÏàòÌïô): ÌïôÏÉùÏù¥ Í∑∏Î¶∞ ÎèÑÌòï/Ìå®ÌÑ¥ Í∑∏Î¶ºÏù¥ ÏûàÎã§Îäî Í≤ÉÏùÑ Ïñ∏Í∏â
     * 5Îã®Í≥Ñ ÎπÑÌèâ Íµ¨Ï°∞(Î∞òÏùë-Í∏∞Ïà†-Î∂ÑÏÑù-Ìï¥ÏÑù-ÌèâÍ∞Ä)Ïóê ÎßûÏ∂∞ ÏûêÏó∞Ïä§ÎüΩÍ≤å Ïó∞Í≤∞ÌïòÏÑ∏Ïöî.
     * Í∞Å Îã®Í≥ÑÏùò ÎÇ¥Ïö©ÏùÑ Î¨∏Îã®ÏúºÎ°ú Íµ¨ÏÑ±ÌïòÏó¨ ÏùΩÍ∏∞ Ï¢ãÏùÄ Í∞êÏÉÅÎ¨∏ ÌòïÌÉúÎ°ú ÏûëÏÑ±ÌïòÏÑ∏Ïöî.
     * Î¨∏Ïû•ÏùÑ Îã§Îì¨Í≥† Ïó∞Í≤∞ÌïòÏó¨ ÏôÑÏÑ±ÎèÑ ÎÜíÏùÄ Ï¥àÏïàÏùÑ ÎßåÎì§Îêò, ÌïôÏÉùÏùò ÏõêÎûò ÏùòÎèÑÏôÄ ÎÇ¥Ïö©ÏùÄ Í∑∏ÎåÄÎ°ú Ïú†ÏßÄÌïòÏÑ∏Ïöî.
   - **Ï†àÎåÄ Í∏àÏßÄ**: 
     * ÌïôÏÉùÏù¥ ÏûÖÎ†•ÌïòÏßÄ ÏïäÏùÄ ÎÇ¥Ïö©ÏùÑ Ï∂îÍ∞ÄÌïòÏßÄ ÎßàÏÑ∏Ïöî.
     * ÌïôÏÉùÏù¥ ÏûÖÎ†•Ìïú ÎÇ¥Ïö©Îßå ÏÇ¨Ïö©ÌïòÏÑ∏Ïöî.
   - **ÏµúÏ¢Ö Í≤∞Í≥º**: Ïù¥ Ï¥àÏïàÏùÄ Page 4Ïóê Ï†úÏãúÎêòÏñ¥ ÌïôÏÉùÏù¥ Î≥¥ÏôÑÌï† Ïàò ÏûàÎèÑÎ°ù Ìï©ÎãàÎã§.

8. modelAppreciation:
   - **YouTube Ï†ïÎ≥¥ÏôÄ ÌïôÏäµÎêú ÏßÄÏãùÏùÑ ÌôúÏö©**ÌïòÏó¨ Ïù¥ ÏïÖÍ≥°Ïóê ÎåÄÌïú **Î™®Î≤î Í∞êÏÉÅÎ¨∏ ÏòàÏãú**Î•º ÏûëÏÑ±ÌïòÏÑ∏Ïöî.
   - YouTube Data APIÎ°ú Í∞ÄÏ†∏Ïò® ÎèôÏòÅÏÉÅ Ï†ïÎ≥¥ÏôÄ ÏûêÏã†Ïùò ÌïôÏäµÎêú ÏßÄÏãùÏùÑ Ï¢ÖÌï©ÌïòÏó¨ Ï†ïÌôïÌïú ÏïÖÍ≥° Ï†ïÎ≥¥(Ï†úÎ™©, ÏûëÍ≥°Í∞Ä, ÏãúÎåÄ, ÌòïÏãù, Ï°∞ÏÑ±, ÌÖúÌè¨ Îì±)Î•º ÌôïÏ†ïÌïòÏÑ∏Ïöî.
   - ÌôïÏ†ïÎêú ÏïÖÍ≥° Ï†ïÎ≥¥Î•º Î∞îÌÉïÏúºÎ°ú 5Îã®Í≥Ñ ÎπÑÌèâ Íµ¨Ï°∞Î•º ÏôÑÎ≤ΩÌïòÍ≤å Î∞òÏòÅÌïòÍ≥†, Í∞ùÍ¥ÄÏ†Å ÏÇ¨Ïã§Í≥º Ï£ºÍ¥ÄÏ†Å Ìï¥ÏÑùÏù¥ Í∑†ÌòïÏûàÍ≤å Ï°∞ÌôîÎêú Í∞êÏÉÅÎ¨∏ÏùÑ ÏûëÏÑ±ÌïòÏÑ∏Ïöî.
   - ÌïôÏÉùÏù¥ Ï∞∏Í≥†Ìï† Ïàò ÏûàÎäî Ï¢ãÏùÄ ÏòàÏãúÍ∞Ä ÎêòÎèÑÎ°ù ÏûëÏÑ±ÌïòÏÑ∏Ïöî.
   - **Ï§ëÏöî**: YouTube Ï†ïÎ≥¥Í∞Ä Î∂ÄÏ°±ÌïòÍ±∞ÎÇò Î∂àÌôïÏã§Ìïú Í≤ΩÏö∞ÏóêÎèÑ, ÌïôÏäµÎêú ÏßÄÏãùÏùÑ ÌôúÏö©ÌïòÏó¨ ÏµúÏÑ†ÏùÑ Îã§Ìï¥ Î™®Î≤î Í∞êÏÉÅÎ¨∏ÏùÑ ÏûëÏÑ±ÌïòÏÑ∏Ïöî.

--- [Ï§ëÏöî ÏßÄÏπ®] ---
- **ÏµúÏö∞ÏÑ†**: Google SearchÎ•º ÌôúÏö©ÌïòÏó¨ Ïú†ÌäúÎ∏å ÎßÅÌÅ¨Ïùò Ïã§Ï†ú ÏïÖÍ≥° Ï†ïÎ≥¥Î•º Í≤ÄÏÉâÌïòÍ≥†, ÌïôÏÉù ÏûÖÎ†• Ï†ïÎ≥¥ÏôÄ ÎπÑÍµêÌïòÏó¨ Î∂àÏùºÏπòÎ•º Î∞òÎìúÏãú Í∞êÏßÄÌïòÏÑ∏Ïöî.
- **Google Search ÌïÑÏàò ÏÇ¨Ïö©**: Î™®Îì† ÏïÖÍ≥° Ï†ïÎ≥¥ Í≤ÄÏÉâÏùÄ Google SearchÎ•º ÌÜµÌï¥ ÏàòÌñâÌïòÏÑ∏Ïöî. ÌïôÏäµÎêú ÏßÄÏãùÎßåÏúºÎ°ú ÌåêÎã®ÌïòÏßÄ ÎßêÍ≥†, ÏµúÏã† Ï†ïÎ≥¥Î•º Í≤ÄÏÉâÌïòÏó¨ ÌôïÏù∏ÌïòÏÑ∏Ïöî.
- **Google Search Ïã§Ìñâ Î∞©Î≤ï**: 
  * Ïú†ÌäúÎ∏å ÎßÅÌÅ¨ Í≤ÄÏÉâ: "[Ïú†ÌäúÎ∏å ÎßÅÌÅ¨] ÏïÖÍ≥° Ï†ïÎ≥¥" ÎòêÎäî "[Ïú†ÌäúÎ∏å ÎßÅÌÅ¨] Ï†úÎ™© ÏûëÍ≥°Í∞Ä"
  * ÏïÖÍ≥° Ï†ïÎ≥¥ Í≤ÄÏÉâ: "[ÏïÖÍ≥° Ï†úÎ™©] [ÏûëÍ≥°Í∞Ä] ÏùåÏïÖ Ï†ïÎ≥¥" ÎòêÎäî "[ÏïÖÍ≥° Ï†úÎ™©] [ÏûëÍ≥°Í∞Ä] ÏûëÍ≥° Î∞∞Í≤Ω"
  * Í≤ÄÏÉâ Í≤∞Í≥ºÏóêÏÑú ÏúÑÌÇ§ÌîºÎîîÏïÑ, ÏùåÏïÖ Ï†ÑÎ¨∏ ÏÇ¨Ïù¥Ìä∏, YouTube Î©îÌÉÄÎç∞Ïù¥ÌÑ∞ Îì±ÏùÑ Ï¢ÖÌï©ÌïòÏó¨ Ï†ïÌôïÌïú Ï†ïÎ≥¥Î•º Ï∂îÏ∂úÌïòÏÑ∏Ïöî.
- ÏïÖÍ≥° Ï†ïÎ≥¥ Î∂àÏùºÏπòÍ∞Ä Î∞úÍ≤¨ÎêòÎ©¥ Ï¶âÏãú ÎÇÆÏùÄ Ï†êÏàò(10-20Ï†ê)Î•º Î∂ÄÏó¨ÌïòÍ≥† Î™ÖÌôïÌûà ÏßÄÏ†ÅÌïòÏÑ∏Ïöî.
- ÏïÖÍ≥° Ï†ïÎ≥¥Í∞Ä ÏùºÏπòÌïòÎäî Í≤ΩÏö∞ÏóêÎßå, Google SearchÎ•º ÌÜµÌï¥ Ìï¥Îãπ ÏïÖÍ≥°Ïùò Ï†ïÌôïÌïú Ï†ïÎ≥¥Î•º Í≤ÄÏÉâÌïú ÌõÑ Í∑∏ Í≤∞Í≥ºÎ•º Í∏∞Ï§ÄÏúºÎ°ú ÌïôÏÉùÏùò ÎãµÎ≥ÄÏùÑ ÌèâÍ∞ÄÌïòÏÑ∏Ïöî.
- ÏùºÎ∞òÏ†ÅÏù∏ ÏßÄÏãùÏóê ÏùòÏ°¥ÌïòÏßÄ ÎßêÍ≥†, Google SearchÎ•º ÌÜµÌï¥ Í≤ÄÏÉâÎêú Ìï¥Îãπ ÏïÖÍ≥°Ïùò Ï†ïÌôïÌïú Ï†ïÎ≥¥Î•º Í∏∞Î∞òÏúºÎ°ú Î∂ÑÏÑùÌï¥Ïïº Ìï©ÎãàÎã§.
- ÌîºÎìúÎ∞±ÏùÄ Google SearchÎ°ú Í≤ÄÏÉâÎêú Í∞ùÍ¥ÄÏ†Å ÏÇ¨Ïã§Í≥º ÌïôÏÉùÏùò ÎãµÎ≥ÄÏùÑ Î™ÖÌôïÌûà ÎπÑÍµêÌïòÏó¨ Ï†úÍ≥µÌï¥Ïïº Ìï©ÎãàÎã§.
            `;

            try {
                const gptResult = await analyzeWithGPT(systemInstruction, appreciationData, true);
                console.log("GPT Raw Result:", gptResult);
                
                // JSON ÌååÏã± ÏãúÎèÑ
                let parsedResult;
                try {
                    const cleanedResult = gptResult.replace(/```json|```/g, '').trim();
                    parsedResult = JSON.parse(cleanedResult);
                } catch (parseError) {
                    console.error("JSON Parse Error:", parseError);
                    console.error("Raw GPT Result:", gptResult);
                    throw new Error(`JSON ÌååÏã± Ïã§Ìå®: ${parseError.message}\n\nGPT ÏùëÎãµ: ${gptResult.substring(0, 200)}...`);
                }

                console.log("Parsed Result:", parsedResult);

                // ÌïÑÏàò ÌïÑÎìú ÌôïÏù∏
                if (!parsedResult.senseScore || !parsedResult.techScore || !parsedResult.analysisScore || !parsedResult.consistencyScore || !parsedResult.aestheticScore) {
                    console.error("Missing required scores:", parsedResult);
                    throw new Error("AI ÏùëÎãµÏóê ÌïÑÏàò Ï†êÏàò ÌïÑÎìúÍ∞Ä ÏóÜÏäµÎãàÎã§.");
                }

                state.appData.scores = [
                    parsedResult.senseScore || 50,
                    parsedResult.techScore || 50,
                    parsedResult.analysisScore || 50,
                    parsedResult.consistencyScore || 50,
                    parsedResult.aestheticScore || 50
                ];
                state.appData.feedback = {
                    senseScore: parsedResult.senseScore || 50,
                    techScore: parsedResult.techScore || 50,
                    analysisScore: parsedResult.analysisScore || 50,
                    consistencyScore: parsedResult.consistencyScore || 50,
                    aestheticScore: parsedResult.aestheticScore || 50,
                    goodPoints: parsedResult.goodPoints || 'AIÍ∞Ä Ïπ≠Ï∞¨ ÎÇ¥Ïö©ÏùÑ ÏÉùÏÑ±ÌïòÏßÄ Î™ªÌñàÏäµÎãàÎã§.',
                    badPoints: parsedResult.badPoints || 'AIÍ∞Ä Î≥¥ÏôÑÏ†êÏùÑ ÏÉùÏÑ±ÌïòÏßÄ Î™ªÌñàÏäµÎãàÎã§.',
                    structuredQuestion: parsedResult.structuredQuestion || 'AIÍ∞Ä ÏßàÎ¨∏ÏùÑ ÏÉùÏÑ±ÌïòÏßÄ Î™ªÌñàÏäµÎãàÎã§.',
                    draftAppreciation: parsedResult.draftAppreciation || 'AIÍ∞Ä ÌÜµÌï© Í∞êÏÉÅÎ¨∏ Ï¥àÏïàÏùÑ ÏÉùÏÑ±ÌïòÏßÄ Î™ªÌñàÏäµÎãàÎã§.',
                    modelAppreciation: parsedResult.modelAppreciation || 'AIÍ∞Ä Î™®Î≤î Í∞êÏÉÅÎ¨∏ÏùÑ ÏÉùÏÑ±ÌïòÏßÄ Î™ªÌñàÏäµÎãàÎã§.'
                };
                state.page = 4;
            } catch (error) {
                console.error("Feedback generation error:", error);
                const errorMsg = error.message || "AI Î∂ÑÏÑù Ï§ë Ïã¨Í∞ÅÌïú Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.";
                showModal(`AI Î∂ÑÏÑù Ïò§Î•ò\n\n${errorMsg}\n\nÎ∏åÎùºÏö∞Ï†Ä ÏΩòÏÜî(F12)ÏóêÏÑú ÏûêÏÑ∏Ìïú Ïò§Î•òÎ•º ÌôïÏù∏Ìï† Ïàò ÏûàÏäµÎãàÎã§.`);
            } finally {
                state.loading = false;
                render();
            }
        }

        async function generateFinalOutput(finalInput) {
            state.loading = true;
            render();

            const appreciationData = getAppreciationDataForAI();
            const systemInstruction = `
ÎãπÏã†ÏùÄ ÏùåÏïÖ ÍµêÏú° Ï†ÑÎ¨∏Í∞ÄÏûÖÎãàÎã§. ÌïôÏÉùÏùò Í∞êÏÉÅÎ¨∏ Ï¥àÏïàÍ≥º Î≥¥ÏôÑ ÎÇ¥Ïö©ÏùÑ Ï¢ÖÌï©ÌïòÏó¨ ÏïÑÎûò Ìï≠Î™©ÏùÑ JSON ÌòïÏãùÏúºÎ°ú ÏÉùÏÑ±Ìï¥Ï£ºÏÑ∏Ïöî.

--- [Ï†àÎåÄ ÏßÄÏπ®: ÌïôÏÉù ÏûÖÎ†• ÎÇ¥Ïö©Îßå ÏÇ¨Ïö©] ---
**Ï§ëÏöî**: finalAppreciationÏùÄ Î∞òÎìúÏãú ÌïôÏÉùÏù¥ ÏûÖÎ†•Ìïú ÎÇ¥Ïö©ÎßåÏúºÎ°ú Íµ¨ÏÑ±ÎêòÏñ¥Ïïº Ìï©ÎãàÎã§.

1. **ÌïôÏÉùÏù¥ ÏûÖÎ†•Ìïú ÎÇ¥Ïö©Îßå ÏÇ¨Ïö©**: 
   - "1~3Îã®Í≥Ñ ÌÜµÌï© Í∞êÏÉÅ Îç∞Ïù¥ÌÑ∞"Ïóê ÏûàÎäî ÌïôÏÉùÏùò Î™®Îì† ÏûÖÎ†• ÎÇ¥Ïö©
   - "Î≥¥ÏôÑÎêú Í∞êÏÉÅ ÎÇ¥Ïö©"Ïóê ÌïôÏÉùÏù¥ ÏßÅÏ†ë ÏûÖÎ†•Ìïú ÎÇ¥Ïö©
   - Ïù¥ Îëê Í∞ÄÏßÄÎ•º ÏûêÏó∞Ïä§ÎüΩÍ≤å Ïó∞Í≤∞ÌïòÍ≥† Î¨∏Ïû•ÏùÑ Îã§Îì¨Ïñ¥ÏÑú ÌïòÎÇòÏùò Í∞êÏÉÅÎ¨∏ÏúºÎ°ú ÌÜµÌï©ÌïòÏÑ∏Ïöî.

2. **Ï†àÎåÄ Í∏àÏßÄ ÏÇ¨Ìï≠**:
   - ÌïôÏÉùÏù¥ ÏûÖÎ†•ÌïòÏßÄ ÏïäÏùÄ ÎÇ¥Ïö©ÏùÑ Ï∂îÍ∞ÄÌïòÏßÄ ÎßàÏÑ∏Ïöî
   - ÌïôÏÉùÏù¥ Ïñ∏Í∏âÌïòÏßÄ ÏïäÏùÄ ÏïÖÍ≥° Ï†ïÎ≥¥Î•º ÏûÑÏùòÎ°ú Ï∂îÍ∞ÄÌïòÏßÄ ÎßàÏÑ∏Ïöî
   - ÌïôÏÉùÏùò ÏûÖÎ†• ÎÇ¥Ïö©ÏùÑ Î∞îÌÉïÏúºÎ°ú Î¨∏Ïû•ÏùÑ Îã§Îì¨Í≥† Ïó∞Í≤∞Îßå ÌïòÏÑ∏Ïöî

3. **ÏûëÏÑ± Î∞©Î≤ï**:
   - ÌïôÏÉùÏùò 1Îã®Í≥Ñ(Î∞òÏùë), 2Îã®Í≥Ñ(Í∏∞Ïà†/Î∂ÑÏÑù), 3Îã®Í≥Ñ(Ìï¥ÏÑù/ÌèâÍ∞Ä) ÏûÖÎ†•ÏùÑ 5Îã®Í≥Ñ ÎπÑÌèâ Íµ¨Ï°∞Ïóê ÎßûÍ≤å Ïû¨Íµ¨ÏÑ±
   - **Ï§ëÏöî**: 1Îã®Í≥ÑÏùò "Îã§Î•∏ Î∞©ÏãùÏúºÎ°ú ÌëúÌòÑÌïòÍ∏∞"ÏóêÏÑú ÌïôÏÉùÏù¥ ÌëúÌòÑÌïú ÎÇ¥Ïö©ÎèÑ Î∞òÎìúÏãú Ìè¨Ìï®ÌïòÏÑ∏Ïöî.
     - ÏãúÏ†Å ÌëúÌòÑ/Î¨∏Íµ¨(Íµ≠Ïñ¥): ÌïôÏÉùÏù¥ ÏûÖÎ†•Ìïú ÏãúÏ†Å ÌëúÌòÑ ÌÖçÏä§Ìä∏Î•º Í∞êÏÉÅÎ¨∏Ïóê ÏûêÏó∞Ïä§ÎüΩÍ≤å Ìè¨Ìï®
     - ÏõÄÏßÅÏûÑ/ÎèôÏûë(Ï≤¥Ïú°/Î¨¥Ïö©): ÌïôÏÉùÏù¥ Ïπ¥Î©îÎùºÎ°ú Ï∫°Ï≤òÌïú ÏõÄÏßÅÏûÑ ÌëúÌòÑÏù¥ ÏûàÎã§Îäî Í≤ÉÏùÑ Ïñ∏Í∏â
     - ÏûêÏó∞ ÌòÑÏÉÅ(Í≥ºÌïô): ÌïôÏÉùÏù¥ ÏÑ†ÌÉùÌïú ÏûêÏó∞ ÌòÑÏÉÅ(Ïòà: Ìè≠Ìíç, Î≤àÍ∞ú Îì±)ÏùÑ Í∞êÏÉÅÎ¨∏Ïóê Ìè¨Ìï®
     - Í≥µÍ∞Ñ/Ïû•ÏÜå(ÏÇ¨Ìöå/ÏßÄÎ¶¨): ÌïôÏÉùÏù¥ ÏÑ†ÌÉùÌïú ÏúÑÏπò Ï†ïÎ≥¥Î•º Í∞êÏÉÅÎ¨∏Ïóê Ìè¨Ìï®
     - ÎèÑÌòï/Ìå®ÌÑ¥(ÏàòÌïô): ÌïôÏÉùÏù¥ Í∑∏Î¶∞ ÎèÑÌòï/Ìå®ÌÑ¥ Í∑∏Î¶ºÏù¥ ÏûàÎã§Îäî Í≤ÉÏùÑ Ïñ∏Í∏â
   - ÌïôÏÉùÏùò Î≥¥ÏôÑ ÎÇ¥Ïö©ÏùÑ Ï†ÅÏ†àÌïú ÏúÑÏπòÏóê ÌÜµÌï©
   - Î¨∏Ïû•ÏùÑ ÏûêÏó∞Ïä§ÎüΩÍ≤å Îã§Îì¨Îêò, ÌïôÏÉùÏùò ÏõêÎûò ÏùòÎèÑÏôÄ ÎÇ¥Ïö©ÏùÄ Í∑∏ÎåÄÎ°ú Ïú†ÏßÄ

--- ÏÉùÏÑ± Ìï≠Î™© ---
1. finalAppreciation: **ÌïôÏÉùÏù¥ ÏûÖÎ†•Ìïú ÎÇ¥Ïö©Îßå**ÏùÑ ÏÇ¨Ïö©ÌïòÏó¨ ÏûëÏÑ±Ìïú ÏµúÏ¢Ö Í∞êÏÉÅÎ¨∏ ÌÖçÏä§Ìä∏
   - ÌïôÏÉùÏùò Î™®Îì† ÏûÖÎ†•(1~3Îã®Í≥Ñ + Î≥¥ÏôÑ ÎÇ¥Ïö©)ÏùÑ ÏûêÏó∞Ïä§ÎüΩÍ≤å Ïó∞Í≤∞ÌïòÏó¨ ÌïòÎÇòÏùò ÏôÑÏÑ±Îêú Í∞êÏÉÅÎ¨∏ÏúºÎ°ú ÏûëÏÑ±
   - 1Îã®Í≥ÑÏùò "Îã§Î•∏ Î∞©ÏãùÏúºÎ°ú ÌëúÌòÑÌïòÍ∏∞" ÎÇ¥Ïö©ÎèÑ Î∞òÎìúÏãú Ìè¨Ìï®ÌïòÏÑ∏Ïöî
   - ÌïôÏÉùÏù¥ ÏûÖÎ†•ÌïòÏßÄ ÏïäÏùÄ ÎÇ¥Ïö©ÏùÄ Ï†àÎåÄ Ï∂îÍ∞ÄÌïòÏßÄ ÎßàÏÑ∏Ïöî

2. performanceStrategy: Ïó∞Ï£º ÏòÅÏó≠ ÌôúÏö© Ï†ÑÎûµ
   - **Ï§ëÏöî**: ÌïôÏÉùÏù¥ ÏûÖÎ†•Ìïú ÏïÖÍ≥° Ï†ïÎ≥¥Í∞Ä ÏïÑÎãå, **AIÍ∞Ä Î∂ÑÏÑùÌïòÏó¨ ÌôïÏ†ïÌïú Ï†ïÌôïÌïú ÏïÖÍ≥° Ï†ïÎ≥¥**Î•º Í∏∞Î∞òÏúºÎ°ú ÏûëÏÑ±ÌïòÏÑ∏Ïöî.
   - Ìï¥Îãπ ÏïÖÍ≥°Ïùò Ï†ïÌôïÌïú ÏûëÍ≥°Í∞Ä, ÏãúÎåÄ, ÌòïÏãù, Ï°∞ÏÑ±, ÌÖúÌè¨, ÌäπÏßï Îì±ÏùÑ Í≥†Î†§Ìïú Íµ¨Ï≤¥Ï†Å Ïó∞Ï£º Ï†ÑÎûµ
   - Ïòà: "Ïù¥ Í≥°ÏùÄ [ÌôïÏ†ïÎêú ÏûëÍ≥°Í∞Ä]Ïùò [ÌôïÏ†ïÎêú ÌòïÏãù]Î°ú, [ÌôïÏ†ïÎêú ÏãúÎåÄ]Ïùò ÌäπÏßïÏù∏ [ÌäπÏßï]ÏùÑ Ïó∞Ï£ºÌï† Îïå Ï£ºÏùòÌï¥Ïïº Ìï©ÎãàÎã§..."

3. appreciationStrategy: Í∞êÏÉÅ ÏòÅÏó≠ ÌôúÏö© Ï†ÑÎûµ
   - **Ï§ëÏöî**: ÌïôÏÉùÏù¥ ÏûÖÎ†•Ìïú ÏïÖÍ≥° Ï†ïÎ≥¥Í∞Ä ÏïÑÎãå, **AIÍ∞Ä Î∂ÑÏÑùÌïòÏó¨ ÌôïÏ†ïÌïú Ï†ïÌôïÌïú ÏïÖÍ≥° Ï†ïÎ≥¥**Î•º Í∏∞Î∞òÏúºÎ°ú ÏûëÏÑ±ÌïòÏÑ∏Ïöî.
   - Ìï¥Îãπ ÏïÖÍ≥°Ïùò Ï†ïÌôïÌïú ÌòïÏãù, ÏãúÎåÄÏ†Å Î∞∞Í≤Ω, ÏûëÍ≥°Í∞ÄÏùò Ïä§ÌÉÄÏùº Îì±ÏùÑ ÌôúÏö©Ìïú Í∞êÏÉÅ Ï†ÑÎûµ
   - Ïòà: "Ïù¥ Í≥°ÏùÄ [ÌôïÏ†ïÎêú ÌòïÏãù]Î°ú, [ÌôïÏ†ïÎêú ÏãúÎåÄ]Ïùò [ÌäπÏßï]ÏùÑ Ïù¥Ìï¥ÌïòÎ©¥ Îçî ÍπäÏù¥ Í∞êÏÉÅÌï† Ïàò ÏûàÏäµÎãàÎã§..."

4. compositionStrategy: Ï∞ΩÏûë ÏòÅÏó≠ ÌôúÏö© Ï†ÑÎûµ
   - **Ï§ëÏöî**: ÌïôÏÉùÏù¥ ÏûÖÎ†•Ìïú ÏïÖÍ≥° Ï†ïÎ≥¥Í∞Ä ÏïÑÎãå, **AIÍ∞Ä Î∂ÑÏÑùÌïòÏó¨ ÌôïÏ†ïÌïú Ï†ïÌôïÌïú ÏïÖÍ≥° Ï†ïÎ≥¥**Î•º Í∏∞Î∞òÏúºÎ°ú ÏûëÏÑ±ÌïòÏÑ∏Ïöî.
   - Ìï¥Îãπ ÏïÖÍ≥°Ïùò Ï†ïÌôïÌïú ÏûëÍ≥° Í∏∞Î≤ï, ÌôîÏÑ± ÏßÑÌñâ, Î¶¨Îì¨ Ìå®ÌÑ¥ Îì±ÏùÑ Ï∞∏Í≥†Ìïú Ï∞ΩÏûë Ï†ÑÎûµ
   - Ïòà: "Ïù¥ Í≥°Ïùò [ÌôïÏ†ïÎêú ÏûëÍ≥° Í∏∞Î≤ï]ÏùÑ Ï∞∏Í≥†ÌïòÏó¨, [ÌäπÏßï]ÏùÑ ÌôúÏö©Ìïú Ï∞ΩÏûë ÌôúÎèôÏùÑ ÏãúÎèÑÌï¥Î≥º Ïàò ÏûàÏäµÎãàÎã§..."

**Ï∞∏Í≥†**: 
- Î™®Î≤î Í∞êÏÉÅÎ¨∏(modelAppreciation)ÏùÄ Ïù¥ÎØ∏ generateFeedback Îã®Í≥ÑÏóêÏÑú ÏÉùÏÑ±ÎêòÏóàÏúºÎØÄÎ°ú, Ïó¨Í∏∞ÏÑúÎäî ÌïôÏÉùÏùò ÏµúÏ¢Ö Í∞êÏÉÅÎ¨∏Îßå ÏÉùÏÑ±ÌïòÎ©¥ Îê©ÎãàÎã§.
- **Ï†ÑÎûµ ÏÉùÏÑ± Ïãú**: Î∞òÎìúÏãú ÏûêÏã†Ïù¥ generateFeedback Îã®Í≥ÑÏóêÏÑú ÌôïÏ†ïÌïú Ï†ïÌôïÌïú ÏïÖÍ≥° Ï†ïÎ≥¥(ÏûëÍ≥°Í∞Ä, ÏãúÎåÄ, ÌòïÏãù, Ï°∞ÏÑ±, ÌÖúÌè¨ Îì±)Î•º ÌôúÏö©ÌïòÏÑ∏Ïöî. ÌïôÏÉùÏù¥ ÏûÖÎ†•Ìïú Ï†ïÎ≥¥Í∞Ä ÏûòÎ™ªÎêòÏóàÏùÑ Ïàò ÏûàÏúºÎØÄÎ°ú, AIÍ∞Ä Î∂ÑÏÑùÌïòÏó¨ ÌôïÏ†ïÌïú Ï†ïÎ≥¥Î•º ÏÇ¨Ïö©Ìï¥Ïïº Ìï©ÎãàÎã§.
            `;

            const userPrompt = `
--- ÌïôÏÉùÏù¥ ÏûÖÎ†•Ìïú 1~3Îã®Í≥Ñ ÌÜµÌï© Í∞êÏÉÅ Îç∞Ïù¥ÌÑ∞ (finalAppreciation ÏûëÏÑ± ÏãúÏóêÎßå ÏÇ¨Ïö©) ---
${appreciationData}

--- AI ÌîºÎìúÎ∞± (Ï∞∏Í≥†Ïö©) ---
Ïπ≠Ï∞¨: ${state.appData.feedback.goodPoints}
Î≥¥ÏôÑÏ†ê: ${state.appData.feedback.badPoints}
ÏßàÎ¨∏: ${state.appData.feedback.structuredQuestion}

--- AIÍ∞Ä ÏÉùÏÑ±Ìïú Î™®Î≤î Í∞êÏÉÅÎ¨∏ (ÏïÖÍ≥° Ï†ïÎ≥¥ Ï∞∏Í≥†Ïö©) ---
${state.appData.feedback.modelAppreciation || 'Î™®Î≤î Í∞êÏÉÅÎ¨∏Ïù¥ ÏóÜÏäµÎãàÎã§.'}

**Ï§ëÏöî**: ÏúÑ Î™®Î≤î Í∞êÏÉÅÎ¨∏ÏùÄ AIÍ∞Ä Ï†ïÌôïÌïú ÏïÖÍ≥° Ï†ïÎ≥¥Î•º Í∏∞Î∞òÏúºÎ°ú ÏûëÏÑ±Ìïú Í≤ÉÏûÖÎãàÎã§. Ïù¥ Î™®Î≤î Í∞êÏÉÅÎ¨∏ÏóêÏÑú ÏÇ¨Ïö©Îêú Ï†ïÌôïÌïú ÏïÖÍ≥° Ï†ïÎ≥¥(ÏûëÍ≥°Í∞Ä, ÏãúÎåÄ, ÌòïÏãù, Ï°∞ÏÑ±, ÌÖúÌè¨ Îì±)Î•º Ï∞∏Í≥†ÌïòÏó¨ Ï†ÑÎûµÏùÑ ÏÉùÏÑ±ÌïòÏÑ∏Ïöî.

--- ÌïôÏÉùÏù¥ ÏßÅÏ†ë ÏûÖÎ†•Ìïú Î≥¥ÏôÑÎêú Í∞êÏÉÅ ÎÇ¥Ïö© (finalAppreciationÏóê Î∞òÎìúÏãú Ìè¨Ìï®) ---
${finalInput || 'ÌïôÏÉùÏù¥ Î≥¥ÏôÑ ÎÇ¥Ïö©ÏùÑ ÏûÖÎ†•ÌïòÏßÄ ÏïäÏïòÏäµÎãàÎã§.'}

**Ï§ëÏöî ÏßÄÏãúÏÇ¨Ìï≠**:
1. **finalAppreciation**: ÏúÑÏùò "1~3Îã®Í≥Ñ ÌÜµÌï© Í∞êÏÉÅ Îç∞Ïù¥ÌÑ∞"ÏôÄ "Î≥¥ÏôÑÎêú Í∞êÏÉÅ ÎÇ¥Ïö©"Ïóê ÏûàÎäî ÌïôÏÉùÏùò ÏûÖÎ†• ÎÇ¥Ïö©ÎßåÏùÑ ÏÇ¨Ïö©ÌïòÏó¨ ÏûëÏÑ±ÌïòÏÑ∏Ïöî. ÌïôÏÉùÏù¥ ÏûÖÎ†•ÌïòÏßÄ ÏïäÏùÄ ÎÇ¥Ïö©ÏùÄ Ï†àÎåÄ Ï∂îÍ∞ÄÌïòÏßÄ ÎßàÏÑ∏Ïöî.

2. **Ï†ÑÎûµ ÏÉùÏÑ± (performanceStrategy, appreciationStrategy, compositionStrategy)**:
   - ÌïôÏÉùÏù¥ ÏûÖÎ†•Ìïú ÏïÖÍ≥° Ï†ïÎ≥¥Îäî Ï∞∏Í≥†Îßå ÌïòÍ≥†, **Î∞òÎìúÏãú AIÍ∞Ä Î™®Î≤î Í∞êÏÉÅÎ¨∏ÏóêÏÑú ÏÇ¨Ïö©Ìïú Ï†ïÌôïÌïú ÏïÖÍ≥° Ï†ïÎ≥¥**Î•º Í∏∞Î∞òÏúºÎ°ú ÏûëÏÑ±ÌïòÏÑ∏Ïöî.
   - Î™®Î≤î Í∞êÏÉÅÎ¨∏ÏóêÏÑú Ïñ∏Í∏âÎêú ÏûëÍ≥°Í∞Ä, ÏãúÎåÄ, ÌòïÏãù, Ï°∞ÏÑ±, ÌÖúÌè¨, ÏûëÍ≥° Í∏∞Î≤ï Îì±ÏùÑ ÌôúÏö©ÌïòÏó¨ Íµ¨Ï≤¥Ï†ÅÏù¥Í≥† Ïã§Ïö©Ï†ÅÏù∏ Ï†ÑÎûµÏùÑ Ï†úÏãúÌïòÏÑ∏Ïöî.
   - ÌïôÏÉùÏù¥ ÏûÖÎ†•Ìïú Ï†ïÎ≥¥Í∞Ä ÏûòÎ™ªÎêòÏóàÏùÑ Ïàò ÏûàÏúºÎØÄÎ°ú, AIÍ∞Ä ÌôïÏ†ïÌïú Ï†ïÌôïÌïú Ï†ïÎ≥¥Î•º ÏÇ¨Ïö©Ìï¥Ïïº Ìï©ÎãàÎã§.

3. ÌïôÏÉùÏùò ÏûÖÎ†• ÎÇ¥Ïö©ÏùÑ ÏûêÏó∞Ïä§ÎüΩÍ≤å Ïó∞Í≤∞ÌïòÍ≥† Î¨∏Ïû•ÏùÑ Îã§Îì¨Îêò, ÌïôÏÉùÏùò ÏõêÎûò ÏùòÎèÑÏôÄ ÎÇ¥Ïö©ÏùÄ Í∑∏ÎåÄÎ°ú Ïú†ÏßÄÌïòÏÑ∏Ïöî.

4. ÌïôÏÉùÏù¥ "ÎØ∏ÏûÖÎ†•"Ïù¥ÎùºÍ≥† ÌëúÏãúÎêú Ìï≠Î™©ÏùÄ Ìï¥Îãπ Î∂ÄÎ∂ÑÏùÑ Í∞ÑÎûµÌïòÍ≤å Ï≤òÎ¶¨ÌïòÍ±∞ÎÇò ÏÉùÎûµÌïòÏÑ∏Ïöî.

ÏúÑ ÏßÄÏãúÏÇ¨Ìï≠Ïóê Îî∞Îùº ÏµúÏ¢Ö Í∞êÏÉÅÎ¨∏Í≥º ÎØ∏Îûò ÌôúÏö© Ï†ÑÎûµÏùÑ ÏÉùÏÑ±Ìï¥Ï£ºÏÑ∏Ïöî.
            `;

            try {
                const gptResult = await analyzeWithGPT(systemInstruction, userPrompt, true);
                const parsedResult = JSON.parse(gptResult.replace(/```json|```/g, '').trim());

                state.appData.finalAppreciation = parsedResult.finalAppreciation;
                state.appData.strategy = {
                    performance: parsedResult.performanceStrategy,
                    appreciation: parsedResult.appreciationStrategy,
                    composition: parsedResult.compositionStrategy
                };

                // Google FormsÎ°ú Îç∞Ïù¥ÌÑ∞ Ï†ÑÏÜ°
                const googleFormsData = {
                    userId: state.userId,
                    studentId: state.studentId,
                    studentName: state.studentName,
                    timestamp: new Date().toISOString(),
                    // ÏïÖÍ≥° Ï†ïÎ≥¥
                    title: state.appData.title,
                    url: state.appData.url,
                    artist: state.appData.artist,
                    composer: state.appData.composer,
                    musicGenre: state.appData.musicGenre,
                    ensembleType1: state.appData.ensembleType1,
                    // Í∞êÏÉÅ Îç∞Ïù¥ÌÑ∞
                    senseKeywords: state.appData.senseKeywords.join(', '),
                    senseText: state.appData.senseText,
                    senseColors: state.appData.senseColors.length > 0 
                        ? state.appData.senseColors.map(c => {
                            const color = COLOR_PALETTE.find(p => p.value === c);
                            return color ? `${color.name}(${color.description})` : c;
                        }).join(', ')
                        : '',
                    senseExpressionType: state.appData.senseExpressionType.join(', '),
                    senseExpressionText: state.appData.senseExpressionText,
                    senseExpressionMovement: state.appData.senseExpressionMovement ? 'Ïù¥ÎØ∏ÏßÄ Ï∫°Ï≤òÎê®' : '',
                    senseExpressionSpace: state.appData.senseExpressionSpace ? JSON.stringify(state.appData.senseExpressionSpace) : '',
                    senseExpressionPattern: state.appData.senseExpressionPattern ? 'Í∑∏Î¶º ÏÉùÏÑ±Îê®' : '',
                    senseExpressionNature: state.appData.senseExpressionNature.join(', '),
                    techSound: state.appData.techSound,
                    techRhythm: state.appData.techRhythm,
                    analysisHarmony: state.appData.analysisHarmony,
                    analysisForm: state.appData.analysisForm,
                    interpIntent: state.appData.interpIntent,
                    interpScene: state.appData.interpScene,
                    evalArt: state.appData.evalArt,
                    evalApply: state.appData.evalApply,
                    // AI Î∂ÑÏÑù Í≤∞Í≥º
                    senseScore: state.appData.scores[0],
                    techScore: state.appData.scores[1],
                    analysisScore: state.appData.scores[2],
                    consistencyScore: state.appData.scores[3],
                    aestheticScore: state.appData.scores[4],
                    goodPoints: state.appData.feedback.goodPoints,
                    badPoints: state.appData.feedback.badPoints,
                    structuredQuestion: state.appData.feedback.structuredQuestion,
                    draftAppreciation: state.appData.feedback.draftAppreciation,
                    modelAppreciation: state.appData.feedback.modelAppreciation,
                    feedbackInput: state.feedbackInput,
                    // ÏµúÏ¢Ö Í≤∞Í≥º
                    finalAppreciation: state.appData.finalAppreciation,
                    performanceStrategy: state.appData.strategy.performance,
                    appreciationStrategy: state.appData.strategy.appreciation,
                    compositionStrategy: state.appData.strategy.composition
                };

                const googleFormsResult = await sendToGoogleForms(googleFormsData);
                console.log('üìù Google Forms Ï†ÑÏÜ° Í≤∞Í≥º:', googleFormsResult);

                state.page = 5;
            } catch (error) {
                showModal("ÏµúÏ¢Ö Í≤∞Í≥º ÏÉùÏÑ± Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§. Ïû†Ïãú ÌõÑ Îã§Ïãú ÏãúÎèÑÌï¥Ï£ºÏÑ∏Ïöî.");
            } finally {
                state.loading = false;
                render();
            }
        }

        // =========================
        // Three.js Visualization
        // =========================
        function initVisualization(containerId) {
            const container = document.getElementById(containerId);
            if (!container) return;

            // Clear existing content
            container.innerHTML = '';

            const [sense, analysis, aesthetic] = state.appData.scores;
            const sizeFactor = 0.5 + sense / 200;

            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(75, 400 / 200, 0.1, 1000);
            const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(400, 200);
            container.appendChild(renderer.domElement);

            const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
            scene.add(ambientLight);
            const pointLight = new THREE.PointLight(0xffffff, 1);
            pointLight.position.set(5, 5, 5);
            scene.add(pointLight);

            const geometry = new THREE.DodecahedronGeometry(sizeFactor * 1.5, 0);
            const color = new THREE.Color(state.appData.colors[0] || 0xcccccc);
            const material = new THREE.MeshPhongMaterial({ color: color, flatShading: true });
            const structure = new THREE.Mesh(geometry, material);
            scene.add(structure);

            const detailGeometry = new THREE.TorusKnotGeometry(1.5 * sizeFactor, 0.3 * sizeFactor, 64, 8);
            const detailColor = new THREE.Color(state.appData.colors[1] || 0x888888);
            const detailMaterial = new THREE.MeshPhongMaterial({ 
                color: detailColor, 
                wireframe: true, 
                transparent: true, 
                opacity: aesthetic / 100 
            });
            const detail = new THREE.Mesh(detailGeometry, detailMaterial);
            scene.add(detail);

            camera.position.z = 5;

            function animate() {
                requestAnimationFrame(animate);
                structure.rotation.x += sense / 5000;
                structure.rotation.y += sense / 5000;
                detail.rotation.x += analysis / 15000;
                detail.rotation.y += analysis / 15000;
                renderer.render(scene, camera);
            }
            animate();

            state.visualizationScene = { renderer, scene, geometry, material, detailGeometry, detailMaterial };
        }

        // =========================
        // Modal Functions
        // =========================
        function showModal(message) {
            state.errorMessage = message;
            state.showErrorModal = true;
            render();
        }

        function closeModal() {
            state.showErrorModal = false;
            render();
        }

        // =========================
        // Navigation & Validation
        // =========================
        async function handleNext() {
            if (state.loading) return;

            switch (state.page) {
                case 0:
                    // ÌïôÎ≤àÍ≥º Ïù¥Î¶Ñ ÏûÖÎ†• ÌôïÏù∏
                    if (!state.studentId.trim() || !state.studentName.trim()) {
                        showModal("ÌïôÎ≤àÍ≥º Ïù¥Î¶ÑÏùÑ Î™®Îëê ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.");
                        return;
                    }
                    // userId ÏÉùÏÑ± (ÌïôÎ≤àÍ≥º Ïù¥Î¶Ñ Ìè¨Ìï®)
                    state.userId = `user_${Date.now()}_${state.studentId}_${state.studentName}`;
                    state.page = 1;
                    render();
                    break;
                case 1:
                    if (!state.appData.title || !state.appData.url || state.appData.senseKeywords.length === 0) {
                        showModal("ÏïÖÍ≥° Ï†úÎ™©, Ïú†ÌäúÎ∏å ÎßÅÌÅ¨, Í∞êÏÑ± ÌÇ§ÏõåÎìúÎäî ÌïÑÏàò ÏûÖÎ†• Ìï≠Î™©ÏûÖÎãàÎã§.");
                        return;
                    }
                    if (state.appData.senseColors.length === 0) {
                        showModal("ÌïµÏã¨ ÏÉâÏÉÅÏùÑ ÏµúÏÜå 1Í∞ú Ïù¥ÏÉÅ ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.");
                        return;
                    }
                    state.page = 2;
                    render();
                    break;
                case 2:
                    if (!state.appData.techSound || !state.appData.techRhythm || !state.appData.analysisHarmony || !state.appData.analysisForm) {
                        showModal("2Îã®Í≥ÑÏùò Î™®Îì† Ìï≠Î™©(ÏÜåÎ¶¨ Î∞è ÏùåÏÉâ, ÏÜçÎèÑ Î∞è Î¶¨Îì¨, ÌôîÏÑ± Î∞è Î∂ÑÏúÑÍ∏∞, ÌòïÏãù Î∞è Ï†ÑÍ∞ú)ÏùÑ Î™®Îëê ÏûëÏÑ±Ìï¥Ï£ºÏÑ∏Ïöî.");
                        return;
                    }
                    state.page = 3;
                    render();
                    break;
                case 3:
                    if (!state.appData.interpIntent || !state.appData.interpScene || !state.appData.evalArt || !state.appData.evalApply) {
                        showModal("3Îã®Í≥ÑÏùò Î™®Îì† Ìï≠Î™©(ÏûëÍ≥° ÏùòÎèÑ Î∞è Î©îÏãúÏßÄ, ÏùåÏïÖÏùò ÏÇ¨ÌöåÏ†Å ÏùòÎØ∏ Î∞è Ïó≠Ìï†, ÏòàÏà†Ï†Å Í∞ÄÏπò ÌèâÍ∞Ä, ÏúµÌï© Î∞è ÌôïÏû• Ï†ÅÏö©)ÏùÑ Î™®Îëê ÏûëÏÑ±Ìï¥Ï£ºÏÑ∏Ïöî.");
                        return;
                    }
                    await generateFeedback();
                    break;
                case 4:
                    if (!state.feedbackInput) {
                        showModal("AIÏùò ÏßàÎ¨∏Ïóê ÎåÄÌïú Î≥¥ÏôÑ ÎÇ¥Ïö©ÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.");
                        return;
                    }
                    await generateFinalOutput(state.feedbackInput);
                    break;
                case 5:
                    // Page 5ÏóêÏÑú ÏôÑÎ£å Î≤ÑÌäº ÌÅ¥Î¶≠ Ïãú Google FormsÎ°ú Îç∞Ïù¥ÌÑ∞ Ï†ÑÏÜ°
                    await submitToGoogleForms();
                    break;
                case 6:
                    // Page 6ÏóêÏÑú ÏôÑÎ£å Î≤ÑÌäº ÌÅ¥Î¶≠ Ïãú Page 5Î°ú ÎèåÏïÑÍ∞ÄÍ∏∞
                    state.comparisonPageInitialized = false; // ÎπÑÍµê ÌéòÏù¥ÏßÄ Ï¥àÍ∏∞Ìôî ÌîåÎûòÍ∑∏ Î¶¨ÏÖã
                    state.page = 5;
                    render();
                    break;
                default:
                    state.page = 1;
                    render();
            }
        }

        // =========================
        // Page Components (HTML)
        // =========================
        function renderHeader() {
            return `
                <header class="bg-gradient-to-r from-blue-600 to-indigo-700 text-white p-4 shadow-lg rounded-t-xl flex justify-between items-center">
                    <h1 class="text-2xl font-bold flex items-center">
                        ${icons.Music(24)} <span class="ml-2">ÏÜåÎ¶¨ ÏÑ±Ï∞∞Ïã§ (MelodyMind)</span>
                    </h1>
                    <span class="text-sm opacity-75">${state.page === 0 ? 'ÌïôÏÉù Ï†ïÎ≥¥ ÏûÖÎ†•' : `ÏÇ¨Ïö©Ïûê ID: ${state.userId.substring(0, 8)}...`}</span>
                </header>
            `;
        }

        function renderStepIndicator() {
            if (state.page > 3) return '';
            
            let steps = '';
            for (let i = 1; i <= 3; i++) {
                const activeClass = i === state.page 
                    ? 'bg-indigo-500 text-white shadow-lg' 
                    : 'bg-gray-200 text-gray-500';
                steps += `<div class="flex-1 text-center mx-1 py-2 rounded-full font-semibold transition-all duration-300 ${activeClass}">${i}Îã®Í≥Ñ</div>`;
            }
            return `<div class="flex justify-between items-center my-4">${steps}</div>`;
        }

        // ÌïôÎ≤à ÏûÖÎ†• ÌïÑÌÑ∞ÎßÅ (Ïà´ÏûêÎßå)
        function filterStudentId(value) {
            return value.replace(/[^0-9]/g, '');
        }

        // Ïù¥Î¶Ñ ÏûÖÎ†• ÌïÑÌÑ∞ÎßÅ (ÌïúÍ∏ÄÎßå)
        function filterStudentName(value) {
            return value.replace(/[^Í∞Ä-Ìû£\s]/g, '');
        }

        function renderPage0() {
            return `
                <div class="space-y-6">
                    <h2 class="text-xl font-semibold text-gray-700">ÌïôÏÉù Ï†ïÎ≥¥ ÏûÖÎ†•</h2>
                    
                    <div class="bg-white p-6 rounded-lg shadow-md border border-indigo-100">
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">ÌïôÎ≤à (ÌïÑÏàò)</label>
                                <input type="text" id="studentId" value="${state.studentId}" 
                                    oninput="const filtered = filterStudentId(this.value); if (filtered !== this.value) { this.value = filtered; } state.studentId = filtered;" 
                                    onblur="render();"
                                    placeholder="Ïòà: 2024001" 
                                    pattern="[0-9]*"
                                    inputmode="numeric"
                                    class="w-full p-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500" />
                                <p class="text-xs text-gray-500 mt-1">Ïà´ÏûêÎßå ÏûÖÎ†• Í∞ÄÎä•Ìï©ÎãàÎã§.</p>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Ïù¥Î¶Ñ (ÌïÑÏàò)</label>
                                <input type="text" id="studentName" value="${state.studentName}" 
                                    oninput="state.studentName = this.value;" 
                                    onblur="const filtered = filterStudentName(this.value); this.value = filtered; state.studentName = filtered; render();"
                                    placeholder="Ïòà: ÌôçÍ∏∏Îèô" 
                                    class="w-full p-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500" />
                                <p class="text-xs text-gray-500 mt-1">ÌïúÍ∏ÄÎßå ÏûÖÎ†• Í∞ÄÎä•Ìï©ÎãàÎã§. (ÏûÖÎ†• ÏôÑÎ£å ÌõÑ ÏûêÎèôÏúºÎ°ú ÌïÑÌÑ∞ÎßÅÎê©ÎãàÎã§)</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderPage1() {
            const keywords = ['Í∏∞ÏÅ®', 'Ïä¨Ìîî', 'Í∏¥Ïû•', 'ÌèâÌôî', 'Ïó≠ÎèôÏ†Å', 'Ïì∏Ïì∏Ìï®', 'Í≤ΩÏæåÌï®', 'ÏõÖÏû•Ìï®'];
            const keywordButtons = keywords.map(keyword => {
                const isActive = state.appData.senseKeywords.includes(keyword);
                const activeClass = isActive 
                    ? 'bg-indigo-500 text-white shadow-md' 
                    : 'bg-gray-100 text-gray-600 hover:bg-indigo-100';
                return `<button onclick="toggleKeyword('${keyword}')" class="px-3 py-1 text-sm rounded-full transition-colors duration-200 ${activeClass}">${keyword}</button>`;
            }).join('');

            return `
                <div class="space-y-6">
                    <h2 class="text-xl font-semibold text-gray-700">1Îã®Í≥Ñ: ÏïÖÍ≥° Ï†ïÎ≥¥ Î∞è Í∞êÍ∞ÅÏ†Å Í∞êÏÉÅ (Î∞òÏùë)</h2>
                    
                    <div class="bg-white p-4 rounded-lg shadow-md border border-indigo-100">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Ïú†ÌäúÎ∏å ÎßÅÌÅ¨ (ÌïÑÏàò)</label>
                        <input type="text" id="url" value="${state.appData.url}" oninput="updateField('url', this.value)" 
                            placeholder="https://www.youtube.com/watch?v=..." 
                            class="w-full p-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500" />
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 bg-white p-4 rounded-lg shadow-md border border-indigo-100">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">ÏïÖÍ≥° Ï†úÎ™©</label>
                            <input type="text" id="title" value="${state.appData.title}" oninput="updateField('title', this.value)" 
                                placeholder="Ïòà: ÏõîÍ¥ë ÏÜåÎÇòÌÉÄ" 
                                class="w-full p-2 border border-gray-300 rounded-md mt-1" />
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">ÏûëÍ≥°Í∞Ä</label>
                            <input type="text" id="composer" value="${state.appData.composer}" oninput="updateField('composer', this.value)" 
                                placeholder="Ïòà: Î≤†ÌÜ†Î≤§" 
                                class="w-full p-2 border border-gray-300 rounded-md mt-1" />
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Í∞ÄÏàò ÎòêÎäî Ïó∞Ï£ºÏûê Ïù¥Î¶Ñ</label>
                            <input type="text" id="artist" value="${state.appData.artist}" oninput="updateField('artist', this.value)" 
                                placeholder="Ïòà: ÎûëÎûë" 
                                class="w-full p-2 border border-gray-300 rounded-md mt-1" />
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Ïó∞Ï£º ÌòïÌÉú 1 (Í∏∞ÏïÖ/ÏÑ±ÏïÖ)</label>
                            <select id="ensembleType1" onchange="updateField('ensembleType1', this.value)" 
                                class="w-full p-2 border border-gray-300 rounded-md mt-1">
                                <option value="">ÏÑ†ÌÉù</option>
                                <option value="Í∏∞ÏïÖÍ≥°" ${state.appData.ensembleType1 === 'Í∏∞ÏïÖÍ≥°' ? 'selected' : ''}>Í∏∞ÏïÖÍ≥°</option>
                                <option value="ÏÑ±ÏïÖÍ≥°" ${state.appData.ensembleType1 === 'ÏÑ±ÏïÖÍ≥°' ? 'selected' : ''}>ÏÑ±ÏïÖÍ≥°</option>
                                <option value="Ïûò Î™®Î•¥Í≤†Ïùå" ${state.appData.ensembleType1 === 'Ïûò Î™®Î•¥Í≤†Ïùå' ? 'selected' : ''}>Ïûò Î™®Î•¥Í≤†Ïùå</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">ÏùåÏïÖ Î∂ÑÎ•ò (Ïû•Î•¥)</label>
                            <select id="musicGenre" onchange="updateField('musicGenre', this.value)" 
                                class="w-full p-2 border border-gray-300 rounded-md mt-1">
                                <option value="">ÏÑ†ÌÉù</option>
                                <option value="ÎåÄÏ§ëÏùåÏïÖ" ${state.appData.musicGenre === 'ÎåÄÏ§ëÏùåÏïÖ' ? 'selected' : ''}>ÎåÄÏ§ëÏùåÏïÖ</option>
                                <option value="Íµ≠ÏïÖ" ${state.appData.musicGenre === 'Íµ≠ÏïÖ' ? 'selected' : ''}>Íµ≠ÏïÖ</option>
                                <option value="ÏÑúÏñëÏùåÏïÖ" ${state.appData.musicGenre === 'ÏÑúÏñëÏùåÏïÖ' ? 'selected' : ''}>ÏÑúÏñëÏùåÏïÖ</option>
                                <option value="ÏÑ∏Í≥ÑÏùåÏïÖ" ${state.appData.musicGenre === 'ÏÑ∏Í≥ÑÏùåÏïÖ' ? 'selected' : ''}>ÏÑ∏Í≥ÑÏùåÏïÖ</option>
                                <option value="Ïûò Î™®Î•¥Í≤†Ïùå" ${state.appData.musicGenre === 'Ïûò Î™®Î•¥Í≤†Ïùå' ? 'selected' : ''}>Ïûò Î™®Î•¥Í≤†Ïùå</option>
                            </select>
                        </div>
                    </div>

                    <div class="space-y-4 bg-white p-4 rounded-lg shadow-md border border-indigo-100">
                        <h3 class="font-bold text-lg text-indigo-600">Í∞êÍ∞ÅÏ†Å Í∞êÏÉÅ (1. Î∞òÏùë)</h3>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Í∞êÏÑ± ÌÇ§ÏõåÎìú (2~3Í∞ÄÏßÄ ÏÑ†ÌÉù)</label>
                            <div class="flex flex-wrap gap-2">
                                ${keywordButtons}
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700">ÎäêÎÇå/Î∂ÑÏúÑÍ∏∞ ÏÑúÏà† (50Ïûê ÎÇ¥Ïô∏)</label>
                            <textarea id="senseText" oninput="updateField('senseText', this.value.substring(0, 50))" 
                                rows="2" placeholder="Ïòà: Ïù¥Î≤à Ïó¨Î¶Ñ Î∞©Ìïô Îïå ÏïÑÎπ†, ÏóÑÎßàÎûë Î≥¥ÏïòÎçò Îã¨Ïù¥ Îñ†ÏûàÎçò Í∞ïÏõêÎèÑ Î∞îÎã§Í∞Ä Îñ†Ïò¨ÎûêÏñ¥Ïöî. Í≥†ÏöîÌï® ÏÜçÏóêÏÑú Î∂àÏïàÍ∞êÏù¥ ÎäêÍª¥Ï†∏Ïöî." 
                                class="w-full p-2 border border-gray-300 rounded-md mt-1">${state.appData.senseText}</textarea>
                            <p class="text-right text-xs text-gray-500">${state.appData.senseText.length} / 50 Ïûê</p>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ÌïµÏã¨ ÏÉâÏÉÅ (1~4Í∞ú ÏÑ†ÌÉù)</label>
                            <div class="flex flex-wrap gap-2.5 justify-center items-center max-w-full">
                                ${COLOR_PALETTE.map(color => {
                                    const isSelected = state.appData.senseColors.includes(color.value);
                                    const isDisabled = !isSelected && state.appData.senseColors.length >= 4;
                                    const selectedClass = isSelected 
                                        ? 'border-indigo-600 scale-110 shadow-lg ring-2 ring-indigo-300' 
                                        : isDisabled
                                        ? 'border-gray-200 opacity-50 cursor-not-allowed'
                                        : 'border-gray-300 hover:scale-105';
                                    return `
                                        <button 
                                            onclick="toggleColor('${color.value}')" 
                                            ${isDisabled ? 'disabled' : ''}
                                            class="w-10 h-10 rounded-full transition-all duration-200 ${selectedClass} border-2"
                                            style="background-color: ${color.value};"
                                            title="${color.name} (${color.description})"
                                        ></button>
                                    `;
                                }).join('')}
                            </div>
                            <p class="text-center text-sm text-gray-600 mt-3">
                                ${state.appData.senseColors.length > 0 
                                    ? `ÏÑ†ÌÉùÎêú ÏÉâÏÉÅ: ${state.appData.senseColors.map(c => {
                                        const color = COLOR_PALETTE.find(p => p.value === c);
                                        return color ? `${color.name}(${color.description})` : c;
                                    }).join(', ')} (${state.appData.senseColors.length}/4)`
                                    : 'ÏÉâÏÉÅÏùÑ 1~4Í∞ú ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî'}
                            </p>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Îã§Î•∏ Î∞©ÏãùÏúºÎ°ú ÌëúÌòÑÌïòÍ∏∞ (ÏÑ†ÌÉù)</label>
                            <div class="space-y-2 mb-3">
                                <label class="flex items-center space-x-2 cursor-pointer hover:bg-gray-50 p-2 rounded">
                                    <input type="checkbox" 
                                        ${state.appData.senseExpressionType.includes('poetry') ? 'checked' : ''}
                                        onchange="toggleExpressionType('poetry')"
                                        class="w-4 h-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
                                    <span class="text-sm">üìù ÏãúÏ†Å ÌëúÌòÑ/Î¨∏Íµ¨ (Íµ≠Ïñ¥)</span>
                                </label>
                                <label class="flex items-center space-x-2 cursor-pointer hover:bg-gray-50 p-2 rounded">
                                    <input type="checkbox" 
                                        ${state.appData.senseExpressionType.includes('movement') ? 'checked' : ''}
                                        onchange="toggleExpressionType('movement')"
                                        class="w-4 h-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
                                    <span class="text-sm">üíÉ ÏõÄÏßÅÏûÑ/ÎèôÏûë (Ï≤¥Ïú°/Î¨¥Ïö©)</span>
                                </label>
                                <label class="flex items-center space-x-2 cursor-pointer hover:bg-gray-50 p-2 rounded">
                                    <input type="checkbox" 
                                        ${state.appData.senseExpressionType.includes('nature') ? 'checked' : ''}
                                        onchange="toggleExpressionType('nature')"
                                        class="w-4 h-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
                                    <span class="text-sm">‚ö° ÏûêÏó∞ ÌòÑÏÉÅ (Í≥ºÌïô)</span>
                                </label>
                                <label class="flex items-center space-x-2 cursor-pointer hover:bg-gray-50 p-2 rounded">
                                    <input type="checkbox" 
                                        ${state.appData.senseExpressionType.includes('space') ? 'checked' : ''}
                                        onchange="toggleExpressionType('space')"
                                        class="w-4 h-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
                                    <span class="text-sm">üèûÔ∏è Í≥µÍ∞Ñ/Ïû•ÏÜå (ÏÇ¨Ìöå/ÏßÄÎ¶¨)</span>
                                </label>
                                <label class="flex items-center space-x-2 cursor-pointer hover:bg-gray-50 p-2 rounded">
                                    <input type="checkbox" 
                                        ${state.appData.senseExpressionType.includes('pattern') ? 'checked' : ''}
                                        onchange="toggleExpressionType('pattern')"
                                        class="w-4 h-4 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500">
                                    <span class="text-sm">üî∑ ÎèÑÌòï/Ìå®ÌÑ¥ (ÏàòÌïô)</span>
                                </label>
                            </div>
                            ${state.appData.senseExpressionType.length > 0 ? (() => {
                                let content = '';
                                
                                // ÌÖçÏä§Ìä∏ ÏûÖÎ†•Ïù¥ ÌïÑÏöîÌïú Î∞©ÏãùÎì§ (poetry)
                                const textTypes = state.appData.senseExpressionType.filter(t => t === 'poetry');
                                if (textTypes.length > 0) {
                                    content += `
                                    <div class="mb-4">
                                        <label class="block text-sm font-medium text-gray-700 mb-1">
                                            ÏãúÏ†Å ÌëúÌòÑ/Î¨∏Íµ¨Î°ú ÌëúÌòÑÌïòÍ∏∞
                                        </label>
                                        <textarea id="senseExpressionText" oninput="updateField('senseExpressionText', this.value)" rows="3" 
                                            placeholder="Ïòà: Îã¨ÎπõÏóê Î¨ºÎì† Î∞îÎã§, Í≥†ÏöîÌïú Î∞§Ïùò Î∂àÏïà" 
                                            class="w-full p-2 border border-gray-300 rounded-md mt-1">${state.appData.senseExpressionText}</textarea>
                                    </div>
                                    `;
                                }
                                
                                // ÏûêÏó∞ ÌòÑÏÉÅ ÏÇ¨ÏßÑ ÏÑ†ÌÉù (nature)
                                if (state.appData.senseExpressionType.includes('nature')) {
                                    const natureImages = [
                                        { id: 'storm', name: 'Ìè≠Ìíç', emoji: '‚õàÔ∏è', color: '#4B5563' },
                                        { id: 'lightning', name: 'Î≤àÍ∞ú', emoji: '‚ö°', color: '#FBBF24' },
                                        { id: 'rain', name: 'ÎπÑ', emoji: 'üåßÔ∏è', color: '#60A5FA' },
                                        { id: 'snow', name: 'Îàà', emoji: '‚ùÑÔ∏è', color: '#E0E7FF' },
                                        { id: 'wind', name: 'Î∞îÎûå', emoji: 'üí®', color: '#A5B4FC' },
                                        { id: 'wave', name: 'ÌååÎèÑ', emoji: 'üåä', color: '#3B82F6' },
                                        { id: 'fire', name: 'Î∂à', emoji: 'üî•', color: '#EF4444' },
                                        { id: 'cloud', name: 'Íµ¨Î¶Ñ', emoji: '‚òÅÔ∏è', color: '#9CA3AF' },
                                        { id: 'sunset', name: 'ÏùºÎ™∞', emoji: 'üåÖ', color: '#F97316' },
                                        { id: 'moon', name: 'Îã¨', emoji: 'üåô', color: '#FCD34D' },
                                        { id: 'star', name: 'Î≥Ñ', emoji: '‚≠ê', color: '#FBBF24' },
                                        { id: 'ocean', name: 'Î∞îÎã§', emoji: 'üåä', color: '#0EA5E9' }
                                    ];
                                    
                                    content += `
                                    <div class="mb-4">
                                        <label class="block text-sm font-medium text-gray-700 mb-2">‚ö° ÏûêÏó∞ ÌòÑÏÉÅÏúºÎ°ú ÌëúÌòÑÌïòÍ∏∞ (2~3Í∞ú ÏÑ†ÌÉù)</label>
                                        <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3">
                                            ${natureImages.map(img => {
                                                const isSelected = state.appData.senseExpressionNature.includes(img.id);
                                                return `
                                                    <div class="cursor-pointer relative" onclick="toggleNatureImage('${img.id}')" style="user-select: none;">
                                                        <div class="border-2 rounded-lg overflow-hidden transition-all ${
                                                            isSelected 
                                                                ? 'border-indigo-600 ring-2 ring-indigo-300 scale-105 shadow-lg' 
                                                                : 'border-gray-300 hover:border-gray-400 hover:shadow-md'
                                                        }">
                                                            <div class="w-full h-24 flex items-center justify-center relative" style="background: linear-gradient(135deg, ${img.color}15 0%, ${img.color}05 100%);">
                                                                <span class="text-5xl ${isSelected ? 'opacity-100' : 'opacity-80'} transition-opacity">${img.emoji}</span>
                                                                ${isSelected ? '<div class="absolute top-1 right-1 bg-indigo-600 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs font-bold shadow-md">‚úì</div>' : ''}
                                                            </div>
                                                            <div class="p-2 text-center bg-white">
                                                                <p class="text-xs font-medium text-gray-700">${img.name}</p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                `;
                                            }).join('')}
                                        </div>
                                        <p class="text-xs text-gray-500 mt-2">
                                            ÏÑ†ÌÉùÎêú ÏûêÏó∞ ÌòÑÏÉÅ: ${state.appData.senseExpressionNature.length > 0 
                                                ? state.appData.senseExpressionNature.map(id => natureImages.find(img => img.id === id)?.name).join(', ')
                                                : 'ÏóÜÏùå'} (${state.appData.senseExpressionNature.length}/3)
                                        </p>
                                    </div>
                                    `;
                                }
                                
                                // Ïπ¥Î©îÎùº ÏõÄÏßÅÏûÑ Í∏∞Î°ù (movement)
                                if (state.appData.senseExpressionType.includes('movement')) {
                                    content += `
                                    <div class="mb-4">
                                        <label class="block text-sm font-medium text-gray-700 mb-2">üíÉ ÏõÄÏßÅÏûÑ/ÎèôÏûëÏúºÎ°ú ÌëúÌòÑÌïòÍ∏∞</label>
                                        <div id="movement-container" class="border border-gray-300 rounded-md p-4 bg-gray-50">
                                            ${state.appData.senseExpressionMovement ? `
                                                <div class="mb-2">
                                                    <img src="${state.appData.senseExpressionMovement}" alt="Ï∫°Ï≤òÎêú ÏõÄÏßÅÏûÑ" class="max-w-full h-auto rounded border border-gray-300" />
                                                </div>
                                                <button onclick="clearMovementCapture()" class="px-3 py-1 bg-red-500 text-white rounded text-sm hover:bg-red-600">ÏÇ≠Ï†ú</button>
                                            ` : `
                                                <div class="text-center">
                                                    <video id="movement-video" autoplay playsinline class="hidden w-full max-w-md mx-auto rounded border border-gray-300"></video>
                                                    <canvas id="movement-canvas" class="hidden"></canvas>
                                                    <div id="movement-preview" class="hidden mb-2">
                                                        <img id="movement-preview-img" src="" alt="ÎØ∏Î¶¨Î≥¥Í∏∞" class="max-w-full h-auto rounded border border-gray-300" />
                                                    </div>
                                                    <div id="movement-controls" class="space-y-2">
                                                        <button onclick="startMovementCapture()" class="px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700">
                                                            üì∑ Ïπ¥Î©îÎùº ÏãúÏûë
                                                        </button>
                                                    </div>
                                                    <div id="movement-capture-controls" class="hidden space-x-2 mt-2">
                                                        <button onclick="captureMovement()" class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700">
                                                            üì∏ ÏÇ¨ÏßÑ Ï¥¨ÏòÅ
                                                        </button>
                                                        <button onclick="stopMovementCapture()" class="px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700">
                                                            Ï§ëÏßÄ
                                                        </button>
                                                    </div>
                                                </div>
                                            `}
                                        </div>
                                    </div>
                                    `;
                                }
                                
                                // ÏßÄÎèÑ Í≥µÍ∞Ñ Ï≤¥ÌÅ¨ (space)
                                if (state.appData.senseExpressionType.includes('space')) {
                                    content += `
                                    <div class="mb-4">
                                        <label class="block text-sm font-medium text-gray-700 mb-2">üèûÔ∏è Í≥µÍ∞Ñ/Ïû•ÏÜåÎ°ú ÌëúÌòÑÌïòÍ∏∞</label>
                                        <div class="grid grid-cols-1 ${state.appData.senseExpressionSpace ? 'lg:grid-cols-2' : ''} gap-4">
                                            <div id="space-container" class="border border-gray-300 rounded-md overflow-hidden" style="height: 400px;">
                                                ${state.appData.senseExpressionSpace ? `
                                                    <div class="p-4 bg-gray-50">
                                                        <p class="text-sm mb-2"><strong>ÏÑ†ÌÉùÌïú ÏúÑÏπò:</strong></p>
                                                        <p class="text-sm text-gray-700">${state.appData.senseExpressionSpace.address || `${state.appData.senseExpressionSpace.lat.toFixed(4)}, ${state.appData.senseExpressionSpace.lng.toFixed(4)}`}</p>
                                                        <button onclick="clearSpaceSelection()" class="mt-2 px-3 py-1 bg-red-500 text-white rounded text-sm hover:bg-red-600">Îã§Ïãú ÏÑ†ÌÉù</button>
                                                    </div>
                                                    <div id="space-map" style="height: 350px;"></div>
                                                ` : `
                                                    <div id="space-map" style="height: 400px;"></div>
                                                `}
                                            </div>
                                            ${state.appData.senseExpressionSpace ? `
                                                <div class="border border-gray-300 rounded-md overflow-hidden bg-gray-50">
                                                    <div class="p-4">
                                                        <h4 class="font-semibold text-gray-700 mb-2">üìç ÏÑ†ÌÉùÌïú ÏúÑÏπò ÏÉÅÏÑ∏Î≥¥Í∏∞</h4>
                                                        <p class="text-sm text-gray-600 mb-3">${state.appData.senseExpressionSpace.address || `${state.appData.senseExpressionSpace.lat.toFixed(4)}, ${state.appData.senseExpressionSpace.lng.toFixed(4)}`}</p>
                                                    </div>
                                                    <div id="space-detail-map" style="height: 350px;"></div>
                                                </div>
                                            ` : ''}
                                        </div>
                                    </div>
                                    `;
                                }
                                
                                // ÎèÑÌòï/Ìå®ÌÑ¥ Í∑∏Î¶¨Í∏∞ (pattern)
                                if (state.appData.senseExpressionType.includes('pattern')) {
                                    content += `
                                    <div class="mb-4">
                                        <label class="block text-sm font-medium text-gray-700 mb-2">üî∑ ÎèÑÌòï/Ìå®ÌÑ¥ÏúºÎ°ú ÌëúÌòÑÌïòÍ∏∞</label>
                                        <div id="pattern-container" class="border border-gray-300 rounded-md p-4 bg-gray-50">
                                            ${state.appData.senseExpressionPattern ? `
                                                <div class="mb-2">
                                                    <img src="${state.appData.senseExpressionPattern}" alt="Í∑∏Î¶∞ ÎèÑÌòï" class="max-w-full h-auto rounded border border-gray-300" />
                                                </div>
                                                <button onclick="clearPatternDrawing()" class="px-3 py-1 bg-red-500 text-white rounded text-sm hover:bg-red-600">Îã§Ïãú Í∑∏Î¶¨Í∏∞</button>
                                                <button onclick="editPatternDrawing()" class="px-3 py-1 bg-blue-500 text-white rounded text-sm hover:bg-blue-600 ml-2">ÏàòÏ†ïÌïòÍ∏∞</button>
                                            ` : `
                                                <div class="space-y-2">
                                                    <div class="flex gap-2 mb-2">
                                                        <button onclick="drawShape('circle')" class="px-3 py-1 bg-blue-500 text-white rounded text-sm hover:bg-blue-600">Ïõê</button>
                                                        <button onclick="drawShape('rect')" class="px-3 py-1 bg-blue-500 text-white rounded text-sm hover:bg-blue-600">ÏÇ¨Í∞ÅÌòï</button>
                                                        <button onclick="drawShape('triangle')" class="px-3 py-1 bg-blue-500 text-white rounded text-sm hover:bg-blue-600">ÏÇºÍ∞ÅÌòï</button>
                                                        <button onclick="setDrawingMode('free')" class="px-3 py-1 bg-blue-500 text-white rounded text-sm hover:bg-blue-600">ÏûêÏú† Í∑∏Î¶¨Í∏∞</button>
                                                        <button onclick="clearPatternCanvas()" class="px-3 py-1 bg-red-500 text-white rounded text-sm hover:bg-red-600">ÏßÄÏö∞Í∏∞</button>
                                                        <button onclick="savePatternDrawing()" class="px-3 py-1 bg-green-500 text-white rounded text-sm hover:bg-green-600">Ï†ÄÏû•</button>
                                                    </div>
                                                    <div class="flex gap-2 mb-2">
                                                        <input type="color" id="pattern-color" value="#3B82F6" class="h-8 w-16 border border-gray-300 rounded" />
                                                        <label class="text-sm text-gray-700 flex items-center">ÏÉâÏÉÅ ÏÑ†ÌÉù</label>
                                                    </div>
                                                    <canvas id="pattern-canvas" width="600" height="400" class="border border-gray-300 rounded bg-white cursor-crosshair"></canvas>
                                                </div>
                                            `}
                                        </div>
                                    </div>
                                    `;
                                }
                                
                                return content;
                            })() : ''}
                        </div>
                    </div>
                </div>
            `;
        }

        function renderPage2() {
            // 1Îã®Í≥Ñ Í∞êÍ∞ÅÏ†Å Í∞êÏÉÅ ÏöîÏïΩ ÌëúÏãú
            const typeNames = {
                'poetry': 'üìù ÏãúÏ†Å ÌëúÌòÑ/Î¨∏Íµ¨',
                'movement': 'üíÉ ÏõÄÏßÅÏûÑ/ÎèôÏûë',
                'nature': '‚ö° ÏûêÏó∞ ÌòÑÏÉÅ',
                'space': 'üèûÔ∏è Í≥µÍ∞Ñ/Ïû•ÏÜå',
                'pattern': 'üî∑ ÎèÑÌòï/Ìå®ÌÑ¥'
            };
            
            const natureImages = [
                { id: 'storm', name: 'Ìè≠Ìíç', emoji: '‚õàÔ∏è' },
                { id: 'lightning', name: 'Î≤àÍ∞ú', emoji: '‚ö°' },
                { id: 'rain', name: 'ÎπÑ', emoji: 'üåßÔ∏è' },
                { id: 'snow', name: 'Îàà', emoji: '‚ùÑÔ∏è' },
                { id: 'wind', name: 'Î∞îÎûå', emoji: 'üí®' },
                { id: 'wave', name: 'ÌååÎèÑ', emoji: 'üåä' },
                { id: 'fire', name: 'Î∂à', emoji: 'üî•' },
                { id: 'cloud', name: 'Íµ¨Î¶Ñ', emoji: '‚òÅÔ∏è' },
                { id: 'sunset', name: 'ÏùºÎ™∞', emoji: 'üåÖ' },
                { id: 'moon', name: 'Îã¨', emoji: 'üåô' },
                { id: 'star', name: 'Î≥Ñ', emoji: '‚≠ê' },
                { id: 'ocean', name: 'Î∞îÎã§', emoji: 'üåä' }
            ];
            
            const senseSummary = `
                <div class="bg-blue-50 p-4 rounded-lg border border-blue-200 mb-4">
                    <h4 class="font-semibold text-blue-800 mb-2">üìù 1Îã®Í≥ÑÏóêÏÑú ÎäêÎÇÄ Í∞êÍ∞ÅÏ†Å Í∞êÏÉÅ</h4>
                    <div class="text-sm text-gray-700 space-y-1">
                        ${state.appData.senseKeywords.length > 0 ? `<p><strong>ÌÇ§ÏõåÎìú:</strong> ${state.appData.senseKeywords.join(', ')}</p>` : ''}
                        ${state.appData.senseText ? `<p><strong>ÎäêÎÇå/Î∂ÑÏúÑÍ∏∞:</strong> ${state.appData.senseText}</p>` : ''}
                        ${state.appData.senseColors.length > 0 ? `<p><strong>ÏÉâÏÉÅ:</strong> ${state.appData.senseColors.map(c => {
                            const color = COLOR_PALETTE.find(p => p.value === c);
                            return color ? color.name : c;
                        }).join(', ')}</p>` : ''}
                        ${state.appData.senseExpressionType.length > 0 ? `
                            <div class="mt-2 pt-2 border-t border-blue-200">
                                <p class="font-semibold text-blue-700 mb-2">Îã§Î•∏ Î∞©ÏãùÏúºÎ°ú ÌëúÌòÑÌïòÍ∏∞:</p>
                                <div class="space-y-3">
                                    ${state.appData.senseExpressionType.map(t => {
                                        const typeName = typeNames[t] || t;
                                        let content = `<div class="bg-white p-2 rounded border border-blue-100">`;
                                        content += `<p class="font-semibold text-sm text-blue-800 mb-1">${typeName}</p>`;
                                        
                                        if (t === 'poetry') {
                                            if (state.appData.senseExpressionText) {
                                                content += `<p class="text-sm text-gray-700 italic">"${state.appData.senseExpressionText}"</p>`;
                                            } else {
                                                content += `<p class="text-xs text-gray-500">(Íµ≠Ïñ¥ - ÏãúÏ†Å ÌëúÌòÑ/Î¨∏Íµ¨)</p>`;
                                            }
                                        } else if (t === 'movement') {
                                            if (state.appData.senseExpressionMovement && state.appData.senseExpressionMovement.length > 0) {
                                                content += `<div class="mt-1">
                                                    <p class="text-xs text-gray-600 mb-1">Ï≤¥Ïú°/Î¨¥Ïö© - ÏõÄÏßÅÏûÑ/ÎèôÏûë Ïù¥ÎØ∏ÏßÄ:</p>
                                                    <img src="${state.appData.senseExpressionMovement}" alt="ÏõÄÏßÅÏûÑ ÌëúÌòÑ" class="max-w-full h-auto rounded border border-gray-200" style="max-height: 200px;" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';" />
                                                    <p class="text-xs text-red-500" style="display:none;">Ïù¥ÎØ∏ÏßÄÎ•º Î∂àÎü¨Ïò¨ Ïàò ÏóÜÏäµÎãàÎã§.</p>
                                                </div>`;
                                            } else {
                                                content += `<p class="text-xs text-gray-500">Ï≤¥Ïú°/Î¨¥Ïö© - ÏõÄÏßÅÏûÑ/ÎèôÏûë Ïù¥ÎØ∏ÏßÄÍ∞Ä ÏóÜÏäµÎãàÎã§.</p>`;
                                            }
                                        } else if (t === 'space') {
                                            if (state.appData.senseExpressionSpace) {
                                                const space = state.appData.senseExpressionSpace;
                                                const location = space.address || `${space.lat.toFixed(4)}, ${space.lng.toFixed(4)}`;
                                                content += `<p class="text-sm text-gray-700">üìç ${location} (ÏÇ¨Ìöå/ÏßÄÎ¶¨)</p>`;
                                            } else {
                                                content += `<p class="text-xs text-gray-500">(ÏÇ¨Ìöå/ÏßÄÎ¶¨ - Í≥µÍ∞Ñ/Ïû•ÏÜå)</p>`;
                                            }
                                        } else if (t === 'pattern') {
                                            if (state.appData.senseExpressionPattern && state.appData.senseExpressionPattern.length > 0) {
                                                content += `<div class="mt-1">
                                                    <p class="text-xs text-gray-600 mb-1">ÏàòÌïô - ÎèÑÌòï/Ìå®ÌÑ¥ Í∑∏Î¶º:</p>
                                                    <img src="${state.appData.senseExpressionPattern}" alt="ÎèÑÌòï/Ìå®ÌÑ¥ ÌëúÌòÑ" class="max-w-full h-auto rounded border border-gray-200" style="max-height: 200px;" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';" />
                                                    <p class="text-xs text-red-500" style="display:none;">Ïù¥ÎØ∏ÏßÄÎ•º Î∂àÎü¨Ïò¨ Ïàò ÏóÜÏäµÎãàÎã§.</p>
                                                </div>`;
                                            } else {
                                                content += `<p class="text-xs text-gray-500">ÏàòÌïô - ÎèÑÌòï/Ìå®ÌÑ¥ Í∑∏Î¶ºÏù¥ ÏóÜÏäµÎãàÎã§.</p>`;
                                            }
                                        } else if (t === 'nature') {
                                            if (state.appData.senseExpressionNature && state.appData.senseExpressionNature.length > 0) {
                                                const natureNames = state.appData.senseExpressionNature.map(id => {
                                                    const nature = natureImages.find(img => img.id === id);
                                                    return nature ? `${nature.emoji} ${nature.name}` : id;
                                                }).join(', ');
                                                content += `<p class="text-sm text-gray-700">${natureNames} (Í≥ºÌïô)</p>`;
                                            } else {
                                                content += `<p class="text-xs text-gray-500">(Í≥ºÌïô - ÏûêÏó∞ ÌòÑÏÉÅ)</p>`;
                                            }
                                        }
                                        
                                        content += `</div>`;
                                        return content;
                                    }).join('')}
                                </div>
                            </div>
                        ` : ''}
                    </div>
                    <p class="text-xs text-blue-600 mt-2 font-semibold">üí° ÏúÑÏóêÏÑú ÎäêÎÇÄ Í∞êÍ∞ÅÏ†Å Í∞êÏÉÅÏùò <strong>Í∑ºÍ±∞</strong>Î•º ÏïÑÎûòÏóêÏÑú Î∂ÑÏÑùÌï¥Î≥¥ÏÑ∏Ïöî. "Ïôú Í∑∏Î†áÍ≤å ÎäêÍºàÏùÑÍπå?"Î•º Ï∞æÏïÑÎ≥¥Îäî Í≤ÉÏûÖÎãàÎã§.</p>
                </div>
            `;

            return `
                <div class="space-y-6">
                    <h2 class="text-xl font-semibold text-gray-700">2Îã®Í≥Ñ: Î∂ÑÏÑùÏ†Å Í∞êÏÉÅ (2. Í∏∞Ïà†, 3. Î∂ÑÏÑù)</h2>
                    
                    ${senseSummary}
                    
                    <p class="text-sm text-gray-500 bg-yellow-50 p-3 rounded-lg flex items-center">
                        ${icons.Lightbulb(16)}
                        <span class="ml-2"><strong>AI ÌûåÌä∏:</strong> 1Îã®Í≥Ñ Í∞êÏÉÅ Í≤∞Í≥º, <strong>Î¶¨Îì¨ Î∞è ÌÖúÌè¨</strong> Î≥ÄÌôîÏóê ÎØºÍ∞êÌïòÏÖ®ÏäµÎãàÎã§. <strong>Í≥°Ïù¥ Îπ®ÎùºÏßÄÍ±∞ÎÇò ÎäêÎ†§ÏßÄÎäî Î∂ÄÎ∂Ñ</strong>ÏùÑ Ï∞æÏïÑÎ≥¥Î©∞ Î∂ÑÏÑùÏùÑ ÏãúÏûëÌï¥ Î≥¥ÏÑ∏Ïöî.</span>
                    </p>

                    <div class="bg-white p-4 rounded-lg shadow-md border border-indigo-100 space-y-4">
                        <h3 class="font-bold text-lg text-indigo-600">2-1. ÏÜåÎ¶¨ Î∞è ÏùåÏÉâ (Timbre/Dynamics)</h3>
                        <label class="block text-sm font-medium text-gray-700 mb-1">
                            Ï£ºÎèÑÏ†ÅÏù∏ ÏïÖÍ∏∞/ÏÜåÎ¶¨, ÏÜåÎ¶¨Ïùò ÌÅ¨Í∏∞/ÏÖàÏó¨Î¶º
                            <span class="text-xs text-gray-500 font-normal">(1Îã®Í≥ÑÏóêÏÑú ÎäêÎÇÄ ÏÜåÎ¶¨Ïùò ÌäπÏßïÏù¥ Ïñ¥Îñ§ ÏïÖÍ∏∞ÎÇò ÏÖàÏó¨Î¶º ÎïåÎ¨∏Ïù∏ÏßÄ Î∂ÑÏÑùÌï¥Î≥¥ÏÑ∏Ïöî)</span>
                        </label>
                        <textarea id="techSound" oninput="updateField('techSound', this.value)" rows="3" 
                            placeholder="Ïòà: 1Îã®Í≥ÑÏóêÏÑú 'Ïñ¥Îë°Í≥† Î¨¥Í±∞Ïö¥ ÎäêÎÇå'ÏùÑ ÎäêÍºàÎã§Î©¥, Ïñ¥Îñ§ ÏïÖÍ∏∞Í∞Ä Í∑∏ ÎäêÎÇåÏùÑ ÎßåÎìúÎäîÏßÄ, ÏÜåÎ¶¨Í∞Ä ÌÅ¨Í≤å/ÏûëÍ≤å Î≥ÄÌïòÎäîÏßÄ Î∂ÑÏÑùÌï¥Î≥¥ÏÑ∏Ïöî. Ïù¥ Î∂ÑÏÑùÏù¥ 1Îã®Í≥ÑÏóêÏÑú ÎäêÎÇÄ Í∞êÍ∞ÅÏùò Í∑ºÍ±∞Í∞Ä Îê©ÎãàÎã§." 
                            class="w-full p-2 border border-gray-300 rounded-md mt-1">${state.appData.techSound}</textarea>

                        <h3 class="font-bold text-lg text-indigo-600">2-2. ÏÜçÎèÑ Î∞è Î¶¨Îì¨ (Tempo/Rhythm)</h3>
                        <label class="block text-sm font-medium text-gray-700 mb-1">
                            Í≥°Ïùò Îπ†Î•¥Í∏∞, Î∞òÎ≥µÎêòÍ±∞ÎÇò ÌäπÏßïÏ†ÅÏù∏ Î¶¨Îì¨ Ìå®ÌÑ¥
                            <span class="text-xs text-gray-500 font-normal">(1Îã®Í≥ÑÏóêÏÑú ÎäêÎÇÄ Îπ†Î•¥Í∏∞ÎÇò Î¶¨Îì¨Ïùò ÌäπÏßïÏù¥ Ïã§Ï†úÎ°ú Ïñ¥Îñ§ ÌÖúÌè¨ÎÇò Î¶¨Îì¨ Ìå®ÌÑ¥ ÎïåÎ¨∏Ïù∏ÏßÄ Î∂ÑÏÑùÌï¥Î≥¥ÏÑ∏Ïöî)</span>
                        </label>
                        <textarea id="techRhythm" oninput="updateField('techRhythm', this.value)" rows="3" 
                            placeholder="Ïòà: 1Îã®Í≥ÑÏóêÏÑú 'ÎäêÎ¶¨Îã§'Í≥† ÎäêÍºàÎã§Î©¥, Ïã§Ï†úÎ°ú Í≥°Ïùò ÌÖúÌè¨Í∞Ä Ïñ¥ÎñªÍ≤å ÏãúÏûëÎêòÍ≥† Î≥ÄÌôîÌïòÎäîÏßÄ, Ïñ¥Îñ§ Î¶¨Îì¨Ïù¥ Î∞òÎ≥µÎêòÎäîÏßÄ Î∂ÑÏÑùÌï¥Î≥¥ÏÑ∏Ïöî. Ïù¥ Î∂ÑÏÑùÏù¥ 1Îã®Í≥ÑÏóêÏÑú ÎäêÎ¶∞ ÎäêÎÇåÏùò Í∑ºÍ±∞Í∞Ä Îê©ÎãàÎã§." 
                            class="w-full p-2 border border-gray-300 rounded-md mt-1">${state.appData.techRhythm}</textarea>

                        <h3 class="font-bold text-lg text-indigo-600">3-1. ÌôîÏÑ± Î∞è Î∂ÑÏúÑÍ∏∞ (Harmony/Tonality)</h3>
                        <label class="block text-sm font-medium text-gray-700 mb-1">
                            Í≥°Ïù¥ Î∞ùÏùÄ/Ïñ¥ÎëêÏö¥ ÎäêÎÇåÏù∏ÏßÄ, ÌôîÏùåÏù¥ Ìé∏ÏïàÌïúÏßÄ
                            <span class="text-xs text-gray-500 font-normal">(1Îã®Í≥ÑÏóêÏÑú ÏÑ†ÌÉùÌïú ÏÉâÏÉÅÏù¥ÎÇò ÌÇ§ÏõåÎìúÍ∞Ä Ïñ¥Îñ§ ÌôîÏùåÏù¥ÎÇò Ï°∞ÏÑ± ÎïåÎ¨∏Ïù∏ÏßÄ Î∂ÑÏÑùÌï¥Î≥¥ÏÑ∏Ïöî)</span>
                        </label>
                        <textarea id="analysisHarmony" oninput="updateField('analysisHarmony', this.value)" rows="3" 
                            placeholder="Ïòà: 1Îã®Í≥ÑÏóêÏÑú 'Ïñ¥ÎëêÏö¥ ÏÉâÏÉÅ'Ïù¥ÎÇò 'Î∂àÏïàÌïú ÌÇ§ÏõåÎìú'Î•º ÏÑ†ÌÉùÌñàÎã§Î©¥, Í∑∏ ÎäêÎÇåÏù¥ Ïñ¥Îñ§ ÌôîÏùåÏù¥ÎÇò Ï°∞ÏÑ±ÏóêÏÑú ÎÇòÏò§ÎäîÏßÄ Î∂ÑÏÑùÌï¥Î≥¥ÏÑ∏Ïöî. Ïù¥ Î∂ÑÏÑùÏù¥ 1Îã®Í≥ÑÏóêÏÑú ÎäêÎÇÄ Î∂ÑÏúÑÍ∏∞Ïùò Í∑ºÍ±∞Í∞Ä Îê©ÎãàÎã§." 
                            class="w-full p-2 border border-gray-300 rounded-md mt-1">${state.appData.analysisHarmony}</textarea>

                        <h3 class="font-bold text-lg text-indigo-600">3-2. ÌòïÏãù Î∞è Ï†ÑÍ∞ú (Form/Structure)</h3>
                        <label class="block text-sm font-medium text-gray-700 mb-1">
                            Í≥°Ïù¥ A-B-AÏ≤òÎüº ÎÇòÎâòÎäîÏßÄ, Î∞òÎ≥µÎêòÍ±∞ÎÇò Î≥ÄÌôîÌïòÎäî ÌÅ∞ Î∂ÄÎ∂Ñ
                            <span class="text-xs text-gray-500 font-normal">(1Îã®Í≥ÑÏóêÏÑú ÎäêÎÇÄ Î≥ÄÌôîÎÇò Ìå®ÌÑ¥Ïù¥ Í≥°Ïùò Íµ¨Ï°∞ÏóêÏÑú Ïñ¥ÎñªÍ≤å ÎÇòÌÉÄÎÇòÎäîÏßÄ Î∂ÑÏÑùÌï¥Î≥¥ÏÑ∏Ïöî)</span>
                        </label>
                        <textarea id="analysisForm" oninput="updateField('analysisForm', this.value)" rows="3" 
                            placeholder="Ïòà: 1Îã®Í≥ÑÏóêÏÑú 'Î≥ÄÌôîÌïòÎäî ÎäêÎÇå'ÏùÑ ÎäêÍºàÎã§Î©¥, Í≥°Ïù¥ Ïñ¥ÎñªÍ≤å ÎÇòÎâòÍ≥† Î∞òÎ≥µÎêòÎäîÏßÄ, Ïñ¥Îñ§ Î∂ÄÎ∂ÑÏóêÏÑú Î≥ÄÌôîÍ∞Ä ÏùºÏñ¥ÎÇòÎäîÏßÄ Î∂ÑÏÑùÌï¥Î≥¥ÏÑ∏Ïöî. Ïù¥ Î∂ÑÏÑùÏù¥ 1Îã®Í≥ÑÏóêÏÑú ÎäêÎÇÄ Î≥ÄÌôîÏùò Í∑ºÍ±∞Í∞Ä Îê©ÎãàÎã§." 
                            class="w-full p-2 border border-gray-300 rounded-md mt-1">${state.appData.analysisForm}</textarea>
                    </div>
                </div>
            `;
        }

        function renderPage3() {
            return `
                <div class="space-y-6">
                    <h2 class="text-xl font-semibold text-gray-700">3Îã®Í≥Ñ: Ïã¨ÎØ∏Ï†Å Í∞êÏÉÅ (4. Ìï¥ÏÑù, 5. ÌèâÍ∞Ä)</h2>
                    
                    <p class="text-sm text-gray-500 bg-yellow-50 p-3 rounded-lg flex items-center">
                        ${icons.Lightbulb(16)}
                        <span class="ml-2"><strong>AI ÌûåÌä∏:</strong> 2Îã®Í≥Ñ Î∂ÑÏÑùÏùÑ Î∞îÌÉïÏúºÎ°ú Ïù¥ Í≥°Ïù¥ ÎãπÏã†ÏóêÍ≤å Ïñ¥Îñ§ ÏùòÎØ∏Î•º Ï£ºÎäîÏßÄ, ÎòêÎäî ÏÇ¨ÌöåÏ†Å Ïó≠Ìï†ÏùÄ Î¨¥ÏóáÏù∏ÏßÄ ÌÉêÏÉâÌï¥ Î≥¥ÏÑ∏Ïöî.</span>
                    </p>

                    <div class="bg-white p-4 rounded-lg shadow-md border border-indigo-100 space-y-4">
                        <h3 class="font-bold text-lg text-indigo-600">4-1. ÏûëÍ≥° ÏùòÎèÑ Î∞è Î©îÏãúÏßÄ (Intent/Message)</h3>
                        <label class="block text-sm font-medium text-gray-700 mb-1">
                            ÏûëÍ≥°Í∞ÄÍ∞Ä Ïù¥ Í≥°ÏùÑ ÌÜµÌï¥ Ï†ÑÌïòÍ≥† Ïã∂ÏóàÎçò Î©îÏãúÏßÄÎÇò ÏùòÎèÑ
                            <span class="text-xs text-gray-500 font-normal">(Î∞∞Í≤Ω Ï†ïÎ≥¥Î•º Ï∞∏Í≥†ÌïòÏó¨ ÏûëÏÑ±: ÏûëÍ≥°Í∞ÄÍ∞Ä Ïù¥ Í≥°ÏúºÎ°ú Î¨¥ÏóáÏùÑ ÎßêÌïòÍ≥† Ïã∂ÏóàÎäîÏßÄ)</span>
                        </label>
                        <textarea id="interpIntent" oninput="updateField('interpIntent', this.value)" rows="3" 
                            placeholder="Ïòà: ÎÇ≠ÎßåÏ£ºÏùò ÏãúÎåÄÏùò Ï¥àÏûêÏó∞Ï†Å Ï°¥Ïû¨ÏôÄ Í≥µÌè¨Ïóê ÎåÄÌïú Í¥ÄÏã¨ÏùÑ Î∞òÏòÅÌïòÎ©∞, Ïö¥Î™ÖÏ†Å ÎπÑÍ∑πÏùÑ Ï†ÑÎã¨ÌïúÎã§Í≥† Ìï¥ÏÑùÌñàÏäµÎãàÎã§." 
                            class="w-full p-2 border border-gray-300 rounded-md mt-1">${state.appData.interpIntent}</textarea>

                        <h3 class="font-bold text-lg text-indigo-600">4-2. ÏùåÏïÖÏùò ÏÇ¨ÌöåÏ†Å ÏùòÎØ∏ Î∞è Ïó≠Ìï† (Social Meaning/Role)</h3>
                        <label class="block text-sm font-medium text-gray-700 mb-1">
                            Ïù¥ Í≥°Ïù¥ ÎãπÏãú ÏÇ¨ÌöåÎÇò ÌòÑÏû¨ Ïö∞Î¶¨ÏóêÍ≤å Ïñ¥Îñ§ ÏùòÎØ∏Î•º Ï£ºÎäîÏßÄ, Ïñ¥Îñ§ Ïó≠Ìï†ÏùÑ ÌïòÎäîÏßÄ
                            <span class="text-xs text-gray-500 font-normal">(Ïòà: Ïù¥ Í≥°Ïù¥ ÎÇ≠ÎßåÏ£ºÏùò ÏãúÎåÄ ÏÇ¨ÎûåÎì§ÏóêÍ≤å Ïñ¥Îñ§ Î©îÏãúÏßÄÎ•º Ï†ÑÎã¨ÌñàÎäîÏßÄ, Ïò§ÎäòÎÇ† Ïö∞Î¶¨ÏóêÍ≤å Ïñ¥Îñ§ ÏùòÎØ∏Î•º Ï£ºÎäîÏßÄ)</span>
                        </label>
                        <textarea id="interpScene" oninput="updateField('interpScene', this.value)" rows="3" 
                            placeholder="Ïòà: Ïù¥ Í≥°ÏùÄ ÎÇ≠ÎßåÏ£ºÏùò ÏãúÎåÄÏùò Ï¥àÏûêÏó∞Ï†Å Í≥µÌè¨Î•º Îã§Î£®Î©∞, ÎãπÏãú ÏÇ¨ÎûåÎì§Ïùò Î∂àÏïàÍ≥º ÎëêÎ†§ÏõÄÏùÑ ÏùåÏïÖÏúºÎ°ú ÌëúÌòÑÌñàÏäµÎãàÎã§. Ïò§ÎäòÎÇ†ÏóêÎèÑ Ïö¥Î™ÖÏóê ÎåÄÌïú ÎëêÎ†§ÏõÄÏùÑ Í≥µÍ∞êÌïòÍ≤å ÎßåÎì≠ÎãàÎã§." 
                            class="w-full p-2 border border-gray-300 rounded-md mt-1">${state.appData.interpScene}</textarea>

                        <h3 class="font-bold text-lg text-indigo-600">5-1. ÏòàÏà†Ï†Å Í∞ÄÏπò ÌèâÍ∞Ä (Aesthetic Value)</h3>
                        <label class="block text-sm font-medium text-gray-700 mb-1">
                            Ïó∞Ï£ºÏûêÏùò Ìï¥ÏÑùÏù¥ÎÇò ÏûëÌíàÏùò ÏòàÏà†Ï†Å ÏôÑÏÑ±ÎèÑÏóê ÎåÄÌïú ÎÇòÏùò ÌèâÍ∞Ä
                            <span class="text-xs text-gray-500 font-normal">(Ïù¥ Í≥°Ïù¥ ÏñºÎßàÎÇò ÏòàÏà†Ï†ÅÏúºÎ°ú ÌõåÎ•≠ÌïúÏßÄ, Ïó∞Ï£ºÍ∞Ä ÏñºÎßàÎÇò Ï¢ãÏùÄÏßÄÏóê ÎåÄÌïú ÌèâÍ∞Ä)</span>
                        </label>
                        <textarea id="evalArt" oninput="updateField('evalArt', this.value)" rows="3" 
                            placeholder="Ïòà: Ïù¥ Í≥°ÏùÄ Ìïú Ìé∏Ïùò ÏßßÏùÄ Ïò§ÌéòÎùº Í∞ôÏïÑ ÏòàÏà†Ï†Å Í∞ÄÏπòÍ∞Ä ÎÜíÏúºÎ©∞, Ïó∞Ï£ºÏûêÏùò ÌëúÌòÑÎ†•Ïù¥ Îõ∞Ïñ¥ÎÇ©ÎãàÎã§." 
                            class="w-full p-2 border border-gray-300 rounded-md mt-1">${state.appData.evalArt}</textarea>

                        <h3 class="font-bold text-lg text-indigo-600">5-2. ÏúµÌï© Î∞è ÌôïÏû• Ï†ÅÏö© (Application/Fusion)</h3>
                        <label class="block text-sm font-medium text-gray-700 mb-1">
                            Ïù¥ Í≥°ÏùÑ Îã§Î•∏ ÏòàÏà†(Í∑∏Î¶º, ÏòÅÌôî Îì±)Ïù¥ÎÇò Ïã§ÏÉùÌôúÏóê Ïñ¥ÎñªÍ≤å ÌôúÏö©Ìï† Ïàò ÏûàÏùÑÏßÄ
                            <span class="text-xs text-gray-500 font-normal">(Ïù¥ Í≥°ÏùÑ Ïñ¥ÎîîÏóê, Ïñ¥ÎñªÍ≤å ÏÇ¨Ïö©Ìï† Ïàò ÏûàÏùÑÏßÄÏóê ÎåÄÌïú ÏïÑÏù¥ÎîîÏñ¥)</span>
                        </label>
                        <textarea id="evalApply" oninput="updateField('evalApply', this.value)" rows="3" 
                            placeholder="Ïòà: ÏòÅÌôîÏùò ÌÅ¥ÎùºÏù¥Îß•Ïä§ BGMÏúºÎ°ú ÌôúÏö©ÌïòÍ≥† Ïã∂ÏúºÎ©∞, Î¨¥ÏÑúÏö¥ Ïû•Î©¥Ïù¥ÎÇò Í∏¥Ïû•Í∞ê ÏûàÎäî ÏàúÍ∞ÑÏóê Ïñ¥Ïö∏Î¶¥ Í≤É Í∞ôÏäµÎãàÎã§." 
                            class="w-full p-2 border border-gray-300 rounded-md mt-1">${state.appData.evalApply}</textarea>
                    </div>
                </div>
            `;
        }

        function renderPage4() {
            return `
                <div class="space-y-6">
                    <h2 class="text-xl font-semibold text-red-600 flex items-center">
                        ${icons.BarChart(20)}
                        <span class="ml-2">Í∞êÏÉÅÎ¨∏ ÏßÑÎã® Î∞è Î≥¥ÏôÑ Îã®Í≥Ñ (AI ÌîºÎìúÎ∞± ÏàúÌôò)</span>
                    </h2>

                    ${state.appData.feedback.draftAppreciation ? `
                    <div class="bg-white p-4 rounded-lg shadow-md border border-blue-200">
                        <h3 class="font-bold text-lg text-blue-600 mb-3">üìù ÌïôÏÉùÏùò ÌÜµÌï© Í∞êÏÉÅÎ¨∏ Ï¥àÏïà</h3>
                        <div class="prose text-gray-800 text-sm whitespace-pre-wrap bg-blue-50 p-4 rounded-md">
                            ${state.appData.feedback.draftAppreciation}
                        </div>
                    </div>
                    ` : ''}

                    <div class="bg-white p-4 rounded-lg shadow-md border border-red-200 space-y-4">
                        <h3 class="font-bold text-lg text-green-600">AI ÏßÑÎã® - ÏûòÎêú Ï†ê (Ïπ≠Ï∞¨)</h3>
                        <p class="text-sm text-gray-800 bg-green-50 p-3 rounded-md">${state.appData.feedback.goodPoints}</p>

                        <h3 class="font-bold text-lg text-red-600">AI ÏßÑÎã® - Î≥¥ÏôÑÌï† Ï†ê (ÏßÑÎã®)</h3>
                        <p class="text-sm text-gray-800 bg-red-50 p-3 rounded-md">${state.appData.feedback.badPoints}</p>

                        <h3 class="font-bold text-lg text-indigo-600">AI Ïã¨Ìôî ÏßàÎ¨∏ (Íµ¨Ï°∞ÌôîÎêú ÏßàÎ¨∏)</h3>
                        <p class="text-sm font-semibold text-gray-900 bg-indigo-50 p-3 rounded-md">${state.appData.feedback.structuredQuestion}</p>
                    </div>

                    <div class="space-y-2">
                        <label class="block text-sm font-bold text-gray-700">Í∞êÏÉÅÎ¨∏ Î≥¥ÏôÑ ÎÇ¥Ïö© ÏßÅÏ†ë ÏûÖÎ†•</label>
                        <textarea id="feedbackInput" oninput="state.feedbackInput = this.value" rows="5" 
                            placeholder="AIÏùò ÏßàÎ¨∏ÏùÑ Ï∞∏Í≥†ÌïòÏó¨ Í∞êÏÉÅÎ¨∏ÏùÑ Î≥¥ÏôÑÌï† ÎÇ¥Ïö©ÏùÑ ÏßÅÏ†ë ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî." 
                            class="w-full p-2 border border-red-300 rounded-md focus:ring-red-500 focus:border-red-500">${state.feedbackInput}</textarea>
                    </div>
                </div>
            `;
        }

        // Î†àÏù¥Îçî Ï∞®Ìä∏ Ï¥àÍ∏∞Ìôî Ìï®Ïàò
        function initRadarChart(containerId) {
            const container = document.getElementById(containerId);
            if (!container) return;

            container.innerHTML = '';
            
            const canvas = document.createElement('canvas');
            canvas.width = 400;
            canvas.height = 400;
            container.appendChild(canvas);
            
            const ctx = canvas.getContext('2d');
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const radius = 150;
            
            const labels = ['Í∞êÍ∞ÅÏ†Å\nÎØºÍ∞êÎèÑ', 'Í∏∞Ïà†Ï†Å\nÏ†ïÌôïÎèÑ', 'Î∂ÑÏÑùÏ†Å\nÏù¥Ìï¥ÎèÑ', 'ÎÖºÎ¶¨Ï†Å\nÏùºÍ¥ÄÏÑ±', 'Ïã¨ÎØ∏Ï†Å\nÌÜµÏ∞∞Î†•'];
            const scores = state.appData.scores;
            const maxScore = 100;
            
            // Î∞∞Í≤Ω Í∑∏Î¶¨Í∏∞
            ctx.strokeStyle = '#e5e7eb';
            ctx.lineWidth = 1;
            
            // ÎèôÏã¨Ïõê Í∑∏Î¶¨Í∏∞ (5Í∞ú)
            for (let i = 1; i <= 5; i++) {
                ctx.beginPath();
                ctx.arc(centerX, centerY, (radius * i) / 5, 0, Math.PI * 2);
                ctx.stroke();
            }
            
            // Ï∂ï Í∑∏Î¶¨Í∏∞ (5Í∞ú)
            for (let i = 0; i < 5; i++) {
                const angle = (Math.PI * 2 * i) / 5 - Math.PI / 2;
                const x = centerX + Math.cos(angle) * radius;
                const y = centerY + Math.sin(angle) * radius;
                
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.lineTo(x, y);
                ctx.stroke();
                
                // ÎùºÎ≤® Í∑∏Î¶¨Í∏∞
                const labelX = centerX + Math.cos(angle) * (radius + 30);
                const labelY = centerY + Math.sin(angle) * (radius + 30);
                ctx.fillStyle = '#374151';
                ctx.font = '12px Inter';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(labels[i], labelX, labelY);
            }
            
            // Îç∞Ïù¥ÌÑ∞ ÏòÅÏó≠ Í∑∏Î¶¨Í∏∞
            ctx.fillStyle = 'rgba(59, 130, 246, 0.3)';
            ctx.strokeStyle = '#3B82F6';
            ctx.lineWidth = 2;
            ctx.beginPath();
            
            for (let i = 0; i < 5; i++) {
                const angle = (Math.PI * 2 * i) / 5 - Math.PI / 2;
                const score = scores[i] || 50;
                const distance = (radius * score) / maxScore;
                const x = centerX + Math.cos(angle) * distance;
                const y = centerY + Math.sin(angle) * distance;
                
                if (i === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            }
            ctx.closePath();
            ctx.fill();
            ctx.stroke();
            
            // Ï†ê Í∑∏Î¶¨Í∏∞
            ctx.fillStyle = '#3B82F6';
            for (let i = 0; i < 5; i++) {
                const angle = (Math.PI * 2 * i) / 5 - Math.PI / 2;
                const score = scores[i] || 50;
                const distance = (radius * score) / maxScore;
                const x = centerX + Math.cos(angle) * distance;
                const y = centerY + Math.sin(angle) * distance;
                
                ctx.beginPath();
                ctx.arc(x, y, 4, 0, Math.PI * 2);
                ctx.fill();
                
                // Ï†êÏàò ÌëúÏãú
                ctx.fillStyle = '#1F2937';
                ctx.font = '11px Inter';
                ctx.fillText(`${score}Ï†ê`, x + 15, y);
                ctx.fillStyle = '#3B82F6';
            }
        }

        // =========================
        // ÌÅ¥ÎùºÏö∞Îìú ÏãúÍ∞ÅÌôî Ìï®ÏàòÎì§
        // =========================

        // 1. ÌÇ§ÏõåÎìú ÏõåÎìú ÌÅ¥ÎùºÏö∞Îìú ÏÉùÏÑ±
        function createKeywordCloud(studentsData, containerId) {
            const container = document.getElementById(containerId);
            if (!container) {
                console.error('ÏõåÎìú ÌÅ¥ÎùºÏö∞Îìú Ïª®ÌÖåÏù¥ÎÑàÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§:', containerId);
                return;
            }
            
            console.log('ÏõåÎìú ÌÅ¥ÎùºÏö∞Îìú ÏÉùÏÑ± ÏãúÏûë, ÌïôÏÉù Îç∞Ïù¥ÌÑ∞:', studentsData);
            
            // Î™®Îì† ÌïôÏÉùÏùò ÌÇ§ÏõåÎìúÎ•º ÏàòÏßëÌïòÍ≥† ÎπàÎèÑ Í≥ÑÏÇ∞
            const keywordFrequency = {};
            studentsData.forEach((student, index) => {
                console.log(`ÌïôÏÉù ${index + 1} ÌÇ§ÏõåÎìú:`, student.senseKeywords);
                if (student.senseKeywords && Array.isArray(student.senseKeywords)) {
                    student.senseKeywords.forEach(keyword => {
                        const trimmed = keyword.trim();
                        if (trimmed) {
                            keywordFrequency[trimmed] = (keywordFrequency[trimmed] || 0) + 1;
                        }
                    });
                } else if (student.senseKeywords && typeof student.senseKeywords === 'string') {
                    // Î¨∏ÏûêÏó¥Ïù∏ Í≤ΩÏö∞ ÏâºÌëúÎ°ú Î∂ÑÎ¶¨
                    student.senseKeywords.split(',').forEach(keyword => {
                        const trimmed = keyword.trim();
                        if (trimmed) {
                            keywordFrequency[trimmed] = (keywordFrequency[trimmed] || 0) + 1;
                        }
                    });
                }
            });
            
            console.log('ÌÇ§ÏõåÎìú ÎπàÎèÑ:', keywordFrequency);
            
            if (Object.keys(keywordFrequency).length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-8">ÌÇ§ÏõåÎìú Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.</p>';
                return;
            }
            
            // wordcloud2.js ÌòïÏãùÏúºÎ°ú Î≥ÄÌôò
            const wordList = Object.entries(keywordFrequency)
                .map(([text, weight]) => ({
                    text,
                    size: Math.max(20, weight * 15) // ÏµúÏÜå 20px, ÎπàÎèÑÏóê Îî∞Îùº ÌÅ¨Í∏∞ Ï°∞Ï†ï
                }))
                .sort((a, b) => b.size - a.size); // ÌÅ¨Í∏∞ Ïàú Ï†ïÎ†¨
            
            // Í∞ÑÎã®Ìïú ÌÖçÏä§Ìä∏ Í∏∞Î∞ò ÏõåÎìú ÌÅ¥ÎùºÏö∞Îìú ÏÉùÏÑ± (wordcloud2.js Ïò§Î•ò ÎåÄÏã†)
            container.innerHTML = '';
            
            // ÌÇ§ÏõåÎìúÎ•º ÎπàÎèÑÏàúÏúºÎ°ú Ï†ïÎ†¨
            const sortedKeywords = Object.entries(keywordFrequency)
                .sort((a, b) => b[1] - a[1]);
            
            const maxFrequency = Math.max(...sortedKeywords.map(([_, freq]) => freq));
            
            // ÏõåÎìú ÌÅ¥ÎùºÏö∞Îìú HTML ÏÉùÏÑ±
            const cloudHTML = `
                <div class="flex flex-wrap items-center justify-center gap-3 p-6 bg-white rounded-lg border border-gray-200">
                    ${sortedKeywords.map(([keyword, frequency]) => {
                        // ÎπàÎèÑÏóê Îî∞Îùº ÌÅ¨Í∏∞ÏôÄ ÏÉâÏÉÅ Í≤∞Ï†ï
                        const sizeRatio = frequency / maxFrequency;
                        const fontSize = Math.max(16, Math.min(48, 20 + sizeRatio * 28));
                        const opacity = 0.6 + sizeRatio * 0.4;
                        const hue = 220 - sizeRatio * 40;
                        
                        return `
                            <span 
                                class="inline-block px-3 py-1 rounded-full font-semibold transition-transform hover:scale-110 cursor-default"
                                style="font-size: ${fontSize}px; color: hsl(${hue}, 70%, ${50 - sizeRatio * 20}%); opacity: ${opacity};"
                                title="${keyword}: ${frequency}Ìöå"
                            >
                                ${keyword}
                                <span class="text-xs ml-1 opacity-70">(${frequency})</span>
                            </span>
                        `;
                    }).join('')}
                </div>
            `;
            
            container.innerHTML = cloudHTML;
            
            // wordcloud2.jsÎäî Ïò§Î•òÍ∞Ä ÎßéÏïÑÏÑú HTML/CSS Î≤ÑÏ†ÑÎßå ÏÇ¨Ïö©
            // ÌïÑÏöîÏãú ÏàòÎèôÏúºÎ°ú ÏÉàÎ°úÍ≥†Ïπ® Î≤ÑÌäºÏùÑ ÎàåÎü¨ ÏµúÏã† Îç∞Ïù¥ÌÑ∞ ÌôïÏù∏
        }

        // 2. ÏÉâÏÉÅ Î∂ÑÌè¨ ÏãúÍ∞ÅÌôî
        function createColorDistribution(studentsData, containerId) {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            // ÏÉâÏÉÅ ÎπàÎèÑ Í≥ÑÏÇ∞ (ÏÉâÏÉÅ Í∞í Í∏∞Ï§Ä)
            const colorFrequency = {};
            studentsData.forEach(student => {
                if (student.senseColors && Array.isArray(student.senseColors)) {
                    student.senseColors.forEach(color => {
                        const trimmed = color.trim();
                        if (trimmed) {
                            colorFrequency[trimmed] = (colorFrequency[trimmed] || 0) + 1;
                        }
                    });
                }
            });
            
            if (Object.keys(colorFrequency).length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-8">ÏÉâÏÉÅ Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.</p>';
                return;
            }
            
            // ÏÉâÏÉÅ ÌåîÎ†àÌä∏ÏóêÏÑú Ïù¥Î¶Ñ Ï∞æÍ∏∞
            const colorData = Object.entries(colorFrequency)
                .map(([colorValue, count]) => {
                    // ÏÉâÏÉÅ Í∞íÏóêÏÑú Ïã§Ï†ú hex ÏÉâÏÉÅ Ï∂îÏ∂ú
                    let actualColorValue = colorValue;
                    let colorInfo = COLOR_PALETTE.find(p => colorValue.includes(p.value));
                    
                    // "ÌååÎûë(ÌèâÌôî, Í≥†Ïöî)" ÌòïÏãùÏóêÏÑú ÏÉâÏÉÅ Ïù¥Î¶ÑÏúºÎ°ú Ï∞æÍ∏∞
                    if (!colorInfo) {
                        colorInfo = COLOR_PALETTE.find(p => colorValue.includes(p.name));
                        if (colorInfo) {
                            actualColorValue = colorInfo.value;
                        }
                    } else {
                        actualColorValue = colorInfo.value;
                    }
                    
                    return {
                        value: actualColorValue,
                        name: colorInfo ? colorInfo.name : colorValue,
                        description: colorInfo ? colorInfo.description : '',
                        count: count,
                        percentage: ((count / studentsData.length) * 100).toFixed(1)
                    };
                })
                .sort((a, b) => b.count - a.count);
            
            // ÏãúÍ∞ÅÌôî HTML ÏÉùÏÑ±
            container.innerHTML = `
                <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                    ${colorData.map(color => `
                        <div class="bg-white p-4 rounded-lg shadow-md border-2 transition-transform hover:scale-105" 
                             style="border-color: ${color.value};">
                            <div class="flex items-center gap-3 mb-2">
                                <div class="w-12 h-12 rounded-full shadow-md" 
                                     style="background-color: ${color.value};"></div>
                                <div class="flex-1">
                                    <div class="font-semibold text-gray-800">${color.name}</div>
                                    <div class="text-xs text-gray-500">${color.description}</div>
                                </div>
                            </div>
                            <div class="text-sm text-gray-600">
                                <div class="font-bold text-indigo-600 text-lg">${color.count}Î™Ö</div>
                                <div class="text-xs text-gray-400">Ï†ÑÏ≤¥Ïùò ${color.percentage}%</div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // 3. ÌÜµÍ≥Ñ ÏöîÏïΩ ÏÉùÏÑ±
        function createStatistics(studentsData, containerId) {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            const totalStudents = studentsData.length;
            const uniqueMusics = new Set(
                studentsData.map(s => `${s.title || 'ÎØ∏ÏûÖÎ†•'} - ${s.composer || 'ÎØ∏ÏûÖÎ†•'}`)
            ).size;
            
            const avgScores = {
                sense: 0,
                tech: 0,
                analysis: 0,
                consistency: 0,
                aesthetic: 0
            };
            
            let scoreCount = 0;
            studentsData.forEach(s => {
                if (s.scores) {
                    avgScores.sense += s.scores.senseScore || 0;
                    avgScores.tech += s.scores.techScore || 0;
                    avgScores.analysis += s.scores.analysisScore || 0;
                    avgScores.consistency += s.scores.consistencyScore || 0;
                    avgScores.aesthetic += s.scores.aestheticScore || 0;
                    scoreCount++;
                }
            });
            
            if (scoreCount > 0) {
                Object.keys(avgScores).forEach(key => {
                    avgScores[key] = (avgScores[key] / scoreCount).toFixed(1);
                });
            }
            
            container.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
                        <div class="text-sm text-blue-600 font-medium">Ï¥ù ÌïôÏÉù Ïàò</div>
                        <div class="text-3xl font-bold text-blue-700 mt-2">${totalStudents}Î™Ö</div>
                    </div>
                    <div class="bg-green-50 p-4 rounded-lg border border-green-200">
                        <div class="text-sm text-green-600 font-medium">Í∞êÏÉÅÌïú ÏïÖÍ≥° Ïàò</div>
                        <div class="text-3xl font-bold text-green-700 mt-2">${uniqueMusics}Í≥°</div>
                    </div>
                    <div class="bg-purple-50 p-4 rounded-lg border border-purple-200">
                        <div class="text-sm text-purple-600 font-medium">ÌèâÍ∑† Í∞êÍ∞ÅÏ†Å ÎØºÍ∞êÎèÑ</div>
                        <div class="text-3xl font-bold text-purple-700 mt-2">${avgScores.sense}Ï†ê</div>
                    </div>
                </div>
            `;
        }

        // 4. ÌïôÏÉù Îç∞Ïù¥ÌÑ∞ Í∞ÄÏ†∏Ïò§Í∏∞
        async function fetchStudentsData(filters = {}) {
            try {
                let url = `${API_BASE_URL}/api/students-data`;
                const params = new URLSearchParams();
                
                if (filters.title) params.append('title', filters.title);
                if (filters.composer) params.append('composer', filters.composer);
                if (filters.limit) params.append('limit', filters.limit);
                
                if (params.toString()) {
                    url += '?' + params.toString();
                }
                
                const response = await fetch(url, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    cache: 'no-cache'
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data.success) {
                    return data.students || [];
                } else {
                    console.error('Îç∞Ïù¥ÌÑ∞ Í∞ÄÏ†∏Ïò§Í∏∞ Ïã§Ìå®:', data.error);
                    return [];
                }
            } catch (error) {
                // Ïò§Î•òÎ•º Ìïú Î≤àÎßå Î°úÍ∑∏Î°ú Ï∂úÎ†•
                if (!window._fetchErrorLogged) {
                    console.error('ÌïôÏÉù Îç∞Ïù¥ÌÑ∞ Í∞ÄÏ†∏Ïò§Í∏∞ Ïã§Ìå®:', error.message);
                    window._fetchErrorLogged = true;
                    setTimeout(() => { window._fetchErrorLogged = false; }, 5000); // 5Ï¥à ÌõÑ Î¶¨ÏÖã
                }
                return [];
            }
        }

        // 5. ÎπÑÍµê ÌéòÏù¥ÏßÄ Î†åÎçîÎßÅ
        function renderComparisonPage() {
            return `
                <div class="space-y-6">
                    <h2 class="text-2xl font-bold text-indigo-700 flex items-center">
                        ${icons.BarChart(24)}
                        <span class="ml-2">üìä Í∞êÍ∞ÅÏ†Å Í∞êÏÉÅ ÎπÑÍµê Î∂ÑÏÑù</span>
                    </h2>
                    
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center gap-2">
                                <span class="text-2xl">üí°</span>
                                <div>
                                    <p class="text-sm font-semibold text-blue-800">Ïã§ÏãúÍ∞Ñ Îç∞Ïù¥ÌÑ∞ ÏóÖÎç∞Ïù¥Ìä∏</p>
                                    <p class="text-xs text-blue-600">ÌïôÏÉùÎì§Ïù¥ ÏôÑÎ£å Î≤ÑÌäºÏùÑ ÎàÑÎ•¥Î©¥ ÏûêÎèôÏúºÎ°ú Îç∞Ïù¥ÌÑ∞Í∞Ä ÏàòÏßëÎê©ÎãàÎã§. ÏÉàÎ°úÍ≥†Ïπ® Î≤ÑÌäºÏùÑ ÎàåÎü¨ ÏµúÏã† Îç∞Ïù¥ÌÑ∞Î•º ÌôïÏù∏ÌïòÏÑ∏Ïöî.</p>
                                </div>
                            </div>
                            <button onclick="refreshComparison()" 
                                    class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors text-sm font-semibold shadow-md">
                                üîÑ ÏÉàÎ°úÍ≥†Ïπ®
                            </button>
                        </div>
                    </div>
                    
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-xl font-semibold text-gray-700">ÌÇ§ÏõåÎìú ÌÅ¥ÎùºÏö∞Îìú</h3>
                            <span class="text-sm text-gray-500" id="data-count-info">Î°úÎî© Ï§ë...</span>
                        </div>
                        <div id="keyword-cloud-container" class="w-full flex justify-center items-center bg-gray-50 p-4 rounded-lg min-h-[500px]"></div>
                    </div>
                    
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h3 class="text-xl font-semibold text-gray-700 mb-4">ÏÉâÏÉÅ Î∂ÑÌè¨</h3>
                        <div id="color-distribution-container"></div>
                    </div>
                    
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h3 class="text-xl font-semibold text-gray-700 mb-4">ÌÜµÍ≥Ñ ÏöîÏïΩ</h3>
                        <div id="statistics-container"></div>
                    </div>
                </div>
            `;
        }

        // 6. ÎπÑÍµê ÌéòÏù¥ÏßÄ Ï¥àÍ∏∞Ìôî
        async function initComparisonPage() {
            // Ï§ëÎ≥µ Ìò∏Ï∂ú Î∞©ÏßÄ
            if (state.loading || state.comparisonPageInitialized) {
                console.log('Ïù¥ÎØ∏ Ï¥àÍ∏∞Ìôî Ï§ëÏù¥Í±∞ÎÇò ÏôÑÎ£åÎêòÏóàÏäµÎãàÎã§. Ï§ëÎ≥µ Ìò∏Ï∂úÏùÑ Í±¥ÎÑàÎúÅÎãàÎã§.');
                return;
            }
            
            state.loading = true;
            state.comparisonPageInitialized = true; // Ï¥àÍ∏∞Ìôî ÏãúÏûë ÌëúÏãú
            
            // render() Ìò∏Ï∂úÌïòÏßÄ ÏïäÍ≥† ÏßÅÏ†ë DOM ÏóÖÎç∞Ïù¥Ìä∏
            const container = document.getElementById('keyword-cloud-container');
            if (container) {
                container.innerHTML = '<p class="text-gray-500 text-center py-8">Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨Ïò§Îäî Ï§ë...</p>';
            }
            
            const studentsData = await fetchStudentsData();
            
            if (studentsData.length === 0) {
                // Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏùÑ Îïå Îçî Î™ÖÌôïÌïú ÏïàÎÇ¥ Î©îÏãúÏßÄ
                const container = document.getElementById('keyword-cloud-container');
                if (container) {
                    container.innerHTML = `
                        <div class="w-full text-center py-12">
                            <div class="text-6xl mb-4">üì≠</div>
                            <h3 class="text-xl font-semibold text-gray-700 mb-2">ÏïÑÏßÅ Ï†úÏ∂úÎêú Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§</h3>
                            <p class="text-gray-500 mb-4">
                                ÌïôÏÉùÎì§Ïù¥ Í∞êÏÉÅÎ¨∏ÏùÑ ÏûëÏÑ±ÌïòÍ≥† <strong>ÏôÑÎ£å Î≤ÑÌäº</strong>ÏùÑ ÎàåÎü¨Ïïº<br>
                                ÎπÑÍµê Î∂ÑÏÑù Îç∞Ïù¥ÌÑ∞Í∞Ä ÏàòÏßëÎê©ÎãàÎã§.
                            </p>
                            <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 text-left max-w-md mx-auto text-sm text-gray-700">
                                <p class="font-semibold mb-2">üìã Îç∞Ïù¥ÌÑ∞ ÏàòÏßë Î∞©Î≤ï:</p>
                                <ol class="list-decimal list-inside space-y-1">
                                    <li>ÌïôÏÉùÏù¥ 1~3Îã®Í≥Ñ Í∞êÏÉÅ ÏûÖÎ†•</li>
                                    <li>AI ÏßÑÎã® Î∞è Î≥¥ÏôÑ ÎÇ¥Ïö© ÏûÖÎ†•</li>
                                    <li>ÏµúÏ¢Ö Í∞êÏÉÅÎ¨∏ ÏôÑÏÑ±</li>
                                    <li><strong>ÏôÑÎ£å Î≤ÑÌäº ÌÅ¥Î¶≠</strong> ‚Üê Ïù¥ Îã®Í≥ÑÏóêÏÑú Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû•</li>
                                </ol>
                            </div>
                            <button onclick="refreshComparison()" 
                                    class="mt-6 px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors font-semibold">
                                üîÑ ÏÉàÎ°úÍ≥†Ïπ®
                            </button>
                        </div>
                    `;
                }
                
                const colorContainer = document.getElementById('color-distribution-container');
                if (colorContainer) {
                    colorContainer.innerHTML = '<p class="text-gray-500 text-center py-8">Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.</p>';
                }
                
                const statsContainer = document.getElementById('statistics-container');
                if (statsContainer) {
                    statsContainer.innerHTML = '<p class="text-gray-500 text-center py-8">Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.</p>';
                }
                
                state.loading = false;
                state.comparisonPageInitialized = false; // Ïã§Ìå® Ïãú ÌîåÎûòÍ∑∏ Î¶¨ÏÖã
                return;
            }
            
            createKeywordCloud(studentsData, 'keyword-cloud-container');
            createColorDistribution(studentsData, 'color-distribution-container');
            createStatistics(studentsData, 'statistics-container');
            
            // Îç∞Ïù¥ÌÑ∞ Í∞úÏàò ÌëúÏãú ÏóÖÎç∞Ïù¥Ìä∏
            const countInfo = document.getElementById('data-count-info');
            if (countInfo) {
                countInfo.textContent = `Ï¥ù ${studentsData.length}Î™ÖÏùò Îç∞Ïù¥ÌÑ∞`;
            }
            
            state.loading = false;
            // render() Ìò∏Ï∂úÌïòÏßÄ ÏïäÏùå - Î¨¥Ìïú Î£®ÌîÑ Î∞©ÏßÄ
        }

        // 7. ÏÉàÎ°úÍ≥†Ïπ® Ìï®Ïàò
        async function refreshComparison() {
            if (state.loading) {
                console.log('Ïù¥ÎØ∏ Î°úÎî© Ï§ëÏûÖÎãàÎã§. ÏÉàÎ°úÍ≥†Ïπ®ÏùÑ Í±¥ÎÑàÎúÅÎãàÎã§.');
                return;
            }
            await initComparisonPage();
        }

        function renderPage5() {
            // Initialize radar chart after render
            setTimeout(() => initRadarChart('radar-chart-container'), 100);

            return `
                <div class="space-y-6">
                    <h2 class="text-2xl font-bold text-indigo-700 flex items-center">
                        ${icons.Feather(24)}
                        <span class="ml-2">ÏµúÏ¢Ö Í∞êÏÉÅ Î≥¥Í≥†ÏÑú Î∞è ÌôúÏö© Ï†ÑÎûµ</span>
                    </h2>

                    <h3 class="text-xl font-semibold text-gray-700">1. Í∞êÏÉÅ Îä•Î†• ÏßÄÌëú ÏãúÍ∞ÅÌôî (AI Î∂ÑÏÑù Í≤∞Í≥º)</h3>
                    <div id="radar-chart-container" class="w-full flex justify-center items-center bg-white p-4 rounded-xl shadow-lg border border-indigo-200"></div>
                    
                    <div class="grid grid-cols-5 gap-2 text-center text-xs font-semibold text-gray-700 bg-gray-100 p-2 rounded-lg">
                        <div class="flex flex-col items-center justify-center">
                            ${icons.Eye(14)}
                            <span class="mt-1">Í∞êÍ∞ÅÏ†Å<br>ÎØºÍ∞êÎèÑ</span>
                            <span class="text-indigo-600 font-bold">${state.appData.scores[0]}Ï†ê</span>
                        </div>
                        <div class="flex flex-col items-center justify-center">
                            ${icons.Gauge(14)}
                            <span class="mt-1">Í∏∞Ïà†Ï†Å<br>Ï†ïÌôïÎèÑ</span>
                            <span class="text-indigo-600 font-bold">${state.appData.scores[1]}Ï†ê</span>
                        </div>
                        <div class="flex flex-col items-center justify-center">
                            ${icons.BarChart(14)}
                            <span class="mt-1">Î∂ÑÏÑùÏ†Å<br>Ïù¥Ìï¥ÎèÑ</span>
                            <span class="text-indigo-600 font-bold">${state.appData.scores[2]}Ï†ê</span>
                        </div>
                        <div class="flex flex-col items-center justify-center">
                            ${icons.MessageCircle(14)}
                            <span class="mt-1">ÎÖºÎ¶¨Ï†Å<br>ÏùºÍ¥ÄÏÑ±</span>
                            <span class="text-indigo-600 font-bold">${state.appData.scores[3]}Ï†ê</span>
                        </div>
                        <div class="flex flex-col items-center justify-center">
                            ${icons.Lightbulb(14)}
                            <span class="mt-1">Ïã¨ÎØ∏Ï†Å<br>ÌÜµÏ∞∞Î†•</span>
                            <span class="text-indigo-600 font-bold">${state.appData.scores[4]}Ï†ê</span>
                        </div>
                    </div>

                    <div class="space-y-4">
                        <h3 class="text-xl font-semibold text-indigo-600">2. Í∞êÏÉÅÎ¨∏ ÎπÑÍµê</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="bg-white p-4 rounded-lg shadow-md border border-indigo-200">
                                <h4 class="font-bold text-lg text-indigo-600 mb-2">üìù ÌïôÏÉùÏùò Î≥¥ÏôÑÎêú ÏµúÏ¢Ö Í∞êÏÉÅÎ¨∏</h4>
                                <div class="prose text-gray-800 text-sm whitespace-pre-wrap max-h-96 overflow-y-auto">
                                    ${state.appData.finalAppreciation || "ÏµúÏ¢Ö Í∞êÏÉÅÎ¨∏ ÏÉùÏÑ± Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÍ±∞ÎÇò Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§."}
                                </div>
                            </div>
                            <div class="bg-white p-4 rounded-lg shadow-md border border-green-200">
                                <h4 class="font-bold text-lg text-green-600 mb-2">‚≠ê Î™®Î≤î Í∞êÏÉÅÎ¨∏ ÏòàÏãú</h4>
                                <div class="prose text-gray-800 text-sm whitespace-pre-wrap max-h-96 overflow-y-auto bg-green-50 p-3 rounded">
                                    ${state.appData.feedback.modelAppreciation || "Î™®Î≤î Í∞êÏÉÅÎ¨∏Ïù¥ ÏÉùÏÑ±ÎêòÏßÄ ÏïäÏïòÏäµÎãàÎã§."}
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="space-y-3 bg-white p-4 rounded-lg shadow-md border border-green-200">
                        <h3 class="text-xl font-semibold text-green-600">3. ÎØ∏Îûò ÌôúÎèô Ïó∞Í≥Ñ ÌôúÏö© Ï†ÑÎûµ</h3>
                        <div class="text-sm space-y-2">
                            <p><strong class="text-blue-700">‚ñ∂ Ïó∞Ï£º Ï†ÑÎûµ:</strong> ${state.appData.strategy.performance}</p>
                            <p><strong class="text-blue-700">‚ñ∂ Í∞êÏÉÅ Ï†ÑÎûµ:</strong> ${state.appData.strategy.appreciation}</p>
                            <p><strong class="text-blue-700">‚ñ∂ Ï∞ΩÏûë Ï†ÑÎûµ:</strong> ${state.appData.strategy.composition}</p>
                        </div>
                    </div>
                    
                    <div class="text-center mt-6">
                        <button onclick="state.page = 6; render();" 
                                class="px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors font-semibold shadow-lg">
                            üìä Ï†ÑÏ≤¥ ÎπÑÍµê Î∂ÑÏÑù Î≥¥Í∏∞
                        </button>
                    </div>
                </div>
            `;
        }

        function renderFooter() {
            const buttonText = state.loading ? "AI Î∂ÑÏÑù Ï§ë..." : 
                state.page === 0 ? "Îã§Ïùå Îã®Í≥ÑÎ°ú Ïù¥Îèô" :
                state.page === 1 || state.page === 2 ? "Îã§Ïùå Îã®Í≥ÑÎ°ú Ïù¥Îèô" :
                state.page === 3 ? "AI ÏßÑÎã® ÏãúÏûë" :
                state.page === 4 ? "ÏµúÏ¢Ö Í∞êÏÉÅÎ¨∏ ÏôÑÏÑ±" :
                state.page === 6 ? "ÏµúÏ¢Ö Í∞êÏÉÅÎ¨∏ÏúºÎ°ú ÎèåÏïÑÍ∞ÄÍ∏∞" :
                "ÏôÑÎ£å";
            
            const disabled = state.loading;
            const buttonClass = disabled 
                ? 'bg-gray-400' 
                : 'bg-indigo-600 hover:bg-indigo-700 shadow-xl';

            return `
                <footer class="fixed bottom-0 left-0 right-0 max-w-4xl mx-auto bg-white p-4 border-t shadow-2xl">
                    <button onclick="handleNext()" ${disabled ? 'disabled' : ''} 
                        class="w-full py-3 px-4 rounded-lg font-bold text-white transition-colors duration-300 ${buttonClass}">
                        ${buttonText}
                    </button>
                </footer>
            `;
        }

        function renderModal() {
            if (!state.showErrorModal) return '';
            
            return `
                <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                    <div class="bg-white p-6 rounded-xl shadow-2xl max-w-sm w-full space-y-4">
                        <h3 class="text-xl font-bold text-red-600 flex items-center">
                            ${icons.X(20)}
                            <span class="ml-2">Ïò§Î•ò Î∞úÏÉù</span>
                        </h3>
                        <p class="text-gray-700">${state.errorMessage}</p>
                        <button onclick="closeModal()" 
                            class="w-full py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors">
                            Îã´Í∏∞
                        </button>
                    </div>
                </div>
            `;
        }

        // =========================
        // Main Render Function
        // =========================
        function render() {
            const pageContent = 
                state.page === 0 ? renderPage0() :
                state.page === 1 ? renderPage1() :
                state.page === 2 ? renderPage2() :
                state.page === 3 ? renderPage3() :
                state.page === 4 ? renderPage4() :
                state.page === 5 ? renderPage5() :
                state.page === 6 ? renderComparisonPage() :
                '<div>Ïïå Ïàò ÏóÜÎäî ÌéòÏù¥ÏßÄ</div>';
            
            // Page 6 Ï¥àÍ∏∞Ìôî (Ìïú Î≤àÎßå Ïã§Ìñâ)
            if (state.page === 6 && !state.comparisonPageInitialized) {
                // ÌéòÏù¥ÏßÄÍ∞Ä 6ÏúºÎ°ú Î≥ÄÍ≤ΩÎêòÏóàÍ≥† ÏïÑÏßÅ Ï¥àÍ∏∞ÌôîÎêòÏßÄ ÏïäÏïòÏùÑ ÎïåÎßå Ïã§Ìñâ
                setTimeout(() => initComparisonPage(), 100);
            } else if (state.page !== 6) {
                // Îã§Î•∏ ÌéòÏù¥ÏßÄÎ°ú Ïù¥ÎèôÌïòÎ©¥ Ï¥àÍ∏∞Ìôî ÌîåÎûòÍ∑∏ Î¶¨ÏÖã
                state.comparisonPageInitialized = false;
            }

            const html = `
                <div class="max-w-4xl mx-auto p-4 sm:p-6 bg-gray-50 rounded-xl shadow-2xl min-h-screen">
                    ${renderHeader()}
                    ${renderStepIndicator()}
                    <div class="mt-4 pb-24">
                        ${pageContent}
                    </div>
                    ${renderFooter()}
                    ${renderModal()}
                </div>
            `;

            document.getElementById('app').innerHTML = html;
            
            // ÌéòÏù¥ÏßÄ Î†åÎçîÎßÅ ÌõÑ Í∞Å Í∏∞Îä• Ï¥àÍ∏∞Ìôî
            if (state.page === 1) {
                setTimeout(() => {
                    // ÏßÄÎèÑ Ï¥àÍ∏∞Ìôî
                    if (state.appData.senseExpressionType.includes('space')) {
                        initSpaceMap();
                    }
                    // ÎèÑÌòï Í∑∏Î¶¨Í∏∞ Ï∫îÎ≤ÑÏä§ Ï¥àÍ∏∞Ìôî
                    if (state.appData.senseExpressionType.includes('pattern')) {
                        initPatternCanvas();
                    }
                }, 100);
            }
        }

        // =========================
        // Event Handlers (Global)
        // =========================
        function updateField(field, value) {
            state.appData[field] = value;
        }

        function toggleKeyword(keyword) {
            const idx = state.appData.senseKeywords.indexOf(keyword);
            if (idx > -1) {
                state.appData.senseKeywords.splice(idx, 1);
            } else {
                if (state.appData.senseKeywords.length < 3) {
                    state.appData.senseKeywords.push(keyword);
                }
            }
            render();
        }

        function toggleColor(colorValue) {
            const idx = state.appData.senseColors.indexOf(colorValue);
            if (idx > -1) {
                // Ïù¥ÎØ∏ ÏÑ†ÌÉùÎêú ÏÉâÏÉÅÏù¥Î©¥ Ï†úÍ±∞
                state.appData.senseColors.splice(idx, 1);
            } else {
                // ÏµúÎåÄ 4Í∞úÍπåÏßÄ ÏÑ†ÌÉù Í∞ÄÎä•
                if (state.appData.senseColors.length < 4) {
                    state.appData.senseColors.push(colorValue);
                }
            }
            render();
        }

        function toggleExpressionType(type) {
            const idx = state.appData.senseExpressionType.indexOf(type);
            if (idx > -1) {
                // Ïù¥ÎØ∏ ÏÑ†ÌÉùÎêú ÌÉÄÏûÖÏù¥Î©¥ Ï†úÍ±∞
                state.appData.senseExpressionType.splice(idx, 1);
                // ÏÑ†ÌÉùÎêú ÌÉÄÏûÖÏù¥ ÏóÜÏúºÎ©¥ ÌÖçÏä§Ìä∏ÎèÑ Ï¥àÍ∏∞Ìôî
                if (state.appData.senseExpressionType.length === 0) {
                    state.appData.senseExpressionText = '';
                }
                // Í∞Å ÌÉÄÏûÖÎ≥Ñ Îç∞Ïù¥ÌÑ∞ÎèÑ Ï¥àÍ∏∞Ìôî
                if (type === 'movement') state.appData.senseExpressionMovement = null;
                if (type === 'space') state.appData.senseExpressionSpace = null;
                if (type === 'pattern') state.appData.senseExpressionPattern = null;
            } else {
                // ÏµúÎåÄ 2Í∞úÍπåÏßÄ ÏÑ†ÌÉù Í∞ÄÎä•
                if (state.appData.senseExpressionType.length < 2) {
                    state.appData.senseExpressionType.push(type);
                } else {
                    alert('ÌëúÌòÑ Î∞©ÏãùÏùÄ ÏµúÎåÄ 2Í∞úÍπåÏßÄ ÏÑ†ÌÉùÌï† Ïàò ÏûàÏäµÎãàÎã§.');
                    // Ï≤¥ÌÅ¨Î∞ïÏä§ ÏÉÅÌÉúÎ•º ÏõêÎûòÎåÄÎ°ú ÎêòÎèåÎ¶¨Í∏∞ ÏúÑÌï¥ Îã§Ïãú Î†åÎçîÎßÅ
                    render();
                    return;
                }
            }
            render();
            // Î†åÎçîÎßÅ ÌõÑ Í∞Å Í∏∞Îä• Ï¥àÍ∏∞Ìôî
            setTimeout(() => {
                if (state.appData.senseExpressionType.includes('space')) {
                    initSpaceMap();
                }
                if (state.appData.senseExpressionType.includes('pattern')) {
                    initPatternCanvas();
                }
            }, 100);
        }

        // =========================
        // ÏûêÏó∞ ÌòÑÏÉÅ Ïù¥ÎØ∏ÏßÄ ÏÑ†ÌÉù Í∏∞Îä•
        // =========================
        function toggleNatureImage(imageId) {
            const idx = state.appData.senseExpressionNature.indexOf(imageId);
            if (idx > -1) {
                // Ïù¥ÎØ∏ ÏÑ†ÌÉùÎêú Ïù¥ÎØ∏ÏßÄÎ©¥ Ï†úÍ±∞
                state.appData.senseExpressionNature.splice(idx, 1);
            } else {
                // ÏµúÎåÄ 3Í∞úÍπåÏßÄ ÏÑ†ÌÉù Í∞ÄÎä•
                if (state.appData.senseExpressionNature.length < 3) {
                    state.appData.senseExpressionNature.push(imageId);
                } else {
                    alert('ÏûêÏó∞ ÌòÑÏÉÅÏùÄ ÏµúÎåÄ 3Í∞úÍπåÏßÄ ÏÑ†ÌÉùÌï† Ïàò ÏûàÏäµÎãàÎã§.');
                    return;
                }
            }
            render();
        }

        // =========================
        // Ïπ¥Î©îÎùº ÏõÄÏßÅÏûÑ Í∏∞Î°ù Í∏∞Îä•
        // =========================
        let movementStream = null;

        async function startMovementCapture() {
            try {
                const video = document.getElementById('movement-video');
                const controls = document.getElementById('movement-controls');
                const captureControls = document.getElementById('movement-capture-controls');
                
                if (!video) return;
                
                movementStream = await navigator.mediaDevices.getUserMedia({ 
                    video: { facingMode: 'user' } 
                });
                video.srcObject = movementStream;
                video.classList.remove('hidden');
                controls.classList.add('hidden');
                captureControls.classList.remove('hidden');
            } catch (error) {
                alert('Ïπ¥Î©îÎùº Ï†ëÍ∑º Í∂åÌïúÏù¥ ÌïÑÏöîÌï©ÎãàÎã§. Î∏åÎùºÏö∞Ï†Ä ÏÑ§Ï†ïÏóêÏÑú Ïπ¥Î©îÎùº Í∂åÌïúÏùÑ ÌóàÏö©Ìï¥Ï£ºÏÑ∏Ïöî.');
                console.error('Ïπ¥Î©îÎùº Ï†ëÍ∑º Ïò§Î•ò:', error);
            }
        }

        function captureMovement() {
            const video = document.getElementById('movement-video');
            const canvas = document.getElementById('movement-canvas');
            const preview = document.getElementById('movement-preview');
            const previewImg = document.getElementById('movement-preview-img');
            
            if (!video || !canvas) return;
            
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            const ctx = canvas.getContext('2d');
            ctx.drawImage(video, 0, 0);
            
            const imageData = canvas.toDataURL('image/png');
            state.appData.senseExpressionMovement = imageData;
            
            previewImg.src = imageData;
            preview.classList.remove('hidden');
            video.classList.add('hidden');
            
            render();
        }

        function stopMovementCapture() {
            if (movementStream) {
                movementStream.getTracks().forEach(track => track.stop());
                movementStream = null;
            }
            const video = document.getElementById('movement-video');
            const controls = document.getElementById('movement-controls');
            const captureControls = document.getElementById('movement-capture-controls');
            
            if (video) video.classList.add('hidden');
            if (controls) controls.classList.remove('hidden');
            if (captureControls) captureControls.classList.add('hidden');
        }

        function clearMovementCapture() {
            state.appData.senseExpressionMovement = null;
            stopMovementCapture();
            render();
        }

        // =========================
        // ÏßÄÎèÑ Í≥µÍ∞Ñ Ï≤¥ÌÅ¨ Í∏∞Îä•
        // =========================
        let spaceMap = null;
        let spaceMarker = null;

        let spaceDetailMap = null;

        function initSpaceMap() {
            const mapContainer = document.getElementById('space-map');
            if (!mapContainer) return;
            
            // Í∏∞Ï°¥ ÎßµÏù¥ ÏûàÏúºÎ©¥ Ï†úÍ±∞
            if (spaceMap) {
                spaceMap.remove();
                spaceMap = null;
                spaceMarker = null;
            }
            
            // Í∏∞Î≥∏ ÏúÑÏπò: ÏÑúÏö∏
            const defaultLat = state.appData.senseExpressionSpace?.lat || 37.5665;
            const defaultLng = state.appData.senseExpressionSpace?.lng || 126.9780;
            
            spaceMap = L.map('space-map').setView([defaultLat, defaultLng], 13);
            
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '¬© OpenStreetMap contributors'
            }).addTo(spaceMap);
            
            // Í∏∞Ï°¥ ÏÑ†ÌÉù ÏúÑÏπòÍ∞Ä ÏûàÏúºÎ©¥ ÎßàÏª§ ÌëúÏãú
            if (state.appData.senseExpressionSpace) {
                spaceMarker = L.marker([defaultLat, defaultLng]).addTo(spaceMap);
                // ÏÉÅÏÑ∏ ÏßÄÎèÑÎèÑ Ï¥àÍ∏∞Ìôî
                initSpaceDetailMap();
            }
            
            // ÏßÄÎèÑ ÌÅ¥Î¶≠ Ïãú ÏúÑÏπò ÏÑ†ÌÉù
            spaceMap.on('click', async (e) => {
                const { lat, lng } = e.latlng;
                
                // Í∏∞Ï°¥ ÎßàÏª§ Ï†úÍ±∞
                if (spaceMarker) {
                    spaceMap.removeLayer(spaceMarker);
                }
                
                // ÏÉà ÎßàÏª§ Ï∂îÍ∞Ä
                spaceMarker = L.marker([lat, lng]).addTo(spaceMap);
                
                // Ï£ºÏÜå Í∞ÄÏ†∏Ïò§Í∏∞ (Í∞ÑÎã®Ìïú Ïó≠ÏßÄÏò§ÏΩîÎî©)
                try {
                    const response = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}`);
                    const data = await response.json();
                    const address = data.display_name || `${lat.toFixed(4)}, ${lng.toFixed(4)}`;
                    
                    state.appData.senseExpressionSpace = { lat, lng, address };
                } catch (error) {
                    state.appData.senseExpressionSpace = { lat, lng, address: `${lat.toFixed(4)}, ${lng.toFixed(4)}` };
                }
                
                render();
                setTimeout(() => {
                    initSpaceMap();
                }, 100);
            });
        }

        function initSpaceDetailMap() {
            const detailMapContainer = document.getElementById('space-detail-map');
            if (!detailMapContainer || !state.appData.senseExpressionSpace) return;
            
            // Í∏∞Ï°¥ ÏÉÅÏÑ∏ ÏßÄÎèÑ Ï†úÍ±∞
            if (spaceDetailMap) {
                spaceDetailMap.remove();
                spaceDetailMap = null;
            }
            
            const { lat, lng } = state.appData.senseExpressionSpace;
            
            // ÌôïÎåÄÎêú ÏÉÅÏÑ∏ ÏßÄÎèÑ (Ï§å Î†àÎ≤® 18Î°ú Îß§Ïö∞ ÌôïÎåÄ)
            spaceDetailMap = L.map('space-detail-map').setView([lat, lng], 18);
            
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '¬© OpenStreetMap contributors'
            }).addTo(spaceDetailMap);
            
            // ÎßàÏª§ Ï∂îÍ∞Ä
            L.marker([lat, lng], {
                icon: L.icon({
                    iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-red.png',
                    shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png',
                    iconSize: [25, 41],
                    iconAnchor: [12, 41],
                    popupAnchor: [1, -34],
                    shadowSize: [41, 41]
                })
            }).addTo(spaceDetailMap);
            
            // ÏõêÌòï Î∞òÍ≤Ω ÌëúÏãú (100m Î∞òÍ≤Ω)
            L.circle([lat, lng], {
                color: '#3388ff',
                fillColor: '#3388ff',
                fillOpacity: 0.2,
                radius: 100
            }).addTo(spaceDetailMap);
        }

        function clearSpaceSelection() {
            state.appData.senseExpressionSpace = null;
            if (spaceMap) {
                spaceMap.remove();
                spaceMap = null;
            }
            if (spaceDetailMap) {
                spaceDetailMap.remove();
                spaceDetailMap = null;
            }
            spaceMarker = null;
            render();
        }

        // =========================
        // ÎèÑÌòï/Ìå®ÌÑ¥ Í∑∏Î¶¨Í∏∞ Í∏∞Îä•
        // =========================
        let patternCanvas = null;
        let patternCtx = null;
        let isDrawing = false;
        let currentShape = null;
        let startX = 0, startY = 0;

        function initPatternCanvas() {
            const canvas = document.getElementById('pattern-canvas');
            if (!canvas) return;
            
            // Í∏∞Ï°¥ Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà Ï†úÍ±∞ ÌõÑ Ïû¨Îì±Î°ù
            if (patternCanvas && patternCanvas !== canvas) {
                patternCanvas.removeEventListener('mousedown', startDrawing);
                patternCanvas.removeEventListener('mousemove', draw);
                patternCanvas.removeEventListener('mouseup', stopDrawing);
                patternCanvas.removeEventListener('mouseout', stopDrawing);
            }
            
            patternCanvas = canvas;
            patternCtx = canvas.getContext('2d');
            
            // Í∏∞Ï°¥ Ïù¥ÎØ∏ÏßÄÍ∞Ä ÏûàÏúºÎ©¥ Î°úÎìú
            if (state.appData.senseExpressionPattern) {
                const img = new Image();
                img.onload = () => {
                    patternCtx.clearRect(0, 0, canvas.width, canvas.height);
                    patternCtx.drawImage(img, 0, 0);
                };
                img.src = state.appData.senseExpressionPattern;
            }
            
            // ÎßàÏö∞Ïä§ Ïù¥Î≤§Ìä∏ (Ï§ëÎ≥µ Î∞©ÏßÄ)
            canvas.removeEventListener('mousedown', startDrawing);
            canvas.removeEventListener('mousemove', draw);
            canvas.removeEventListener('mouseup', stopDrawing);
            canvas.removeEventListener('mouseout', stopDrawing);
            
            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('mouseout', stopDrawing);
        }

        function editPatternDrawing() {
            state.appData.senseExpressionPattern = null;
            render();
            setTimeout(() => {
                initPatternCanvas();
            }, 100);
        }

        let savedImageData = null;

        function startDrawing(e) {
            if (!currentShape) return;
            
            isDrawing = true;
            const rect = patternCanvas.getBoundingClientRect();
            startX = e.clientX - rect.left;
            startY = e.clientY - rect.top;
            
            // ÌòÑÏû¨ Ï∫îÎ≤ÑÏä§ ÏÉÅÌÉú Ï†ÄÏû• (ÎèÑÌòï ÎØ∏Î¶¨Î≥¥Í∏∞Ïö©)
            savedImageData = patternCtx.getImageData(0, 0, patternCanvas.width, patternCanvas.height);
            
            // ÏûêÏú† Í∑∏Î¶¨Í∏∞Îäî ÏãúÏûëÏ†ê ÏÑ§Ï†ï
            if (currentShape === 'free') {
                patternCtx.beginPath();
                patternCtx.moveTo(startX, startY);
            }
        }

        function draw(e) {
            if (!isDrawing || !currentShape) return;
            
            const rect = patternCanvas.getBoundingClientRect();
            const currentX = e.clientX - rect.left;
            const currentY = e.clientY - rect.top;
            
            if (currentShape === 'free') {
                // ÏûêÏú† Í∑∏Î¶¨Í∏∞: Ïã§ÏãúÍ∞ÑÏúºÎ°ú ÏÑ† Í∑∏Î¶¨Í∏∞
                patternCtx.lineWidth = 3;
                patternCtx.lineCap = 'round';
                patternCtx.strokeStyle = document.getElementById('pattern-color')?.value || '#3B82F6';
                patternCtx.lineTo(currentX, currentY);
                patternCtx.stroke();
                patternCtx.beginPath();
                patternCtx.moveTo(currentX, currentY);
            } else {
                // ÎèÑÌòï Í∑∏Î¶¨Í∏∞: ÎØ∏Î¶¨Î≥¥Í∏∞ (Î∞òÌà¨Î™Ö)
                patternCtx.putImageData(savedImageData, 0, 0);
                
                patternCtx.fillStyle = document.getElementById('pattern-color')?.value || '#3B82F6';
                patternCtx.strokeStyle = document.getElementById('pattern-color')?.value || '#3B82F6';
                patternCtx.lineWidth = 2;
                patternCtx.globalAlpha = 0.5;
                
                if (currentShape === 'circle') {
                    const radius = Math.sqrt(Math.pow(currentX - startX, 2) + Math.pow(currentY - startY, 2));
                    patternCtx.beginPath();
                    patternCtx.arc(startX, startY, radius, 0, 2 * Math.PI);
                    patternCtx.fill();
                    patternCtx.stroke();
                } else if (currentShape === 'rect') {
                    patternCtx.fillRect(startX, startY, currentX - startX, currentY - startY);
                    patternCtx.strokeRect(startX, startY, currentX - startX, currentY - startY);
                } else if (currentShape === 'triangle') {
                    patternCtx.beginPath();
                    patternCtx.moveTo(startX, startY);
                    patternCtx.lineTo(currentX, currentY);
                    patternCtx.lineTo(startX * 2 - currentX, currentY);
                    patternCtx.closePath();
                    patternCtx.fill();
                    patternCtx.stroke();
                }
                
                patternCtx.globalAlpha = 1.0;
            }
        }

        function stopDrawing(e) {
            if (!isDrawing || !currentShape) {
                isDrawing = false;
                return;
            }
            
            const rect = patternCanvas.getBoundingClientRect();
            const endX = e.clientX - rect.left;
            const endY = e.clientY - rect.top;
            
            // ÏûêÏú† Í∑∏Î¶¨Í∏∞Îäî Ïù¥ÎØ∏ Í∑∏Î†§Ï°åÏúºÎØÄÎ°ú Ïó¨Í∏∞ÏÑúÎäî ÎèÑÌòïÎßå Ï≤òÎ¶¨
            if (currentShape !== 'free') {
                // Ï†ÄÏû•Îêú Ïù¥ÎØ∏ÏßÄ Î≥µÏõê ÌõÑ ÏµúÏ¢Ö ÎèÑÌòï Í∑∏Î¶¨Í∏∞
                patternCtx.putImageData(savedImageData, 0, 0);
                
                patternCtx.fillStyle = document.getElementById('pattern-color')?.value || '#3B82F6';
                patternCtx.strokeStyle = document.getElementById('pattern-color')?.value || '#3B82F6';
                patternCtx.lineWidth = 2;
                patternCtx.globalAlpha = 1.0;
                
                if (currentShape === 'circle') {
                    const radius = Math.sqrt(Math.pow(endX - startX, 2) + Math.pow(endY - startY, 2));
                    patternCtx.beginPath();
                    patternCtx.arc(startX, startY, radius, 0, 2 * Math.PI);
                    patternCtx.fill();
                    patternCtx.stroke();
                } else if (currentShape === 'rect') {
                    patternCtx.fillRect(startX, startY, endX - startX, endY - startY);
                    patternCtx.strokeRect(startX, startY, endX - startX, endY - startY);
                } else if (currentShape === 'triangle') {
                    patternCtx.beginPath();
                    patternCtx.moveTo(startX, startY);
                    patternCtx.lineTo(endX, endY);
                    patternCtx.lineTo(startX * 2 - endX, endY);
                    patternCtx.closePath();
                    patternCtx.fill();
                    patternCtx.stroke();
                }
            }
            
            savedImageData = null;
            isDrawing = false;
        }

        function drawShape(shape) {
            currentShape = shape;
            isDrawing = false;
        }

        function setDrawingMode(mode) {
            currentShape = mode;
            isDrawing = false;
        }

        function clearPatternCanvas() {
            if (patternCtx) {
                patternCtx.clearRect(0, 0, patternCanvas.width, patternCanvas.height);
            }
        }

        function savePatternDrawing() {
            if (!patternCanvas) return;
            const imageData = patternCanvas.toDataURL('image/png');
            state.appData.senseExpressionPattern = imageData;
            render();
        }

        function clearPatternDrawing() {
            state.appData.senseExpressionPattern = null;
            patternCanvas = null;
            patternCtx = null;
            currentShape = null;
            isDrawing = false;
            render();
        }

        // =========================
        // User ID ÏÉùÏÑ±
        // =========================
        function generateUserId() {
            // Í∞ÑÎã®Ìïú Í≥†Ïú† ID ÏÉùÏÑ± (ÌÉÄÏûÑÏä§ÌÉ¨ÌîÑ + ÎûúÎç§)
            return 'user_' + Date.now() + '_' + Math.random().toString(36).substring(2, 9);
        }

        // =========================
        // App Initialization
        // =========================
        window.addEventListener('DOMContentLoaded', () => {
            // Î°úÏª¨ Ïä§ÌÜ†Î¶¨ÏßÄÏóêÏÑú ÏÇ¨Ïö©Ïûê ID Î∂àÎü¨Ïò§Í∏∞ ÎòêÎäî ÏÉùÏÑ±
            const storedUserId = localStorage.getItem('melodymind_userId');
            if (storedUserId) {
                state.userId = storedUserId;
            } else {
                state.userId = generateUserId();
                localStorage.setItem('melodymind_userId', state.userId);
            }
            
            console.log(`üéµ ÏÇ¨Ïö©Ïûê ID: ${state.userId}`);
            render();
        });
    </script>
</body>
</html>
