<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì†Œë¦¬ ì„±ì°°ì‹¤ (MelodyMind)</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Three.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    
    <!-- WordCloud2.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/wordcloud2.js/1.2.2/wordcloud2.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
        }
        .prose {
            max-width: 65ch;
            line-height: 1.75;
        }
    </style>
</head>
<body class="bg-gray-100">
    <div id="app"></div>

    <script>
        // =========================
        // Global State Management
        // =========================
        const state = {
            page: 1,
            loading: false,
            userId: "Guest",
            db: null,
            appData: {
                url: '', title: '', composer: '', artist: '',
                ensembleType1: '', ensembleType2: '', musicGenre: '', lyrics: '', experienceLevel: 'ì´ˆì‹¬',
                senseKeywords: [], senseText: '', senseColors: [], senseImage: null,
                techSound: '', techRhythm: '', analysisHarmony: '', analysisForm: '',
                interpIntent: '', interpScene: '', evalArt: '', evalApply: '',
                feedback: {
                    senseScore: 50, techScore: 50, analysisScore: 50, consistencyScore: 50, aestheticScore: 50,
                    goodPoints: '', badPoints: '', structuredQuestion: '',
                    draftAppreciation: '', modelAppreciation: ''
                },
                finalAppreciation: '',
                scores: [50, 50, 50, 50, 50],
                colors: ['#3B82F6', '#1E40AF', '#6366F1'],
                strategy: { performance: '', appreciation: '', composition: '' }
            },
            feedbackInput: '',
            showErrorModal: false,
            errorMessage: '',
            visualizationScene: null,
            comparisonPageInitialized: false // ë¹„êµ í˜ì´ì§€ ì´ˆê¸°í™” ì—¬ë¶€
        };

        // =========================
        // Color Palette
        // =========================
        const COLOR_PALETTE = [
            { value: '#3B82F6', name: 'íŒŒë‘', description: 'í‰í™”, ê³ ìš”' },
            { value: '#EF4444', name: 'ë¹¨ê°•', description: 'ê¸´ì¥, ì—­ë™' },
            { value: '#10B981', name: 'ì´ˆë¡', description: 'ì•ˆì •, ìì—°' },
            { value: '#F59E0B', name: 'ë…¸ë‘', description: 'ê¸°ì¨, ë°ìŒ' },
            { value: '#8B5CF6', name: 'ë³´ë¼', description: 'ì‹ ë¹„, ëª½í™˜' },
            { value: '#EC4899', name: 'í•‘í¬', description: 'ë¶€ë“œëŸ¬ì›€, ë”°ëœ»í•¨' },
            { value: '#F97316', name: 'ì£¼í™©', description: 'ì—´ì •, í™œê¸°' },
            { value: '#06B6D4', name: 'ì²­ë¡', description: 'ì‹œì›í•¨, ë§‘ìŒ' },
            { value: '#4B5563', name: 'íšŒìƒ‰', description: 'ì“¸ì“¸í•¨, ì–´ë‘ì›€' },
            { value: '#7C3AED', name: 'ìì£¼', description: 'ìš°ì•„í•¨, ê³ ìƒí•¨' },
            { value: '#0EA5E9', name: 'í•˜ëŠ˜', description: 'ììœ , í¬ë§' },
            { value: '#F43F5E', name: 'ë¡œì¦ˆ', description: 'ë”°ëœ»í•¨, ì• ì •' }
        ];

        // =========================
        // Icon Component (SVG)
        // =========================
        const icons = {
            Music: (size = 20) => `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 18V5l12-2v13"/><circle cx="6" cy="18" r="3"/><circle cx="18" cy="16" r="3"/></svg>`,
            Feather: (size = 20) => `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.24 12.24a6 6 0 0 0-8.49-8.49L5.26 10.74 3 13V19l6 2 3-3"/><path d="M14.49 5.51 16.2 3.8a2 2 0 0 1 2.83 2.83l-1.71 1.71"/><path d="m9 11 8.5-8.5"/><path d="m11 9 8.5-8.5"/><path d="M12 18H7"/><path d="M15 21v-3"/></svg>`,
            Eye: (size = 20) => `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/><circle cx="12" cy="12" r="3"/></svg>`,
            Gauge: (size = 20) => `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m12 14 4-4"/><path d="M3.34 19A8 8 0 1 1 12 20"/><path d="M18.83 14.66L17.2 13"/><path d="M13 13h6"/></svg>`,
            Lightbulb: (size = 20) => `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 14c.2-1.1.7-2.2 1.4-3.1 2-2.5 2.5-4.7 1.5-6.7-1-2-2.8-3.2-5.4-3.2h-.6C9.6 1 8 2.2 7 4.2c-1 2-.5 4.2 1.5 6.7.7.9 1.2 2 1.4 3.1"/><path d="M9 18h6"/><path d="M10 22h4"/></svg>`,
            BarChart: (size = 20) => `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" x2="12" y1="20" y2="10"/><line x1="18" x2="18" y1="20" y2="4"/><line x1="6" x2="6" y1="20" y2="16"/></svg>`,
            MessageCircle: (size = 20) => `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m3 21 1.9-5.7a8.5 8.5 0 1 1 3.8 3.8z"/><circle cx="12" cy="12" r="4"/></svg>`,
            X: (size = 20) => `<svg xmlns="http://www.w3.org/2000/svg" width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>`
        };

        // =========================
        // Backend API Functions (.env ì‚¬ìš©)
        // =========================
        // ê°œë°œ í™˜ê²½: Express ì„œë²„ ì§ì ‘ ì—°ê²°, í”„ë¡œë•ì…˜: í˜„ì¬ ì„œë²„ ì£¼ì†Œ ì‚¬ìš©
        const API_BASE_URL = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'
            ? 'http://localhost:3000'
            : window.location.origin;

        async function analyzeWithGPT(systemInstruction, userPrompt, jsonOutput = false) {
            try {
                // ìœ íŠœë¸Œ ë§í¬ ì¶”ì¶œ
                const youtubeUrl = state.appData.url || null;
                
                const response = await fetch(`${API_BASE_URL}/api/analyze`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        systemInstruction,
                        userPrompt,
                        jsonOutput,
                        youtubeUrl
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    const errorMessage = errorData.details || errorData.error || `HTTP error! status: ${response.status}`;
                    throw new Error(errorMessage);
                }

                const data = await response.json();
                return data.result || "AI ë¶„ì„ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.";
            } catch (error) {
                console.error("API Error:", error);
                const errorMessage = error.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜';
                throw new Error(`AI ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${errorMessage}`);
            }
        }

        // Google Forms ë°ì´í„° ì „ì†¡ í•¨ìˆ˜
        async function sendToGoogleForms(formData) {
            try {
                const response = await fetch(`${API_BASE_URL}/api/google-forms`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(formData)
                });

                const result = await response.json();
                return result;
            } catch (error) {
                console.error("Google Forms Error:", error);
                return { success: false, error: error.message };
            }
        }

        // Page 5ì—ì„œ ì™„ë£Œ ë²„íŠ¼ í´ë¦­ ì‹œ Google Formsë¡œ ë°ì´í„° ì „ì†¡
        async function submitToGoogleForms() {
            state.loading = true;
            render();

            try {
                const googleFormsData = {
                    userId: state.userId,
                    timestamp: new Date().toISOString(),
                    // ì•…ê³¡ ì •ë³´
                    title: state.appData.title,
                    url: state.appData.url,
                    artist: state.appData.artist,
                    composer: state.appData.composer,
                    musicGenre: state.appData.musicGenre,
                    ensembleType1: state.appData.ensembleType1,
                    // ê°ìƒ ë°ì´í„°
                    senseKeywords: state.appData.senseKeywords.join(', '),
                    senseText: state.appData.senseText,
                    senseColors: state.appData.senseColors.length > 0 
                        ? state.appData.senseColors.map(c => {
                            const color = COLOR_PALETTE.find(p => p.value === c);
                            return color ? `${color.name}(${color.description})` : c;
                        }).join(', ')
                        : '',
                    techSound: state.appData.techSound,
                    techRhythm: state.appData.techRhythm,
                    analysisHarmony: state.appData.analysisHarmony,
                    analysisForm: state.appData.analysisForm,
                    interpIntent: state.appData.interpIntent,
                    interpScene: state.appData.interpScene,
                    evalArt: state.appData.evalArt,
                    evalApply: state.appData.evalApply,
                    // AI ë¶„ì„ ê²°ê³¼
                    senseScore: state.appData.scores[0],
                    techScore: state.appData.scores[1],
                    analysisScore: state.appData.scores[2],
                    consistencyScore: state.appData.scores[3],
                    aestheticScore: state.appData.scores[4],
                    goodPoints: state.appData.feedback.goodPoints,
                    badPoints: state.appData.feedback.badPoints,
                    structuredQuestion: state.appData.feedback.structuredQuestion,
                    draftAppreciation: state.appData.feedback.draftAppreciation,
                    modelAppreciation: state.appData.feedback.modelAppreciation,
                    feedbackInput: state.feedbackInput,
                    // ìµœì¢… ê²°ê³¼
                    finalAppreciation: state.appData.finalAppreciation,
                    performanceStrategy: state.appData.strategy.performance,
                    appreciationStrategy: state.appData.strategy.appreciation,
                    compositionStrategy: state.appData.strategy.composition
                };

                const result = await sendToGoogleForms(googleFormsData);
                
                if (result.success) {
                    showModal("ê°ìƒë¬¸ì´ ì„±ê³µì ìœ¼ë¡œ ì œì¶œë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ‰\n\nGoogle Formsì— ì‘ë‹µì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.");
                } else {
                    showModal(`Google Forms ì „ì†¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.\n\n${result.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}`);
                }
            } catch (error) {
                console.error("Google Forms ì „ì†¡ ì˜¤ë¥˜:", error);
                showModal("Google Forms ì „ì†¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
            } finally {
                state.loading = false;
                render();
            }
        }

        function getAppreciationDataForAI() {
            const d = state.appData;
            return `
--- ì•…ê³¡ ì •ë³´ ---
ì œëª©: ${d.title || 'ë¯¸ì…ë ¥'}, ì‘ê³¡ê°€: ${d.composer || 'ë¯¸ì…ë ¥'}, ì—°ì£¼ì: ${d.artist || 'ë¯¸ì…ë ¥'}, ì¥ë¥´: ${d.musicGenre || 'ë¯¸ì…ë ¥'}
ìœ íŠœë¸Œ ë§í¬: ${d.url || 'ë¯¸ì…ë ¥'}
ê²½í—˜ ìˆ˜ì¤€: ${d.experienceLevel}, ì—°ì£¼ í˜•íƒœ: ${d.ensembleType1} - ${d.ensembleType2}

--- 1ë‹¨ê³„: ë°˜ì‘ (ê°ê°ì  ê°ìƒ) ---
í•µì‹¬ í‚¤ì›Œë“œ: ${d.senseKeywords.join(', ') || 'ì—†ìŒ'}
ììœ  ì„œìˆ : ${d.senseText || 'ì—†ìŒ'}
ì„ íƒ ìƒ‰ìƒ: ${d.senseColors.length > 0 ? d.senseColors.map(c => {
    const color = COLOR_PALETTE.find(p => p.value === c);
    return color ? `${color.name}(${color.description})` : c;
}).join(', ') : 'ì—†ìŒ'}

--- 2ë‹¨ê³„: ê¸°ìˆ  ë° ë¶„ì„ ---
2-1. ì†Œë¦¬ ë° ìŒìƒ‰ (Timbre/Dynamics): ${d.techSound || 'ë¯¸ì…ë ¥'}
2-2. ì†ë„ ë° ë¦¬ë“¬ (Tempo/Rhythm): ${d.techRhythm || 'ë¯¸ì…ë ¥'}
3-1. í™”ì„± ë° ë¶„ìœ„ê¸° (Harmony/Tonality): ${d.analysisHarmony || 'ë¯¸ì…ë ¥'}
3-2. í˜•ì‹ ë° ì „ê°œ (Form/Structure): ${d.analysisForm || 'ë¯¸ì…ë ¥'}

--- 3ë‹¨ê³„: í•´ì„ ë° í‰ê°€ ---
4-1. ì‘ê³¡ ì˜ë„ ë° ë©”ì‹œì§€ (Intent/Message): ${d.interpIntent || 'ë¯¸ì…ë ¥'}
4-2. ê°œì¸ì  ê³µê° ë° ì¥ë©´ (Scene/Emotion): ${d.interpScene || 'ë¯¸ì…ë ¥'}
5-1. ì˜ˆìˆ ì  ê°€ì¹˜ í‰ê°€ (Aesthetic Value): ${d.evalArt || 'ë¯¸ì…ë ¥'}
5-2. ìœµí•© ë° í™•ì¥ ì ìš© (Application/Fusion): ${d.evalApply || 'ë¯¸ì…ë ¥'}
            `;
        }

        async function generateFeedback() {
            state.loading = true;
            render();

            const appreciationData = getAppreciationDataForAI();
            const systemInstruction = `
ë‹¹ì‹ ì€ ìŒì•… êµìœ¡ ì „ë¬¸ê°€ì´ì ë¹„í‰ê°€ì…ë‹ˆë‹¤. í íŠ¸ë§Œ/ì•¤ë”ìŠ¨ì˜ 5ë‹¨ê³„ ë¹„í‰ êµ¬ì¡°(ë°˜ì‘-ê¸°ìˆ -ë¶„ì„-í•´ì„-í‰ê°€)ì— ë”°ë¼ í•™ìƒì˜ ê°ìƒë¬¸ ë°ì´í„°ë¥¼ ë¶„ì„í•˜ê³ , ë…¼ë¦¬ì /ìŒì•…ì  ê·¼ê±° ì œì‹œ ì—¬ë¶€ë¥¼ ì§„ë‹¨í•©ë‹ˆë‹¤.

**ì¤‘ìš”: ë°˜ë“œì‹œ ìœ íš¨í•œ JSON í˜•ì‹ìœ¼ë¡œë§Œ ì‘ë‹µí•´ì•¼ í•©ë‹ˆë‹¤. ë‹¤ë¥¸ í…ìŠ¤íŠ¸ë‚˜ ì„¤ëª… ì—†ì´ ìˆœìˆ˜ JSONë§Œ ë°˜í™˜í•˜ì„¸ìš”.**

**í•µì‹¬ ì„ë¬´: í•™ìƒì˜ í†µí•© ê°ìƒë¬¸ ì´ˆì•ˆ ìƒì„±**
í•™ìƒì´ 1~3ë‹¨ê³„ì—ì„œ ì…ë ¥í•œ ëª¨ë“  í•­ëª©(ë°˜ì‘, ê¸°ìˆ , ë¶„ì„, í•´ì„, í‰ê°€)ì„ **'í•™ìƒì˜ í†µí•© ê°ìƒë¬¸ ì´ˆì•ˆ'**ì´ë¼ëŠ” ì´ë¦„ìœ¼ë¡œ **5ë‹¨ê³„ ë¹„í‰ êµ¬ì¡°ì— ë§ì¶° ìì—°ìŠ¤ëŸ¬ìš´ ê¸€ í˜•íƒœ**ë¡œ í†µí•©í•˜ì—¬ ìƒì„±í•´ì•¼ í•©ë‹ˆë‹¤. ì´ ì´ˆì•ˆì€ Page 4ì— ì œì‹œë˜ì–´ í•™ìƒì´ ë³´ì™„í•  ìˆ˜ ìˆë„ë¡ í•©ë‹ˆë‹¤.

í•„ìˆ˜ JSON êµ¬ì¡°:
{
  "senseScore": ìˆ«ì(1-100),
  "techScore": ìˆ«ì(1-100),
  "analysisScore": ìˆ«ì(1-100),
  "consistencyScore": ìˆ«ì(1-100),
  "aestheticScore": ìˆ«ì(1-100),
  "goodPoints": "ë¬¸ìì—´ (2-3ê°€ì§€ ì¹­ì°¬)",
  "badPoints": "ë¬¸ìì—´ (2-3ê°€ì§€ ë³´ì™„ì )",
  "structuredQuestion": "ë¬¸ìì—´ (êµ¬ì¡°í™”ëœ ì§ˆë¬¸ 1ê°œ)",
  "draftAppreciation": "ë¬¸ìì—´ (í•™ìƒì˜ 1~3ë‹¨ê³„ ì…ë ¥ì„ ì¢…í•©í•œ í†µí•© ê°ìƒë¬¸ ì´ˆì•ˆ - ìì—°ìŠ¤ëŸ¬ìš´ ê¸€ í˜•íƒœ)",
  "modelAppreciation": "ë¬¸ìì—´ (ì´ ì•…ê³¡ì— ëŒ€í•œ ëª¨ë²” ê°ìƒë¬¸ ì˜ˆì‹œ)"
}

--- [0ë‹¨ê³„: ì•…ê³¡ ì •ë³´ ì •í™•ì„± ê²€ì¦ ë° í™•ì • (ìµœìš°ì„ )] ---
**ê°€ì¥ ë¨¼ì € ìˆ˜í–‰í•´ì•¼ í•  ì‘ì—…**: YouTube Data APIë¡œ ê°€ì ¸ì˜¨ ë™ì˜ìƒ ì •ë³´ë¥¼ **ì°¸ê³  ìë£Œ**ë¡œë§Œ ì‚¬ìš©í•˜ê³ , **ë°˜ë“œì‹œ ìì‹ ì˜ í•™ìŠµëœ ì§€ì‹ê³¼ ê²€ìƒ‰ ëŠ¥ë ¥ì„ í™œìš©í•˜ì—¬ ì •í™•í•œ ì•…ê³¡ ì •ë³´ë¥¼ í™•ì •**í•˜ì„¸ìš”.

**âš ï¸ ì¤‘ìš” ì›ì¹™: YouTube ì •ë³´ë¥¼ ê·¸ëŒ€ë¡œ ë¯¿ì§€ ë§ˆì„¸ìš”**
- YouTube ë™ì˜ìƒ ì œëª©, ì„¤ëª…, íƒœê·¸ëŠ” **ì‚¬ìš©ìê°€ ì„ì˜ë¡œ ì‘ì„±í•œ ì •ë³´**ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- YouTube ì •ë³´ëŠ” **ì°¸ê³  ìë£Œ**ì¼ ë¿ì´ë©°, **ì ˆëŒ€ì ì¸ ê¸°ì¤€ì´ ì•„ë‹™ë‹ˆë‹¤**.
- YouTube ì •ë³´ì™€ í•™ìŠµëœ ì§€ì‹ì´ ì¶©ëŒí•˜ëŠ” ê²½ìš°, **í•™ìŠµëœ ì§€ì‹ê³¼ ê²€ìƒ‰ ê²°ê³¼ë¥¼ ìš°ì„ **í•˜ì„¸ìš”.

**1ë‹¨ê³„: YouTube ì •ë³´ ë¶„ì„ (ì°¸ê³ ìš©)**
- ì‹œìŠ¤í…œì´ ì œê³µí•œ YouTube ë™ì˜ìƒ ì •ë³´ë¥¼ ì°¸ê³  ìë£Œë¡œ ë¶„ì„í•˜ì„¸ìš”:
  * ë™ì˜ìƒ ì œëª©ì—ì„œ ì‘ê³¡ê°€, ì•…ê³¡ ì œëª©, ì—°ì£¼ì ì •ë³´ë¥¼ ì¶”ì¶œí•˜ì„¸ìš” (í•˜ì§€ë§Œ ì´ê²ƒì´ ì •í™•í•˜ë‹¤ê³  ê°€ì •í•˜ì§€ ë§ˆì„¸ìš”)
  * ë™ì˜ìƒ ì„¤ëª…ì—ì„œ ì•…ê³¡ì˜ ë°°ê²½, í˜•ì‹, íŠ¹ì§• ë“±ì„ í™•ì¸í•˜ì„¸ìš” (í•˜ì§€ë§Œ ì´ê²ƒì´ ì •í™•í•˜ë‹¤ê³  ê°€ì •í•˜ì§€ ë§ˆì„¸ìš”)
  * íƒœê·¸ì—ì„œ ê´€ë ¨ í‚¤ì›Œë“œë¥¼ í™•ì¸í•˜ì„¸ìš”

**2ë‹¨ê³„: ì •í™•í•œ ì•…ê³¡ ì •ë³´ ê²€ìƒ‰ ë° í™•ì • (í•„ìˆ˜)**
- YouTube ì •ë³´ì—ì„œ ì¶”ì¶œí•œ ì‘ê³¡ê°€ì™€ ì•…ê³¡ ì œëª©ì„ **ë‹¨ì„œ**ë¡œ ì‚¬ìš©í•˜ì—¬, **ìì‹ ì˜ í•™ìŠµëœ ì§€ì‹ê³¼ ê²€ìƒ‰ ëŠ¥ë ¥ì„ í™œìš©**í•˜ì—¬ ë‹¤ìŒ ì •ë³´ë¥¼ **ì •í™•í•˜ê²Œ** í™•ì •í•˜ì„¸ìš”:
  * **ì‘ê³¡ê°€ì˜ ì •í™•í•œ ì´ë¦„ê³¼ ìƒëª°ë…„ë„**
  * **ì•…ê³¡ì˜ ì •í™•í•œ ì œëª© (ì›ì–´ í¬í•¨)**
  * **ì‘ê³¡ ì‹œê¸° ë° ì‹œëŒ€ì  ë°°ê²½**
  * **ì£¼ìš” í˜•ì‹(ì†Œë‚˜íƒ€, ë¡ ë„, ë³€ì£¼ê³¡ ë“±)**
  * **ì¡°ì„±(ì¥ì¡°/ë‹¨ì¡°, ì¡°í‘œ)**
  * **í…œí¬ í‘œì‹œ(Allegro, Adagio, Presto ë“±) ë° ì‹¤ì œ ë¹ ë¥´ê¸°**
  * **ì…ˆì—¬ë¦¼(dynamics: forte, piano, crescendo ë“±)ì˜ íŠ¹ì§•**
  * **íŠ¹ì§•ì ì¸ ì•…ê¸° êµ¬ì„± ë° í¸ì„±**
  * **ë¦¬ë“¬ íŒ¨í„´ ë° íŠ¹ì§•**
  * **í™”ì„± ì§„í–‰ì˜ íŠ¹ì§•**
  * **ì‘ê³¡ê°€ì˜ ìŠ¤íƒ€ì¼ ë° ì‹œëŒ€ì  íŠ¹ì§•**

**3ë‹¨ê³„: ì •ë³´ ê²€ì¦ ë° ë¶ˆì¼ì¹˜ ì²˜ë¦¬**
- í™•ì •í•œ ì •í™•í•œ ì•…ê³¡ ì •ë³´ì™€ YouTube ì •ë³´ë¥¼ ë¹„êµí•˜ì„¸ìš”.
- YouTube ì •ë³´ê°€ ì˜ëª»ë˜ì—ˆê±°ë‚˜ ë¶ˆì¼ì¹˜í•˜ëŠ” ê²½ìš°, **í™•ì •í•œ ì •í™•í•œ ì •ë³´ë¥¼ ê¸°ì¤€**ìœ¼ë¡œ ì‚¬ìš©í•˜ì„¸ìš”.
- í™•ì •í•œ ì •í™•í•œ ì•…ê³¡ ì •ë³´ì™€ í•™ìƒì´ ì…ë ¥í•œ ì œëª©/ì‘ê³¡ê°€/ì—°ì£¼ìë¥¼ ë¹„êµí•˜ì„¸ìš”.

**3ë‹¨ê³„: í•™ìƒ ì…ë ¥ê³¼ ë¹„êµ**
- ìœ„ì—ì„œ ë¶„ì„í•œ ì•…ê³¡ ì •ë³´ì™€ í•™ìƒì´ ì…ë ¥í•œ ì œëª©, ì‘ê³¡ê°€, ì—°ì£¼ì, ì¥ë¥´ë¥¼ ë¹„êµí•˜ì„¸ìš”.
- **ë¶ˆì¼ì¹˜ê°€ ë°œê²¬ë˜ë©´**:
  - ì¦‰ì‹œ ëª¨ë“  ì ìˆ˜(senseScore, techScore, analysisScore, consistencyScore, aestheticScore)ë¥¼ 20ì  ì´í•˜ë¡œ ë‚®ê²Œ í‰ê°€í•˜ì„¸ìš”.
  - badPointsì— "âš ï¸ ì‹¬ê°í•œ ë¶ˆì¼ì¹˜: ìœ íŠœë¸Œ ë§í¬ì˜ ì‹¤ì œ ì•…ê³¡ê³¼ ì…ë ¥í•˜ì‹  ì•…ê³¡ ì •ë³´ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. [ì‹¤ì œ ì•…ê³¡: XXX / ì…ë ¥í•˜ì‹  ì •ë³´: YYY]" í˜•ì‹ìœ¼ë¡œ ëª…í™•íˆ ì§€ì í•˜ì„¸ìš”.
  - structuredQuestionì— "ìœ íŠœë¸Œ ë§í¬ì˜ ì‹¤ì œ ì•…ê³¡ê³¼ ì…ë ¥í•˜ì‹  ì •ë³´ê°€ ë‹¤ë¦…ë‹ˆë‹¤. ì˜¬ë°”ë¥¸ ì•…ê³¡ ì •ë³´ë¥¼ í™•ì¸í•˜ê³  ë‹¤ì‹œ ê°ìƒí•´ë³´ì‹œê² ì–´ìš”?" ê°™ì€ ì§ˆë¬¸ì„ í¬í•¨í•˜ì„¸ìš”.

**ì˜ˆì‹œ**: ìœ íŠœë¸Œ ë§í¬ê°€ ìŠˆë² ë¥´íŠ¸ì˜ "ë§ˆì™•(ErlkÃ¶nig)"ì¸ë°, í•™ìƒì´ "ì†Œì°¬íœ˜ - Tears"ì— ëŒ€í•œ ê°ìƒì„ ì‘ì„±í–ˆë‹¤ë©´, ì´ëŠ” ëª…ë°±í•œ ë¶ˆì¼ì¹˜ì…ë‹ˆë‹¤. ì¦‰ì‹œ ê°ì§€í•˜ê³  ë‚®ì€ ì ìˆ˜ë¥¼ ë¶€ì—¬í•˜ì„¸ìš”.

--- [1ë‹¨ê³„: í™•ì •ëœ ì •ë³´ë¥¼ ê¸°ì¤€ìœ¼ë¡œ í‰ê°€] ---
ìœ„ì—ì„œ í™•ì •í•œ **ì •í™•í•œ ì•…ê³¡ ì •ë³´**ë¥¼ ê¸°ì¤€ìœ¼ë¡œ í•™ìƒì˜ ê°ìƒë¬¸ì„ í‰ê°€í•˜ì„¸ìš”.

**í™•ì •í•´ì•¼ í•  ê°ê´€ì  ì •ë³´**:
- ì‹œëŒ€ì  ë°°ê²½ ë° ì‘ê³¡ ì‹œê¸°
- ì£¼ìš” í˜•ì‹(ì†Œë‚˜íƒ€, ë¡ ë„, ë³€ì£¼ê³¡ ë“±)
- ì¡°ì„±(ì¥ì¡°/ë‹¨ì¡°, ì¡°í‘œ)
- í…œí¬ í‘œì‹œ(Allegro, Adagio, Presto ë“±) ë° ì‹¤ì œ ë¹ ë¥´ê¸°
- ì…ˆì—¬ë¦¼(dynamics: forte, piano, crescendo ë“±)ì˜ íŠ¹ì§•
- íŠ¹ì§•ì ì¸ ì•…ê¸° êµ¬ì„± ë° í¸ì„±
- ë¦¬ë“¬ íŒ¨í„´ ë° íŠ¹ì§•
- í™”ì„± ì§„í–‰ì˜ íŠ¹ì§•
- ì‘ê³¡ê°€ì˜ ìŠ¤íƒ€ì¼ ë° ì‹œëŒ€ì  íŠ¹ì§•

ì´ í™•ì •ëœ ê°ê´€ì  ì •ë³´ë¥¼ 'ì°¸ê³  ê¸°ì¤€(Reference Standard)'ìœ¼ë¡œ ì„¤ì •í•˜ê³ , í•™ìƒì˜ ê°ìƒë¬¸ì´ ì´ ê¸°ì¤€ê³¼ ì–¼ë§ˆë‚˜ ì¼ì¹˜í•˜ëŠ”ì§€ë¥¼ í‰ê°€í•´ì•¼ í•©ë‹ˆë‹¤.

--- [2ë‹¨ê³„: ë¶„ì„ ê¸°ì¤€ ë° í‰ê°€] ---
**ì•…ê³¡ ì •ë³´ ë¶ˆì¼ì¹˜ê°€ ì—†ëŠ” ê²½ìš°ì—ë§Œ** ê²€ìƒ‰ëœ ê°ê´€ì  ì•…ê³¡ ì •ë³´ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë‹¤ìŒ í•­ëª©ì„ í‰ê°€í•©ë‹ˆë‹¤:

1. ê°ê°ì  ë¯¼ê°ë„(senseScore): 
   - í•™ìƒì˜ ê°ê°ì  ì„œìˆ (P1)ì´ ê²€ìƒ‰ëœ ì•…ê³¡ì˜ ì‹¤ì œ ì…ˆì—¬ë¦¼/ë¹ ë¥´ê¸°/ì¡°ì„±ê³¼ ì–¼ë§ˆë‚˜ ì¼ì¹˜í•˜ëŠ”ê°€?
   - ì˜ˆ: í•™ìƒì´ "ëŠë¦¬ë‹¤"ê³  í–ˆìœ¼ë‚˜ ì‹¤ì œ ê³¡ì´ Presto(ë§¤ìš° ë¹ ë¦„)ë¼ë©´ ì ìˆ˜ë¥¼ ë‚®ê²Œ í‰ê°€
   - **ì•…ê³¡ ì •ë³´ ë¶ˆì¼ì¹˜ ì‹œ: 10-20ì **
   - (1-100ì )

2. ê¸°ìˆ ì  ì •í™•ë„(techScore):
   - í•™ìƒì˜ ê¸°ìˆ (P2) ë‹µë³€ì´ ê²€ìƒ‰ëœ ì•…ê³¡ì˜ ê°ê´€ì  ìŒì•… ìš”ì†Œ(ì•…ê¸° êµ¬ì„±, ìŒìƒ‰, ì…ˆì—¬ë¦¼ ë“±)ë¥¼ ì–¼ë§ˆë‚˜ ì •í™•í•˜ê²Œ ê¸°ìˆ í–ˆëŠ”ê°€?
   - **ì•…ê³¡ ì •ë³´ ë¶ˆì¼ì¹˜ ì‹œ: 10-20ì **
   - (1-100ì )

3. ë¶„ì„ì  ì´í•´ë„(analysisScore): 
   - í•™ìƒì˜ ë¶„ì„(P2) ë‹µë³€ì´ ê²€ìƒ‰ëœ ì•…ê³¡ì˜ ê°ê´€ì  ìš”ì†Œ(í˜•ì‹, ì¡°ì„±, ë¦¬ë“¬ íŒ¨í„´, í™”ì„± ì§„í–‰ ë“±)ì™€ ì–¼ë§ˆë‚˜ ì •í™•í•˜ê²Œ ì¼ì¹˜í•˜ëŠ”ê°€?
   - ê²€ìƒ‰ëœ ì •ë³´ì™€ ë¹„êµí•˜ì—¬ ì •í™•ë„ í‰ê°€
   - **ì•…ê³¡ ì •ë³´ ë¶ˆì¼ì¹˜ ì‹œ: 10-20ì ** (ë‹¤ë¥¸ ê³¡ì— ëŒ€í•œ ë¶„ì„ì´ë¯€ë¡œ ì •í™•ë„ê°€ ë§¤ìš° ë‚®ìŒ)
   - (1-100ì )

4. ë…¼ë¦¬ì  ì¼ê´€ì„±(consistencyScore):
   - í•™ìƒì˜ ê°ìƒë¬¸ ì „ì²´ê°€ ë…¼ë¦¬ì ìœ¼ë¡œ ì¼ê´€ì„±ì´ ìˆëŠ”ê°€? (P1â†’P2â†’P3ì˜ ì—°ê²°ì„±)
   - í•´ì„/í‰ê°€(P3)ê°€ ê¸°ìˆ /ë¶„ì„(P2)ì˜ ì‚¬ì‹¤ì— ê·¼ê±°í•˜ëŠ”ê°€?
   - **ì•…ê³¡ ì •ë³´ ë¶ˆì¼ì¹˜ ì‹œ: 10-20ì **
   - (1-100ì )

5. ì‹¬ë¯¸ì  í†µì°°ë ¥(aestheticScore): 
   - í•™ìƒì˜ í•´ì„/í‰ê°€(P3) ë‚´ìš©ì´ ê²€ìƒ‰ëœ ì‹œëŒ€ì  ë°°ê²½, ì‘ê³¡ê°€ ìŠ¤íƒ€ì¼ê³¼ ì–¼ë§ˆë‚˜ ì¼ì¹˜í•˜ëŠ”ê°€?
   - ì˜ˆìˆ ì  ê°€ì¹˜ íŒë‹¨ì˜ ê¹Šì´ê°€ ìˆëŠ”ê°€?
   - **ì•…ê³¡ ì •ë³´ ë¶ˆì¼ì¹˜ ì‹œ: 10-20ì **
   - (1-100ì )

4. goodPoints: 
   - **ì•…ê³¡ ì •ë³´ê°€ ì¼ì¹˜í•˜ëŠ” ê²½ìš°ì—ë§Œ** ê²€ìƒ‰ëœ ê°ê´€ì  ì •ë³´ì™€ ì¼ì¹˜í•˜ëŠ” í•™ìƒì˜ ì •í™•í•œ ê´€ì°°ì´ë‚˜ ë¶„ì„ì„ êµ¬ì²´ì ìœ¼ë¡œ ì¹­ì°¬
   - **ì•…ê³¡ ì •ë³´ ë¶ˆì¼ì¹˜ ì‹œ**: "ì•…ê³¡ ì •ë³´ê°€ ì¼ì¹˜í•˜ì§€ ì•Šì•„ ì •í™•í•œ í‰ê°€ê°€ ì–´ë µìŠµë‹ˆë‹¤." ì •ë„ë¡œ ê°„ë‹¨íˆ ì‘ì„±
   - 2~3ê°€ì§€

5. badPoints: 
   - **ìµœìš°ì„ **: ì•…ê³¡ ì •ë³´ ë¶ˆì¼ì¹˜ê°€ ìˆìœ¼ë©´ ë°˜ë“œì‹œ ì²« ë²ˆì§¸ í•­ëª©ìœ¼ë¡œ ì§€ì í•˜ì„¸ìš”.
   - í˜•ì‹: "âš ï¸ ì‹¬ê°í•œ ë¶ˆì¼ì¹˜ ê°ì§€: ìœ íŠœë¸Œ ë§í¬ì˜ ì‹¤ì œ ì•…ê³¡ì€ [ì‹¤ì œ ì•…ê³¡ ì •ë³´]ì¸ë°, ì…ë ¥í•˜ì‹  ì •ë³´ëŠ” [í•™ìƒ ì…ë ¥ ì •ë³´]ì…ë‹ˆë‹¤. ë‹¤ë¥¸ ê³¡ì— ëŒ€í•œ ê°ìƒì„ ì‘ì„±í•˜ì‹  ê²ƒ ê°™ìŠµë‹ˆë‹¤."
   - ê·¸ ë‹¤ìŒ ê²€ìƒ‰ëœ ê°ê´€ì  ì •ë³´ì™€ ë¶ˆì¼ì¹˜í•˜ëŠ” ë¶€ë¶„ì„ êµ¬ì²´ì ìœ¼ë¡œ ì§€ì 
   - ì˜ˆ: "ë‹¹ì‹ ì€ ê³¡ì˜ í…œí¬ê°€ ëŠë¦¬ë‹¤ê³  í–ˆìœ¼ë‚˜, ì‹¤ì œ ì´ ê³¡ì€ ë‚­ë§Œì£¼ì˜ ì‹œëŒ€ì˜ 'ë§¤ìš° ë¹ ë¥´ë‹¤(Presto)'ë¡œ ì—°ì£¼ë©ë‹ˆë‹¤."
   - ë…¼ë¦¬ì /ìŒì•…ì  ê·¼ê±° ë¶€ì¡± ë“± ë³´ì™„í•  ì  2~3ê°€ì§€

6. structuredQuestion: 
   - **ì•…ê³¡ ì •ë³´ ë¶ˆì¼ì¹˜ ì‹œ**: "ìœ íŠœë¸Œ ë§í¬ì˜ ì‹¤ì œ ì•…ê³¡([ì‹¤ì œ ì•…ê³¡])ê³¼ ì…ë ¥í•˜ì‹  ì •ë³´([í•™ìƒ ì…ë ¥])ê°€ ë‹¤ë¦…ë‹ˆë‹¤. ì˜¬ë°”ë¥¸ ì•…ê³¡ ì •ë³´ë¥¼ í™•ì¸í•˜ê³  í•´ë‹¹ ê³¡ì— ëŒ€í•´ ë‹¤ì‹œ ê°ìƒí•´ë³´ì‹œê² ì–´ìš”?"
   - **ì¼ì¹˜í•˜ëŠ” ê²½ìš°**: í•™ìƒì´ í‹€ë¦¬ê²Œ ë¶„ì„í•œ ë¶€ë¶„ê³¼ ê´€ë ¨ëœ **ê²€ìƒ‰ëœ ê°ê´€ì  ì •ë³´ì˜ ì¼ë¶€**ë¥¼ íŒíŠ¸ë¡œ í™œìš©í•˜ì—¬ ì§ˆë¬¸ì„ êµ¬ì²´í™”
   - ì˜ˆ: "ë‹¹ì‹ ì€ ê³¡ì˜ í…œí¬ê°€ ëŠë¦¬ë‹¤ê³  í–ˆìœ¼ë‚˜, ì‹¤ì œ ì´ ê³¡ì€ ë‚­ë§Œì£¼ì˜ ì‹œëŒ€ì˜ 'ë§¤ìš° ë¹ ë¥´ë‹¤(Presto)'ë¡œ ì—°ì£¼ë©ë‹ˆë‹¤. ë¦¬ë“¬ íŒ¨í„´ì— ëŒ€í•œ ê¸°ìˆ ì„ ë³´ì™„í•  ìˆ˜ ìˆì„ê¹Œìš”? íŠ¹íˆ ì…‹ì‡ë‹¨ìŒí‘œì˜ ë°˜ë³µ íŒ¨í„´ì´ ì–´ë–»ê²Œ ê¸´ì¥ê°ì„ ì¡°ì„±í•˜ëŠ”ì§€ ë‹¤ì‹œ ë“¤ì–´ë³´ì‹œê² ì–´ìš”?"
   - ë³´ì™„í•  ì ì„ í•´ê²°í•  ìˆ˜ ìˆë„ë¡ ì‚¬ê³ ë¥¼ ì´‰ì§„í•˜ëŠ” êµ¬ì¡°í™”ëœ ì§ˆë¬¸ 1ê°œ

7. draftAppreciation (í•™ìƒì˜ í†µí•© ê°ìƒë¬¸ ì´ˆì•ˆ):
   - **í•µì‹¬ ì„ë¬´**: í•™ìƒì´ 1~3ë‹¨ê³„ì—ì„œ ì…ë ¥í•œ ëª¨ë“  í•­ëª©ì„ **'í•™ìƒì˜ í†µí•© ê°ìƒë¬¸ ì´ˆì•ˆ'**ì´ë¼ëŠ” ì´ë¦„ìœ¼ë¡œ **5ë‹¨ê³„ ë¹„í‰ êµ¬ì¡°ì— ë§ì¶° ìì—°ìŠ¤ëŸ¬ìš´ ê¸€ í˜•íƒœ**ë¡œ í†µí•©í•˜ì—¬ ìƒì„±í•˜ì„¸ìš”.
   - **ì‘ì„± ë°©ë²•**:
     * í•™ìƒì´ ì…ë ¥í•œ ë‚´ìš©(1ë‹¨ê³„: ë°˜ì‘, 2ë‹¨ê³„: ê¸°ìˆ /ë¶„ì„, 3ë‹¨ê³„: í•´ì„/í‰ê°€)ì„ ëª¨ë‘ í¬í•¨í•˜ì„¸ìš”.
     * 5ë‹¨ê³„ ë¹„í‰ êµ¬ì¡°(ë°˜ì‘-ê¸°ìˆ -ë¶„ì„-í•´ì„-í‰ê°€)ì— ë§ì¶° ìì—°ìŠ¤ëŸ½ê²Œ ì—°ê²°í•˜ì„¸ìš”.
     * ê° ë‹¨ê³„ì˜ ë‚´ìš©ì„ ë¬¸ë‹¨ìœ¼ë¡œ êµ¬ì„±í•˜ì—¬ ì½ê¸° ì¢‹ì€ ê°ìƒë¬¸ í˜•íƒœë¡œ ì‘ì„±í•˜ì„¸ìš”.
     * ë¬¸ì¥ì„ ë‹¤ë“¬ê³  ì—°ê²°í•˜ì—¬ ì™„ì„±ë„ ë†’ì€ ì´ˆì•ˆì„ ë§Œë“¤ë˜, í•™ìƒì˜ ì›ë˜ ì˜ë„ì™€ ë‚´ìš©ì€ ê·¸ëŒ€ë¡œ ìœ ì§€í•˜ì„¸ìš”.
   - **ì ˆëŒ€ ê¸ˆì§€**: 
     * í•™ìƒì´ ì…ë ¥í•˜ì§€ ì•Šì€ ë‚´ìš©ì„ ì¶”ê°€í•˜ì§€ ë§ˆì„¸ìš”.
     * í•™ìƒì´ ì…ë ¥í•œ ë‚´ìš©ë§Œ ì‚¬ìš©í•˜ì„¸ìš”.
   - **ìµœì¢… ê²°ê³¼**: ì´ ì´ˆì•ˆì€ Page 4ì— ì œì‹œë˜ì–´ í•™ìƒì´ ë³´ì™„í•  ìˆ˜ ìˆë„ë¡ í•©ë‹ˆë‹¤.

8. modelAppreciation:
   - **YouTube ì •ë³´ì™€ í•™ìŠµëœ ì§€ì‹ì„ í™œìš©**í•˜ì—¬ ì´ ì•…ê³¡ì— ëŒ€í•œ **ëª¨ë²” ê°ìƒë¬¸ ì˜ˆì‹œ**ë¥¼ ì‘ì„±í•˜ì„¸ìš”.
   - YouTube Data APIë¡œ ê°€ì ¸ì˜¨ ë™ì˜ìƒ ì •ë³´ì™€ ìì‹ ì˜ í•™ìŠµëœ ì§€ì‹ì„ ì¢…í•©í•˜ì—¬ ì •í™•í•œ ì•…ê³¡ ì •ë³´(ì œëª©, ì‘ê³¡ê°€, ì‹œëŒ€, í˜•ì‹, ì¡°ì„±, í…œí¬ ë“±)ë¥¼ í™•ì •í•˜ì„¸ìš”.
   - í™•ì •ëœ ì•…ê³¡ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ 5ë‹¨ê³„ ë¹„í‰ êµ¬ì¡°ë¥¼ ì™„ë²½í•˜ê²Œ ë°˜ì˜í•˜ê³ , ê°ê´€ì  ì‚¬ì‹¤ê³¼ ì£¼ê´€ì  í•´ì„ì´ ê· í˜•ìˆê²Œ ì¡°í™”ëœ ê°ìƒë¬¸ì„ ì‘ì„±í•˜ì„¸ìš”.
   - í•™ìƒì´ ì°¸ê³ í•  ìˆ˜ ìˆëŠ” ì¢‹ì€ ì˜ˆì‹œê°€ ë˜ë„ë¡ ì‘ì„±í•˜ì„¸ìš”.
   - **ì¤‘ìš”**: YouTube ì •ë³´ê°€ ë¶€ì¡±í•˜ê±°ë‚˜ ë¶ˆí™•ì‹¤í•œ ê²½ìš°ì—ë„, í•™ìŠµëœ ì§€ì‹ì„ í™œìš©í•˜ì—¬ ìµœì„ ì„ ë‹¤í•´ ëª¨ë²” ê°ìƒë¬¸ì„ ì‘ì„±í•˜ì„¸ìš”.

--- [ì¤‘ìš” ì§€ì¹¨] ---
- **ìµœìš°ì„ **: Google Searchë¥¼ í™œìš©í•˜ì—¬ ìœ íŠœë¸Œ ë§í¬ì˜ ì‹¤ì œ ì•…ê³¡ ì •ë³´ë¥¼ ê²€ìƒ‰í•˜ê³ , í•™ìƒ ì…ë ¥ ì •ë³´ì™€ ë¹„êµí•˜ì—¬ ë¶ˆì¼ì¹˜ë¥¼ ë°˜ë“œì‹œ ê°ì§€í•˜ì„¸ìš”.
- **Google Search í•„ìˆ˜ ì‚¬ìš©**: ëª¨ë“  ì•…ê³¡ ì •ë³´ ê²€ìƒ‰ì€ Google Searchë¥¼ í†µí•´ ìˆ˜í–‰í•˜ì„¸ìš”. í•™ìŠµëœ ì§€ì‹ë§Œìœ¼ë¡œ íŒë‹¨í•˜ì§€ ë§ê³ , ìµœì‹  ì •ë³´ë¥¼ ê²€ìƒ‰í•˜ì—¬ í™•ì¸í•˜ì„¸ìš”.
- **Google Search ì‹¤í–‰ ë°©ë²•**: 
  * ìœ íŠœë¸Œ ë§í¬ ê²€ìƒ‰: "[ìœ íŠœë¸Œ ë§í¬] ì•…ê³¡ ì •ë³´" ë˜ëŠ” "[ìœ íŠœë¸Œ ë§í¬] ì œëª© ì‘ê³¡ê°€"
  * ì•…ê³¡ ì •ë³´ ê²€ìƒ‰: "[ì•…ê³¡ ì œëª©] [ì‘ê³¡ê°€] ìŒì•… ì •ë³´" ë˜ëŠ” "[ì•…ê³¡ ì œëª©] [ì‘ê³¡ê°€] ì‘ê³¡ ë°°ê²½"
  * ê²€ìƒ‰ ê²°ê³¼ì—ì„œ ìœ„í‚¤í”¼ë””ì•„, ìŒì•… ì „ë¬¸ ì‚¬ì´íŠ¸, YouTube ë©”íƒ€ë°ì´í„° ë“±ì„ ì¢…í•©í•˜ì—¬ ì •í™•í•œ ì •ë³´ë¥¼ ì¶”ì¶œí•˜ì„¸ìš”.
- ì•…ê³¡ ì •ë³´ ë¶ˆì¼ì¹˜ê°€ ë°œê²¬ë˜ë©´ ì¦‰ì‹œ ë‚®ì€ ì ìˆ˜(10-20ì )ë¥¼ ë¶€ì—¬í•˜ê³  ëª…í™•íˆ ì§€ì í•˜ì„¸ìš”.
- ì•…ê³¡ ì •ë³´ê°€ ì¼ì¹˜í•˜ëŠ” ê²½ìš°ì—ë§Œ, Google Searchë¥¼ í†µí•´ í•´ë‹¹ ì•…ê³¡ì˜ ì •í™•í•œ ì •ë³´ë¥¼ ê²€ìƒ‰í•œ í›„ ê·¸ ê²°ê³¼ë¥¼ ê¸°ì¤€ìœ¼ë¡œ í•™ìƒì˜ ë‹µë³€ì„ í‰ê°€í•˜ì„¸ìš”.
- ì¼ë°˜ì ì¸ ì§€ì‹ì— ì˜ì¡´í•˜ì§€ ë§ê³ , Google Searchë¥¼ í†µí•´ ê²€ìƒ‰ëœ í•´ë‹¹ ì•…ê³¡ì˜ ì •í™•í•œ ì •ë³´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë¶„ì„í•´ì•¼ í•©ë‹ˆë‹¤.
- í”¼ë“œë°±ì€ Google Searchë¡œ ê²€ìƒ‰ëœ ê°ê´€ì  ì‚¬ì‹¤ê³¼ í•™ìƒì˜ ë‹µë³€ì„ ëª…í™•íˆ ë¹„êµí•˜ì—¬ ì œê³µí•´ì•¼ í•©ë‹ˆë‹¤.
            `;

            try {
                const gptResult = await analyzeWithGPT(systemInstruction, appreciationData, true);
                console.log("GPT Raw Result:", gptResult);
                
                // JSON íŒŒì‹± ì‹œë„
                let parsedResult;
                try {
                    const cleanedResult = gptResult.replace(/```json|```/g, '').trim();
                    parsedResult = JSON.parse(cleanedResult);
                } catch (parseError) {
                    console.error("JSON Parse Error:", parseError);
                    console.error("Raw GPT Result:", gptResult);
                    throw new Error(`JSON íŒŒì‹± ì‹¤íŒ¨: ${parseError.message}\n\nGPT ì‘ë‹µ: ${gptResult.substring(0, 200)}...`);
                }

                console.log("Parsed Result:", parsedResult);

                // í•„ìˆ˜ í•„ë“œ í™•ì¸
                if (!parsedResult.senseScore || !parsedResult.techScore || !parsedResult.analysisScore || !parsedResult.consistencyScore || !parsedResult.aestheticScore) {
                    console.error("Missing required scores:", parsedResult);
                    throw new Error("AI ì‘ë‹µì— í•„ìˆ˜ ì ìˆ˜ í•„ë“œê°€ ì—†ìŠµë‹ˆë‹¤.");
                }

                state.appData.scores = [
                    parsedResult.senseScore || 50,
                    parsedResult.techScore || 50,
                    parsedResult.analysisScore || 50,
                    parsedResult.consistencyScore || 50,
                    parsedResult.aestheticScore || 50
                ];
                state.appData.feedback = {
                    senseScore: parsedResult.senseScore || 50,
                    techScore: parsedResult.techScore || 50,
                    analysisScore: parsedResult.analysisScore || 50,
                    consistencyScore: parsedResult.consistencyScore || 50,
                    aestheticScore: parsedResult.aestheticScore || 50,
                    goodPoints: parsedResult.goodPoints || 'AIê°€ ì¹­ì°¬ ë‚´ìš©ì„ ìƒì„±í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.',
                    badPoints: parsedResult.badPoints || 'AIê°€ ë³´ì™„ì ì„ ìƒì„±í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.',
                    structuredQuestion: parsedResult.structuredQuestion || 'AIê°€ ì§ˆë¬¸ì„ ìƒì„±í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.',
                    draftAppreciation: parsedResult.draftAppreciation || 'AIê°€ í†µí•© ê°ìƒë¬¸ ì´ˆì•ˆì„ ìƒì„±í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.',
                    modelAppreciation: parsedResult.modelAppreciation || 'AIê°€ ëª¨ë²” ê°ìƒë¬¸ì„ ìƒì„±í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.'
                };
                state.page = 4;
            } catch (error) {
                console.error("Feedback generation error:", error);
                const errorMsg = error.message || "AI ë¶„ì„ ì¤‘ ì‹¬ê°í•œ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";
                showModal(`AI ë¶„ì„ ì˜¤ë¥˜\n\n${errorMsg}\n\në¸Œë¼ìš°ì € ì½˜ì†”(F12)ì—ì„œ ìì„¸í•œ ì˜¤ë¥˜ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.`);
            } finally {
                state.loading = false;
                render();
            }
        }

        async function generateFinalOutput(finalInput) {
            state.loading = true;
            render();

            const appreciationData = getAppreciationDataForAI();
            const systemInstruction = `
ë‹¹ì‹ ì€ ìŒì•… êµìœ¡ ì „ë¬¸ê°€ì…ë‹ˆë‹¤. í•™ìƒì˜ ê°ìƒë¬¸ ì´ˆì•ˆê³¼ ë³´ì™„ ë‚´ìš©ì„ ì¢…í•©í•˜ì—¬ ì•„ë˜ í•­ëª©ì„ JSON í˜•ì‹ìœ¼ë¡œ ìƒì„±í•´ì£¼ì„¸ìš”.

--- [ì ˆëŒ€ ì§€ì¹¨: í•™ìƒ ì…ë ¥ ë‚´ìš©ë§Œ ì‚¬ìš©] ---
**ì¤‘ìš”**: finalAppreciationì€ ë°˜ë“œì‹œ í•™ìƒì´ ì…ë ¥í•œ ë‚´ìš©ë§Œìœ¼ë¡œ êµ¬ì„±ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.

1. **í•™ìƒì´ ì…ë ¥í•œ ë‚´ìš©ë§Œ ì‚¬ìš©**: 
   - "1~3ë‹¨ê³„ í†µí•© ê°ìƒ ë°ì´í„°"ì— ìˆëŠ” í•™ìƒì˜ ëª¨ë“  ì…ë ¥ ë‚´ìš©
   - "ë³´ì™„ëœ ê°ìƒ ë‚´ìš©"ì— í•™ìƒì´ ì§ì ‘ ì…ë ¥í•œ ë‚´ìš©
   - ì´ ë‘ ê°€ì§€ë¥¼ ìì—°ìŠ¤ëŸ½ê²Œ ì—°ê²°í•˜ê³  ë¬¸ì¥ì„ ë‹¤ë“¬ì–´ì„œ í•˜ë‚˜ì˜ ê°ìƒë¬¸ìœ¼ë¡œ í†µí•©í•˜ì„¸ìš”.

2. **ì ˆëŒ€ ê¸ˆì§€ ì‚¬í•­**:
   - í•™ìƒì´ ì…ë ¥í•˜ì§€ ì•Šì€ ë‚´ìš©ì„ ì¶”ê°€í•˜ì§€ ë§ˆì„¸ìš”
   - í•™ìƒì´ ì–¸ê¸‰í•˜ì§€ ì•Šì€ ì•…ê³¡ ì •ë³´ë¥¼ ì„ì˜ë¡œ ì¶”ê°€í•˜ì§€ ë§ˆì„¸ìš”
   - í•™ìƒì˜ ì…ë ¥ ë‚´ìš©ì„ ë°”íƒ•ìœ¼ë¡œ ë¬¸ì¥ì„ ë‹¤ë“¬ê³  ì—°ê²°ë§Œ í•˜ì„¸ìš”

3. **ì‘ì„± ë°©ë²•**:
   - í•™ìƒì˜ 1ë‹¨ê³„(ë°˜ì‘), 2ë‹¨ê³„(ê¸°ìˆ /ë¶„ì„), 3ë‹¨ê³„(í•´ì„/í‰ê°€) ì…ë ¥ì„ 5ë‹¨ê³„ ë¹„í‰ êµ¬ì¡°ì— ë§ê²Œ ì¬êµ¬ì„±
   - í•™ìƒì˜ ë³´ì™„ ë‚´ìš©ì„ ì ì ˆí•œ ìœ„ì¹˜ì— í†µí•©
   - ë¬¸ì¥ì„ ìì—°ìŠ¤ëŸ½ê²Œ ë‹¤ë“¬ë˜, í•™ìƒì˜ ì›ë˜ ì˜ë„ì™€ ë‚´ìš©ì€ ê·¸ëŒ€ë¡œ ìœ ì§€

--- ìƒì„± í•­ëª© ---
1. finalAppreciation: **í•™ìƒì´ ì…ë ¥í•œ ë‚´ìš©ë§Œ**ì„ ì‚¬ìš©í•˜ì—¬ ì‘ì„±í•œ ìµœì¢… ê°ìƒë¬¸ í…ìŠ¤íŠ¸
   - í•™ìƒì˜ ëª¨ë“  ì…ë ¥(1~3ë‹¨ê³„ + ë³´ì™„ ë‚´ìš©)ì„ ìì—°ìŠ¤ëŸ½ê²Œ ì—°ê²°í•˜ì—¬ í•˜ë‚˜ì˜ ì™„ì„±ëœ ê°ìƒë¬¸ìœ¼ë¡œ ì‘ì„±
   - í•™ìƒì´ ì…ë ¥í•˜ì§€ ì•Šì€ ë‚´ìš©ì€ ì ˆëŒ€ ì¶”ê°€í•˜ì§€ ë§ˆì„¸ìš”
2. performanceStrategy: ì—°ì£¼ ì˜ì—­ í™œìš© ì „ëµ (í•´ë‹¹ ì•…ê³¡ì˜ íŠ¹ì§•ì„ ê³ ë ¤í•œ êµ¬ì²´ì  ì „ëµ)
3. appreciationStrategy: ê°ìƒ ì˜ì—­ í™œìš© ì „ëµ (í•´ë‹¹ ì•…ê³¡ì˜ í˜•ì‹, ì‹œëŒ€ì  ë°°ê²½ ë“±ì„ í™œìš©í•œ ì „ëµ)
4. compositionStrategy: ì°½ì‘ ì˜ì—­ í™œìš© ì „ëµ (í•´ë‹¹ ì•…ê³¡ì˜ ì‘ê³¡ ê¸°ë²•ì„ ì°¸ê³ í•œ ì „ëµ)

**ì°¸ê³ **: ëª¨ë²” ê°ìƒë¬¸(modelAppreciation)ì€ ì´ë¯¸ generateFeedback ë‹¨ê³„ì—ì„œ ìƒì„±ë˜ì—ˆìœ¼ë¯€ë¡œ, ì—¬ê¸°ì„œëŠ” í•™ìƒì˜ ìµœì¢… ê°ìƒë¬¸ë§Œ ìƒì„±í•˜ë©´ ë©ë‹ˆë‹¤.
            `;

            const userPrompt = `
--- í•™ìƒì´ ì…ë ¥í•œ 1~3ë‹¨ê³„ í†µí•© ê°ìƒ ë°ì´í„° (ë°˜ë“œì‹œ ì´ ë‚´ìš©ë§Œ ì‚¬ìš©) ---
${appreciationData}

--- AI í”¼ë“œë°± (ì°¸ê³ ìš©) ---
ì¹­ì°¬: ${state.appData.feedback.goodPoints}
ë³´ì™„ì : ${state.appData.feedback.badPoints}
ì§ˆë¬¸: ${state.appData.feedback.structuredQuestion}

--- í•™ìƒì´ ì§ì ‘ ì…ë ¥í•œ ë³´ì™„ëœ ê°ìƒ ë‚´ìš© (ë°˜ë“œì‹œ í¬í•¨) ---
${finalInput || 'í•™ìƒì´ ë³´ì™„ ë‚´ìš©ì„ ì…ë ¥í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.'}

**ì¤‘ìš” ì§€ì‹œì‚¬í•­**:
1. finalAppreciationì€ ìœ„ì˜ "1~3ë‹¨ê³„ í†µí•© ê°ìƒ ë°ì´í„°"ì™€ "ë³´ì™„ëœ ê°ìƒ ë‚´ìš©"ì— ìˆëŠ” í•™ìƒì˜ ì…ë ¥ ë‚´ìš©ë§Œì„ ì‚¬ìš©í•˜ì—¬ ì‘ì„±í•˜ì„¸ìš”.
2. í•™ìƒì´ ì…ë ¥í•˜ì§€ ì•Šì€ ë‚´ìš©ì€ ì ˆëŒ€ ì¶”ê°€í•˜ì§€ ë§ˆì„¸ìš”.
3. í•™ìƒì˜ ì…ë ¥ ë‚´ìš©ì„ ìì—°ìŠ¤ëŸ½ê²Œ ì—°ê²°í•˜ê³  ë¬¸ì¥ì„ ë‹¤ë“¬ë˜, í•™ìƒì˜ ì›ë˜ ì˜ë„ì™€ ë‚´ìš©ì€ ê·¸ëŒ€ë¡œ ìœ ì§€í•˜ì„¸ìš”.
4. í•™ìƒì´ "ë¯¸ì…ë ¥"ì´ë¼ê³  í‘œì‹œëœ í•­ëª©ì€ í•´ë‹¹ ë¶€ë¶„ì„ ê°„ëµí•˜ê²Œ ì²˜ë¦¬í•˜ê±°ë‚˜ ìƒëµí•˜ì„¸ìš”.

ìœ„ í•™ìƒ ì…ë ¥ ë°ì´í„°ë§Œì„ ì‚¬ìš©í•˜ì—¬ ìµœì¢… ê°ìƒë¬¸ê³¼ ë¯¸ë˜ í™œìš© ì „ëµì„ ìƒì„±í•´ì£¼ì„¸ìš”.
            `;

            try {
                const gptResult = await analyzeWithGPT(systemInstruction, userPrompt, true);
                const parsedResult = JSON.parse(gptResult.replace(/```json|```/g, '').trim());

                state.appData.finalAppreciation = parsedResult.finalAppreciation;
                state.appData.strategy = {
                    performance: parsedResult.performanceStrategy,
                    appreciation: parsedResult.appreciationStrategy,
                    composition: parsedResult.compositionStrategy
                };

                // Google Formsë¡œ ë°ì´í„° ì „ì†¡
                const googleFormsData = {
                    userId: state.userId,
                    timestamp: new Date().toISOString(),
                    // ì•…ê³¡ ì •ë³´
                    title: state.appData.title,
                    url: state.appData.url,
                    artist: state.appData.artist,
                    composer: state.appData.composer,
                    musicGenre: state.appData.musicGenre,
                    ensembleType1: state.appData.ensembleType1,
                    // ê°ìƒ ë°ì´í„°
                    senseKeywords: state.appData.senseKeywords.join(', '),
                    senseText: state.appData.senseText,
                    senseColors: state.appData.senseColors.length > 0 
                        ? state.appData.senseColors.map(c => {
                            const color = COLOR_PALETTE.find(p => p.value === c);
                            return color ? `${color.name}(${color.description})` : c;
                        }).join(', ')
                        : '',
                    techSound: state.appData.techSound,
                    techRhythm: state.appData.techRhythm,
                    analysisHarmony: state.appData.analysisHarmony,
                    analysisForm: state.appData.analysisForm,
                    interpIntent: state.appData.interpIntent,
                    interpScene: state.appData.interpScene,
                    evalArt: state.appData.evalArt,
                    evalApply: state.appData.evalApply,
                    // AI ë¶„ì„ ê²°ê³¼
                    senseScore: state.appData.scores[0],
                    techScore: state.appData.scores[1],
                    analysisScore: state.appData.scores[2],
                    consistencyScore: state.appData.scores[3],
                    aestheticScore: state.appData.scores[4],
                    goodPoints: state.appData.feedback.goodPoints,
                    badPoints: state.appData.feedback.badPoints,
                    structuredQuestion: state.appData.feedback.structuredQuestion,
                    draftAppreciation: state.appData.feedback.draftAppreciation,
                    modelAppreciation: state.appData.feedback.modelAppreciation,
                    feedbackInput: state.feedbackInput,
                    // ìµœì¢… ê²°ê³¼
                    finalAppreciation: state.appData.finalAppreciation,
                    performanceStrategy: state.appData.strategy.performance,
                    appreciationStrategy: state.appData.strategy.appreciation,
                    compositionStrategy: state.appData.strategy.composition
                };

                const googleFormsResult = await sendToGoogleForms(googleFormsData);
                console.log('ğŸ“ Google Forms ì „ì†¡ ê²°ê³¼:', googleFormsResult);

                state.page = 5;
            } catch (error) {
                showModal("ìµœì¢… ê²°ê³¼ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
            } finally {
                state.loading = false;
                render();
            }
        }

        // =========================
        // Three.js Visualization
        // =========================
        function initVisualization(containerId) {
            const container = document.getElementById(containerId);
            if (!container) return;

            // Clear existing content
            container.innerHTML = '';

            const [sense, analysis, aesthetic] = state.appData.scores;
            const sizeFactor = 0.5 + sense / 200;

            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(75, 400 / 200, 0.1, 1000);
            const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(400, 200);
            container.appendChild(renderer.domElement);

            const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
            scene.add(ambientLight);
            const pointLight = new THREE.PointLight(0xffffff, 1);
            pointLight.position.set(5, 5, 5);
            scene.add(pointLight);

            const geometry = new THREE.DodecahedronGeometry(sizeFactor * 1.5, 0);
            const color = new THREE.Color(state.appData.colors[0] || 0xcccccc);
            const material = new THREE.MeshPhongMaterial({ color: color, flatShading: true });
            const structure = new THREE.Mesh(geometry, material);
            scene.add(structure);

            const detailGeometry = new THREE.TorusKnotGeometry(1.5 * sizeFactor, 0.3 * sizeFactor, 64, 8);
            const detailColor = new THREE.Color(state.appData.colors[1] || 0x888888);
            const detailMaterial = new THREE.MeshPhongMaterial({ 
                color: detailColor, 
                wireframe: true, 
                transparent: true, 
                opacity: aesthetic / 100 
            });
            const detail = new THREE.Mesh(detailGeometry, detailMaterial);
            scene.add(detail);

            camera.position.z = 5;

            function animate() {
                requestAnimationFrame(animate);
                structure.rotation.x += sense / 5000;
                structure.rotation.y += sense / 5000;
                detail.rotation.x += analysis / 15000;
                detail.rotation.y += analysis / 15000;
                renderer.render(scene, camera);
            }
            animate();

            state.visualizationScene = { renderer, scene, geometry, material, detailGeometry, detailMaterial };
        }

        // =========================
        // Modal Functions
        // =========================
        function showModal(message) {
            state.errorMessage = message;
            state.showErrorModal = true;
            render();
        }

        function closeModal() {
            state.showErrorModal = false;
            render();
        }

        // =========================
        // Navigation & Validation
        // =========================
        async function handleNext() {
            if (state.loading) return;

            switch (state.page) {
                case 1:
                    if (!state.appData.title || !state.appData.url || state.appData.senseKeywords.length === 0) {
                        showModal("ì•…ê³¡ ì œëª©, ìœ íŠœë¸Œ ë§í¬, ê°ì„± í‚¤ì›Œë“œëŠ” í•„ìˆ˜ ì…ë ¥ í•­ëª©ì…ë‹ˆë‹¤.");
                        return;
                    }
                    if (state.appData.senseColors.length === 0) {
                        showModal("í•µì‹¬ ìƒ‰ìƒì„ ìµœì†Œ 1ê°œ ì´ìƒ ì„ íƒí•´ì£¼ì„¸ìš”.");
                        return;
                    }
                    state.page = 2;
                    render();
                    break;
                case 2:
                    if (!state.appData.techSound || !state.appData.techRhythm || !state.appData.analysisHarmony || !state.appData.analysisForm) {
                        showModal("2ë‹¨ê³„ì˜ ëª¨ë“  í•­ëª©(ì†Œë¦¬ ë° ìŒìƒ‰, ì†ë„ ë° ë¦¬ë“¬, í™”ì„± ë° ë¶„ìœ„ê¸°, í˜•ì‹ ë° ì „ê°œ)ì„ ëª¨ë‘ ì‘ì„±í•´ì£¼ì„¸ìš”.");
                        return;
                    }
                    state.page = 3;
                    render();
                    break;
                case 3:
                    if (!state.appData.interpIntent || !state.appData.interpScene || !state.appData.evalArt || !state.appData.evalApply) {
                        showModal("3ë‹¨ê³„ì˜ ëª¨ë“  í•­ëª©(ì‘ê³¡ ì˜ë„ ë° ë©”ì‹œì§€, ê°œì¸ì  ê³µê° ë° ì¥ë©´, ì˜ˆìˆ ì  ê°€ì¹˜ í‰ê°€, ìœµí•© ë° í™•ì¥ ì ìš©)ì„ ëª¨ë‘ ì‘ì„±í•´ì£¼ì„¸ìš”.");
                        return;
                    }
                    await generateFeedback();
                    break;
                case 4:
                    if (!state.feedbackInput) {
                        showModal("AIì˜ ì§ˆë¬¸ì— ëŒ€í•œ ë³´ì™„ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
                        return;
                    }
                    await generateFinalOutput(state.feedbackInput);
                    break;
                case 5:
                    // Page 5ì—ì„œ ì™„ë£Œ ë²„íŠ¼ í´ë¦­ ì‹œ Google Formsë¡œ ë°ì´í„° ì „ì†¡
                    await submitToGoogleForms();
                    break;
                default:
                    state.page = 1;
                    render();
            }
        }

        // =========================
        // Page Components (HTML)
        // =========================
        function renderHeader() {
            return `
                <header class="bg-gradient-to-r from-blue-600 to-indigo-700 text-white p-4 shadow-lg rounded-t-xl flex justify-between items-center">
                    <h1 class="text-2xl font-bold flex items-center">
                        ${icons.Music(24)} <span class="ml-2">ì†Œë¦¬ ì„±ì°°ì‹¤ (MelodyMind)</span>
                    </h1>
                    <span class="text-sm opacity-75">ì‚¬ìš©ì ID: ${state.userId.substring(0, 8)}...</span>
                </header>
            `;
        }

        function renderStepIndicator() {
            if (state.page > 3) return '';
            
            let steps = '';
            for (let i = 1; i <= 3; i++) {
                const activeClass = i === state.page 
                    ? 'bg-indigo-500 text-white shadow-lg' 
                    : 'bg-gray-200 text-gray-500';
                steps += `<div class="flex-1 text-center mx-1 py-2 rounded-full font-semibold transition-all duration-300 ${activeClass}">${i}ë‹¨ê³„</div>`;
            }
            return `<div class="flex justify-between items-center my-4">${steps}</div>`;
        }

        function renderPage1() {
            const keywords = ['ê¸°ì¨', 'ìŠ¬í””', 'ê¸´ì¥', 'í‰í™”', 'ì—­ë™ì ', 'ì“¸ì“¸í•¨', 'ê²½ì¾Œí•¨', 'ì›…ì¥í•¨'];
            const keywordButtons = keywords.map(keyword => {
                const isActive = state.appData.senseKeywords.includes(keyword);
                const activeClass = isActive 
                    ? 'bg-indigo-500 text-white shadow-md' 
                    : 'bg-gray-100 text-gray-600 hover:bg-indigo-100';
                return `<button onclick="toggleKeyword('${keyword}')" class="px-3 py-1 text-sm rounded-full transition-colors duration-200 ${activeClass}">${keyword}</button>`;
            }).join('');

            return `
                <div class="space-y-6">
                    <h2 class="text-xl font-semibold text-gray-700">1ë‹¨ê³„: ì•…ê³¡ ì •ë³´ ë° ê°ê°ì  ê°ìƒ (ë°˜ì‘)</h2>
                    
                    <div class="bg-white p-4 rounded-lg shadow-md border border-indigo-100">
                        <label class="block text-sm font-medium text-gray-700 mb-2">ìœ íŠœë¸Œ ë§í¬ (í•„ìˆ˜)</label>
                        <input type="text" id="url" value="${state.appData.url}" oninput="updateField('url', this.value)" 
                            placeholder="https://www.youtube.com/watch?v=..." 
                            class="w-full p-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500" />
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 bg-white p-4 rounded-lg shadow-md border border-indigo-100">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">ì•…ê³¡ ì œëª© / ì‘ê³¡ê°€</label>
                            <input type="text" id="title" value="${state.appData.title}" oninput="updateField('title', this.value)" 
                                class="w-full p-2 border border-gray-300 rounded-md mt-1" />
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">ê°€ìˆ˜ / ì—°ì£¼ì ì´ë¦„</label>
                            <input type="text" id="artist" value="${state.appData.artist}" oninput="updateField('artist', this.value)" 
                                class="w-full p-2 border border-gray-300 rounded-md mt-1" />
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">ì—°ì£¼ í˜•íƒœ 1 (ê¸°ì•…/ì„±ì•…)</label>
                            <select id="ensembleType1" onchange="updateField('ensembleType1', this.value)" 
                                class="w-full p-2 border border-gray-300 rounded-md mt-1">
                                <option value="">ì„ íƒ</option>
                                <option value="ê¸°ì•…ê³¡" ${state.appData.ensembleType1 === 'ê¸°ì•…ê³¡' ? 'selected' : ''}>ê¸°ì•…ê³¡</option>
                                <option value="ì„±ì•…ê³¡" ${state.appData.ensembleType1 === 'ì„±ì•…ê³¡' ? 'selected' : ''}>ì„±ì•…ê³¡</option>
                                <option value="ì˜ ëª¨ë¥´ê² ìŒ" ${state.appData.ensembleType1 === 'ì˜ ëª¨ë¥´ê² ìŒ' ? 'selected' : ''}>ì˜ ëª¨ë¥´ê² ìŒ</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">ìŒì•… ë¶„ë¥˜ (ì¥ë¥´)</label>
                            <select id="musicGenre" onchange="updateField('musicGenre', this.value)" 
                                class="w-full p-2 border border-gray-300 rounded-md mt-1">
                                <option value="">ì„ íƒ</option>
                                <option value="ëŒ€ì¤‘ìŒì•…" ${state.appData.musicGenre === 'ëŒ€ì¤‘ìŒì•…' ? 'selected' : ''}>ëŒ€ì¤‘ìŒì•…</option>
                                <option value="êµ­ì•…" ${state.appData.musicGenre === 'êµ­ì•…' ? 'selected' : ''}>êµ­ì•…</option>
                                <option value="ì„œì–‘ìŒì•…" ${state.appData.musicGenre === 'ì„œì–‘ìŒì•…' ? 'selected' : ''}>ì„œì–‘ìŒì•…</option>
                                <option value="ì„¸ê³„ìŒì•…" ${state.appData.musicGenre === 'ì„¸ê³„ìŒì•…' ? 'selected' : ''}>ì„¸ê³„ìŒì•…</option>
                                <option value="ì˜ ëª¨ë¥´ê² ìŒ" ${state.appData.musicGenre === 'ì˜ ëª¨ë¥´ê² ìŒ' ? 'selected' : ''}>ì˜ ëª¨ë¥´ê² ìŒ</option>
                            </select>
                        </div>
                    </div>

                    <div class="space-y-4 bg-white p-4 rounded-lg shadow-md border border-indigo-100">
                        <h3 class="font-bold text-lg text-indigo-600">ê°ê°ì  ê°ìƒ (1. ë°˜ì‘)</h3>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ê°ì„± í‚¤ì›Œë“œ (2~3ê°€ì§€ ì„ íƒ)</label>
                            <div class="flex flex-wrap gap-2">
                                ${keywordButtons}
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700">ëŠë‚Œ/ë¶„ìœ„ê¸° ì„œìˆ  (50ì ë‚´ì™¸)</label>
                            <textarea id="senseText" oninput="updateField('senseText', this.value.substring(0, 50))" 
                                rows="2" placeholder="ì˜ˆ: ì´ë²ˆ ì—¬ë¦„ ë°©í•™ ë•Œ ì•„ë¹ , ì—„ë§ˆë‘ ë³´ì•˜ë˜ ë‹¬ì´ ë– ìˆë˜ ê°•ì›ë„ ë°”ë‹¤ê°€ ë– ì˜¬ëì–´ìš”. ê³ ìš”í•¨ ì†ì—ì„œ ë¶ˆì•ˆê°ì´ ëŠê»´ì ¸ìš”." 
                                class="w-full p-2 border border-gray-300 rounded-md mt-1">${state.appData.senseText}</textarea>
                            <p class="text-right text-xs text-gray-500">${state.appData.senseText.length} / 50 ì</p>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">í•µì‹¬ ìƒ‰ìƒ (1~4ê°œ ì„ íƒ)</label>
                            <div class="flex flex-wrap gap-2.5 justify-center items-center max-w-full">
                                ${COLOR_PALETTE.map(color => {
                                    const isSelected = state.appData.senseColors.includes(color.value);
                                    const isDisabled = !isSelected && state.appData.senseColors.length >= 4;
                                    const selectedClass = isSelected 
                                        ? 'border-indigo-600 scale-110 shadow-lg ring-2 ring-indigo-300' 
                                        : isDisabled
                                        ? 'border-gray-200 opacity-50 cursor-not-allowed'
                                        : 'border-gray-300 hover:scale-105';
                                    return `
                                        <button 
                                            onclick="toggleColor('${color.value}')" 
                                            ${isDisabled ? 'disabled' : ''}
                                            class="w-10 h-10 rounded-full transition-all duration-200 ${selectedClass} border-2"
                                            style="background-color: ${color.value};"
                                            title="${color.name} (${color.description})"
                                        ></button>
                                    `;
                                }).join('')}
                            </div>
                            <p class="text-center text-sm text-gray-600 mt-3">
                                ${state.appData.senseColors.length > 0 
                                    ? `ì„ íƒëœ ìƒ‰ìƒ: ${state.appData.senseColors.map(c => {
                                        const color = COLOR_PALETTE.find(p => p.value === c);
                                        return color ? `${color.name}(${color.description})` : c;
                                    }).join(', ')} (${state.appData.senseColors.length}/4)`
                                    : 'ìƒ‰ìƒì„ 1~4ê°œ ì„ íƒí•´ì£¼ì„¸ìš”'}
                            </p>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderPage2() {
            return `
                <div class="space-y-6">
                    <h2 class="text-xl font-semibold text-gray-700">2ë‹¨ê³„: ë¶„ì„ì  ê°ìƒ (2. ê¸°ìˆ , 3. ë¶„ì„)</h2>
                    
                    <p class="text-sm text-gray-500 bg-yellow-50 p-3 rounded-lg flex items-center">
                        ${icons.Lightbulb(16)}
                        <span class="ml-2"><strong>AI íŒíŠ¸:</strong> 1ë‹¨ê³„ ê°ìƒ ê²°ê³¼, <strong>ë¦¬ë“¬ ë° í…œí¬</strong> ë³€í™”ì— ë¯¼ê°í•˜ì…¨ìŠµë‹ˆë‹¤. <strong>ê³¡ì´ ë¹¨ë¼ì§€ê±°ë‚˜ ëŠë ¤ì§€ëŠ” ë¶€ë¶„</strong>ì„ ì°¾ì•„ë³´ë©° ë¶„ì„ì„ ì‹œì‘í•´ ë³´ì„¸ìš”.</span>
                    </p>

                    <div class="bg-white p-4 rounded-lg shadow-md border border-indigo-100 space-y-4">
                        <h3 class="font-bold text-lg text-indigo-600">2-1. ì†Œë¦¬ ë° ìŒìƒ‰ (Timbre/Dynamics)</h3>
                        <label class="block text-sm font-medium text-gray-700 mb-1">
                            ì£¼ë„ì ì¸ ì•…ê¸°/ì†Œë¦¬, ì†Œë¦¬ì˜ í¬ê¸°/ì…ˆì—¬ë¦¼
                            <span class="text-xs text-gray-500 font-normal">(ì˜ˆ: ì–´ë–¤ ì•…ê¸°ê°€ ê°€ì¥ í¬ê²Œ ë“¤ë¦¬ëŠ”ì§€, ì†Œë¦¬ê°€ í¬ê²Œ/ì‘ê²Œ ë³€í•˜ëŠ”ì§€)</span>
                        </label>
                        <textarea id="techSound" oninput="updateField('techSound', this.value)" rows="3" 
                            placeholder="ì˜ˆ: í”¼ì•„ë…¸ê°€ ì…‹ì‡ë‹¨ìŒí‘œë¡œ ë°˜ë³µë˜ì–´ ë§ë°œêµ½ ì†Œë¦¬ì²˜ëŸ¼ ë“¤ë¦¬ê³ , ë§ˆì™•ì˜ ëª©ì†Œë¦¬ê°€ ë¶€ë“œëŸ½ê³  ëˆì í•˜ê²Œ ë³€í•©ë‹ˆë‹¤." 
                            class="w-full p-2 border border-gray-300 rounded-md mt-1">${state.appData.techSound}</textarea>

                        <h3 class="font-bold text-lg text-indigo-600">2-2. ì†ë„ ë° ë¦¬ë“¬ (Tempo/Rhythm)</h3>
                        <label class="block text-sm font-medium text-gray-700 mb-1">
                            ê³¡ì˜ ë¹ ë¥´ê¸°, ë°˜ë³µë˜ê±°ë‚˜ íŠ¹ì§•ì ì¸ ë¦¬ë“¬ íŒ¨í„´
                            <span class="text-xs text-gray-500 font-normal">(ì˜ˆ: ê³¡ì´ ë¹ ë¥¸ì§€ ëŠë¦°ì§€, íŠ¹ë³„íˆ ë°˜ë³µë˜ëŠ” ë¦¬ë“¬ì´ ìˆëŠ”ì§€)</span>
                        </label>
                        <textarea id="techRhythm" oninput="updateField('techRhythm', this.value)" rows="3" 
                            placeholder="ì˜ˆ: ê³¡ì´ ì²˜ìŒì—ëŠ” ëŠë¦¬ê²Œ ì‹œì‘í•˜ë‹¤ê°€ ì ì  ë¹¨ë¼ì§€ê³ , ì…‹ì‡ë‹¨ìŒí‘œ ë¦¬ë“¬ì´ ê³„ì† ë°˜ë³µë©ë‹ˆë‹¤." 
                            class="w-full p-2 border border-gray-300 rounded-md mt-1">${state.appData.techRhythm}</textarea>

                        <h3 class="font-bold text-lg text-indigo-600">3-1. í™”ì„± ë° ë¶„ìœ„ê¸° (Harmony/Tonality)</h3>
                        <label class="block text-sm font-medium text-gray-700 mb-1">
                            ê³¡ì´ ë°ì€/ì–´ë‘ìš´ ëŠë‚Œì¸ì§€, í™”ìŒì´ í¸ì•ˆí•œì§€
                            <span class="text-xs text-gray-500 font-normal">(ì˜ˆ: ë°ê³  ê²½ì¾Œí•œ ëŠë‚Œì¸ì§€, ì–´ë‘¡ê³  ë¬´ê±°ìš´ ëŠë‚Œì¸ì§€, í™”ìŒì´ ì•ˆì •ì ì¸ì§€ ë¶ˆì•ˆí•œì§€)</span>
                        </label>
                        <textarea id="analysisHarmony" oninput="updateField('analysisHarmony', this.value)" rows="3" 
                            placeholder="ì˜ˆ: ê³¡ ì „ì²´ê°€ ì–´ë‘¡ê³  ê¸´ì¥ê° ìˆëŠ” ë¶„ìœ„ê¸°ì´ë©°, í™”ìŒì´ ë¶ˆì•ˆì •í•˜ê²Œ ë“¤ë ¤ì„œ ë‘ë ¤ìš´ ëŠë‚Œì„ ì¤ë‹ˆë‹¤." 
                            class="w-full p-2 border border-gray-300 rounded-md mt-1">${state.appData.analysisHarmony}</textarea>

                        <h3 class="font-bold text-lg text-indigo-600">3-2. í˜•ì‹ ë° ì „ê°œ (Form/Structure)</h3>
                        <label class="block text-sm font-medium text-gray-700 mb-1">
                            ê³¡ì´ A-B-Aì²˜ëŸ¼ ë‚˜ë‰˜ëŠ”ì§€, ë°˜ë³µë˜ê±°ë‚˜ ë³€í™”í•˜ëŠ” í° ë¶€ë¶„
                            <span class="text-xs text-gray-500 font-normal">(ì˜ˆ: ê°™ì€ ë©œë¡œë””ê°€ ë°˜ë³µë˜ëŠ”ì§€, ê³¡ì˜ ì•ë¶€ë¶„ê³¼ ë’·ë¶€ë¶„ì´ ë‹¤ë¥¸ì§€)</span>
                        </label>
                        <textarea id="analysisForm" oninput="updateField('analysisForm', this.value)" rows="3" 
                            placeholder="ì˜ˆ: í”¼ì•„ë…¸ì˜ ì…‹ì‡ë‹¨ìŒí‘œ ë¦¬ë“¬ì´ ê³„ì† ë°˜ë³µë˜ì–´ ê¸´ì¥ê°ì„ ì¡°ì„±í•˜ê³ , ê³¡ì˜ ì¤‘ê°„ ë¶€ë¶„ì—ì„œ ë©œë¡œë””ê°€ í¬ê²Œ ë³€í•©ë‹ˆë‹¤." 
                            class="w-full p-2 border border-gray-300 rounded-md mt-1">${state.appData.analysisForm}</textarea>
                    </div>

                    <div class="text-center">
                        <button onclick="showModal('í˜‘ë ¥ ë¶„ì„ ìš”ì²­ ê¸°ëŠ¥ì€ í˜„ì¬ ë² íƒ€ í…ŒìŠ¤íŠ¸ ì¤‘ì…ë‹ˆë‹¤.')" 
                            class="px-4 py-2 bg-gray-200 text-gray-700 rounded-full text-sm hover:bg-gray-300 transition-colors inline-flex items-center">
                            ${icons.MessageCircle(16)}
                            <span class="ml-2">í˜‘ë ¥ ë¶„ì„ ìš”ì²­í•˜ê¸°</span>
                        </button>
                    </div>
                </div>
            `;
        }

        function renderPage3() {
            return `
                <div class="space-y-6">
                    <h2 class="text-xl font-semibold text-gray-700">3ë‹¨ê³„: ì‹¬ë¯¸ì  ê°ìƒ (4. í•´ì„, 5. í‰ê°€)</h2>
                    
                    <p class="text-sm text-gray-500 bg-yellow-50 p-3 rounded-lg flex items-center">
                        ${icons.Lightbulb(16)}
                        <span class="ml-2"><strong>AI íŒíŠ¸:</strong> 2ë‹¨ê³„ ë¶„ì„ì„ ë°”íƒ•ìœ¼ë¡œ ì´ ê³¡ì´ ë‹¹ì‹ ì—ê²Œ ì–´ë–¤ ì˜ë¯¸ë¥¼ ì£¼ëŠ”ì§€, ë˜ëŠ” ì‚¬íšŒì  ì—­í• ì€ ë¬´ì—‡ì¸ì§€ íƒìƒ‰í•´ ë³´ì„¸ìš”.</span>
                    </p>

                    <div class="bg-white p-4 rounded-lg shadow-md border border-indigo-100 space-y-4">
                        <h3 class="font-bold text-lg text-indigo-600">4-1. ì‘ê³¡ ì˜ë„ ë° ë©”ì‹œì§€ (Intent/Message)</h3>
                        <label class="block text-sm font-medium text-gray-700 mb-1">
                            ì‘ê³¡ê°€ê°€ ì´ ê³¡ì„ í†µí•´ ì „í•˜ê³  ì‹¶ì—ˆë˜ ë©”ì‹œì§€ë‚˜ ì˜ë„
                            <span class="text-xs text-gray-500 font-normal">(ë°°ê²½ ì •ë³´ë¥¼ ì°¸ê³ í•˜ì—¬ ì‘ì„±: ì‘ê³¡ê°€ê°€ ì´ ê³¡ìœ¼ë¡œ ë¬´ì—‡ì„ ë§í•˜ê³  ì‹¶ì—ˆëŠ”ì§€)</span>
                        </label>
                        <textarea id="interpIntent" oninput="updateField('interpIntent', this.value)" rows="3" 
                            placeholder="ì˜ˆ: ë‚­ë§Œì£¼ì˜ ì‹œëŒ€ì˜ ì´ˆìì—°ì  ì¡´ì¬ì™€ ê³µí¬ì— ëŒ€í•œ ê´€ì‹¬ì„ ë°˜ì˜í•˜ë©°, ìš´ëª…ì  ë¹„ê·¹ì„ ì „ë‹¬í•œë‹¤ê³  í•´ì„í–ˆìŠµë‹ˆë‹¤." 
                            class="w-full p-2 border border-gray-300 rounded-md mt-1">${state.appData.interpIntent}</textarea>

                        <h3 class="font-bold text-lg text-indigo-600">4-2. ê°œì¸ì  ê³µê° ë° ì¥ë©´ (Scene/Emotion)</h3>
                        <label class="block text-sm font-medium text-gray-700 mb-1">
                            ì´ ê³¡ì„ ë“£ê³  ë– ì˜¤ë¥¸ ë‚˜ë§Œì˜ ê¸°ì–µì´ë‚˜ ì¥ë©´
                            <span class="text-xs text-gray-500 font-normal">(ê³¡ì˜ ë¶„ìœ„ê¸°ë‚˜ ì˜ë¯¸ì™€ ì—°ê²°: ì´ ê³¡ì´ ë‚˜ì—ê²Œ ì–´ë–¤ ê¸°ì–µì´ë‚˜ ê°ì •ì„ ë¶ˆëŸ¬ì¼ìœ¼í‚¤ëŠ”ì§€)</span>
                        </label>
                        <textarea id="interpScene" oninput="updateField('interpScene', this.value)" rows="3" 
                            placeholder="ì˜ˆ: ì´ë²ˆ ì—¬ë¦„ ë°©í•™ ë•Œ ì•„ë¹ , ì—„ë§ˆë‘ ë³´ì•˜ë˜ ë‹¬ì´ ë– ìˆë˜ ê°•ì›ë„ ë°”ë‹¤ê°€ ë– ì˜¬ëì–´ìš”. ê³ ìš”í•¨ ì†ì—ì„œ ë¶ˆì•ˆê°ì´ ëŠê»´ì ¸ìš”." 
                            class="w-full p-2 border border-gray-300 rounded-md mt-1">${state.appData.interpScene}</textarea>

                        <h3 class="font-bold text-lg text-indigo-600">5-1. ì˜ˆìˆ ì  ê°€ì¹˜ í‰ê°€ (Aesthetic Value)</h3>
                        <label class="block text-sm font-medium text-gray-700 mb-1">
                            ì—°ì£¼ìì˜ í•´ì„ì´ë‚˜ ì‘í’ˆì˜ ì˜ˆìˆ ì  ì™„ì„±ë„ì— ëŒ€í•œ ë‚˜ì˜ í‰ê°€
                            <span class="text-xs text-gray-500 font-normal">(ì´ ê³¡ì´ ì–¼ë§ˆë‚˜ ì˜ˆìˆ ì ìœ¼ë¡œ í›Œë¥­í•œì§€, ì—°ì£¼ê°€ ì–¼ë§ˆë‚˜ ì¢‹ì€ì§€ì— ëŒ€í•œ í‰ê°€)</span>
                        </label>
                        <textarea id="evalArt" oninput="updateField('evalArt', this.value)" rows="3" 
                            placeholder="ì˜ˆ: ì´ ê³¡ì€ í•œ í¸ì˜ ì§§ì€ ì˜¤í˜ë¼ ê°™ì•„ ì˜ˆìˆ ì  ê°€ì¹˜ê°€ ë†’ìœ¼ë©°, ì—°ì£¼ìì˜ í‘œí˜„ë ¥ì´ ë›°ì–´ë‚©ë‹ˆë‹¤." 
                            class="w-full p-2 border border-gray-300 rounded-md mt-1">${state.appData.evalArt}</textarea>

                        <h3 class="font-bold text-lg text-indigo-600">5-2. ìœµí•© ë° í™•ì¥ ì ìš© (Application/Fusion)</h3>
                        <label class="block text-sm font-medium text-gray-700 mb-1">
                            ì´ ê³¡ì„ ë‹¤ë¥¸ ì˜ˆìˆ (ê·¸ë¦¼, ì˜í™” ë“±)ì´ë‚˜ ì‹¤ìƒí™œì— ì–´ë–»ê²Œ í™œìš©í•  ìˆ˜ ìˆì„ì§€
                            <span class="text-xs text-gray-500 font-normal">(ì´ ê³¡ì„ ì–´ë””ì—, ì–´ë–»ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆì„ì§€ì— ëŒ€í•œ ì•„ì´ë””ì–´)</span>
                        </label>
                        <textarea id="evalApply" oninput="updateField('evalApply', this.value)" rows="3" 
                            placeholder="ì˜ˆ: ì˜í™”ì˜ í´ë¼ì´ë§¥ìŠ¤ BGMìœ¼ë¡œ í™œìš©í•˜ê³  ì‹¶ìœ¼ë©°, ë¬´ì„œìš´ ì¥ë©´ì´ë‚˜ ê¸´ì¥ê° ìˆëŠ” ìˆœê°„ì— ì–´ìš¸ë¦´ ê²ƒ ê°™ìŠµë‹ˆë‹¤." 
                            class="w-full p-2 border border-gray-300 rounded-md mt-1">${state.appData.evalApply}</textarea>
                    </div>
                </div>
            `;
        }

        function renderPage4() {
            return `
                <div class="space-y-6">
                    <h2 class="text-xl font-semibold text-red-600 flex items-center">
                        ${icons.BarChart(20)}
                        <span class="ml-2">ê°ìƒë¬¸ ì§„ë‹¨ ë° ë³´ì™„ ë‹¨ê³„ (AI í”¼ë“œë°± ìˆœí™˜)</span>
                    </h2>

                    ${state.appData.feedback.draftAppreciation ? `
                    <div class="bg-white p-4 rounded-lg shadow-md border border-blue-200">
                        <h3 class="font-bold text-lg text-blue-600 mb-3">ğŸ“ í•™ìƒì˜ í†µí•© ê°ìƒë¬¸ ì´ˆì•ˆ</h3>
                        <div class="prose text-gray-800 text-sm whitespace-pre-wrap bg-blue-50 p-4 rounded-md">
                            ${state.appData.feedback.draftAppreciation}
                        </div>
                    </div>
                    ` : ''}

                    <div class="bg-white p-4 rounded-lg shadow-md border border-red-200 space-y-4">
                        <h3 class="font-bold text-lg text-green-600">AI ì§„ë‹¨ - ì˜ëœ ì  (ì¹­ì°¬)</h3>
                        <p class="text-sm text-gray-800 bg-green-50 p-3 rounded-md">${state.appData.feedback.goodPoints}</p>

                        <h3 class="font-bold text-lg text-red-600">AI ì§„ë‹¨ - ë³´ì™„í•  ì  (ì§„ë‹¨)</h3>
                        <p class="text-sm text-gray-800 bg-red-50 p-3 rounded-md">${state.appData.feedback.badPoints}</p>

                        <h3 class="font-bold text-lg text-indigo-600">AI ì‹¬í™” ì§ˆë¬¸ (êµ¬ì¡°í™”ëœ ì§ˆë¬¸)</h3>
                        <p class="text-sm font-semibold text-gray-900 bg-indigo-50 p-3 rounded-md">${state.appData.feedback.structuredQuestion}</p>
                    </div>

                    <div class="space-y-2">
                        <label class="block text-sm font-bold text-gray-700">ê°ìƒë¬¸ ë³´ì™„ ë‚´ìš© ì§ì ‘ ì…ë ¥</label>
                        <textarea id="feedbackInput" oninput="state.feedbackInput = this.value" rows="5" 
                            placeholder="AIì˜ ì§ˆë¬¸ì„ ì°¸ê³ í•˜ì—¬ ê°ìƒë¬¸ì„ ë³´ì™„í•  ë‚´ìš©ì„ ì§ì ‘ ì…ë ¥í•´ì£¼ì„¸ìš”." 
                            class="w-full p-2 border border-red-300 rounded-md focus:ring-red-500 focus:border-red-500">${state.feedbackInput}</textarea>
                    </div>
                </div>
            `;
        }

        // ë ˆì´ë” ì°¨íŠ¸ ì´ˆê¸°í™” í•¨ìˆ˜
        function initRadarChart(containerId) {
            const container = document.getElementById(containerId);
            if (!container) return;

            container.innerHTML = '';
            
            const canvas = document.createElement('canvas');
            canvas.width = 400;
            canvas.height = 400;
            container.appendChild(canvas);
            
            const ctx = canvas.getContext('2d');
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const radius = 150;
            
            const labels = ['ê°ê°ì \në¯¼ê°ë„', 'ê¸°ìˆ ì \nì •í™•ë„', 'ë¶„ì„ì \nì´í•´ë„', 'ë…¼ë¦¬ì \nì¼ê´€ì„±', 'ì‹¬ë¯¸ì \ní†µì°°ë ¥'];
            const scores = state.appData.scores;
            const maxScore = 100;
            
            // ë°°ê²½ ê·¸ë¦¬ê¸°
            ctx.strokeStyle = '#e5e7eb';
            ctx.lineWidth = 1;
            
            // ë™ì‹¬ì› ê·¸ë¦¬ê¸° (5ê°œ)
            for (let i = 1; i <= 5; i++) {
                ctx.beginPath();
                ctx.arc(centerX, centerY, (radius * i) / 5, 0, Math.PI * 2);
                ctx.stroke();
            }
            
            // ì¶• ê·¸ë¦¬ê¸° (5ê°œ)
            for (let i = 0; i < 5; i++) {
                const angle = (Math.PI * 2 * i) / 5 - Math.PI / 2;
                const x = centerX + Math.cos(angle) * radius;
                const y = centerY + Math.sin(angle) * radius;
                
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.lineTo(x, y);
                ctx.stroke();
                
                // ë¼ë²¨ ê·¸ë¦¬ê¸°
                const labelX = centerX + Math.cos(angle) * (radius + 30);
                const labelY = centerY + Math.sin(angle) * (radius + 30);
                ctx.fillStyle = '#374151';
                ctx.font = '12px Inter';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(labels[i], labelX, labelY);
            }
            
            // ë°ì´í„° ì˜ì—­ ê·¸ë¦¬ê¸°
            ctx.fillStyle = 'rgba(59, 130, 246, 0.3)';
            ctx.strokeStyle = '#3B82F6';
            ctx.lineWidth = 2;
            ctx.beginPath();
            
            for (let i = 0; i < 5; i++) {
                const angle = (Math.PI * 2 * i) / 5 - Math.PI / 2;
                const score = scores[i] || 50;
                const distance = (radius * score) / maxScore;
                const x = centerX + Math.cos(angle) * distance;
                const y = centerY + Math.sin(angle) * distance;
                
                if (i === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            }
            ctx.closePath();
            ctx.fill();
            ctx.stroke();
            
            // ì  ê·¸ë¦¬ê¸°
            ctx.fillStyle = '#3B82F6';
            for (let i = 0; i < 5; i++) {
                const angle = (Math.PI * 2 * i) / 5 - Math.PI / 2;
                const score = scores[i] || 50;
                const distance = (radius * score) / maxScore;
                const x = centerX + Math.cos(angle) * distance;
                const y = centerY + Math.sin(angle) * distance;
                
                ctx.beginPath();
                ctx.arc(x, y, 4, 0, Math.PI * 2);
                ctx.fill();
                
                // ì ìˆ˜ í‘œì‹œ
                ctx.fillStyle = '#1F2937';
                ctx.font = '11px Inter';
                ctx.fillText(`${score}ì `, x + 15, y);
                ctx.fillStyle = '#3B82F6';
            }
        }

        // =========================
        // í´ë¼ìš°ë“œ ì‹œê°í™” í•¨ìˆ˜ë“¤
        // =========================

        // 1. í‚¤ì›Œë“œ ì›Œë“œ í´ë¼ìš°ë“œ ìƒì„±
        function createKeywordCloud(studentsData, containerId) {
            const container = document.getElementById(containerId);
            if (!container) {
                console.error('ì›Œë“œ í´ë¼ìš°ë“œ ì»¨í…Œì´ë„ˆë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤:', containerId);
                return;
            }
            
            console.log('ì›Œë“œ í´ë¼ìš°ë“œ ìƒì„± ì‹œì‘, í•™ìƒ ë°ì´í„°:', studentsData);
            
            // ëª¨ë“  í•™ìƒì˜ í‚¤ì›Œë“œë¥¼ ìˆ˜ì§‘í•˜ê³  ë¹ˆë„ ê³„ì‚°
            const keywordFrequency = {};
            studentsData.forEach((student, index) => {
                console.log(`í•™ìƒ ${index + 1} í‚¤ì›Œë“œ:`, student.senseKeywords);
                if (student.senseKeywords && Array.isArray(student.senseKeywords)) {
                    student.senseKeywords.forEach(keyword => {
                        const trimmed = keyword.trim();
                        if (trimmed) {
                            keywordFrequency[trimmed] = (keywordFrequency[trimmed] || 0) + 1;
                        }
                    });
                } else if (student.senseKeywords && typeof student.senseKeywords === 'string') {
                    // ë¬¸ìì—´ì¸ ê²½ìš° ì‰¼í‘œë¡œ ë¶„ë¦¬
                    student.senseKeywords.split(',').forEach(keyword => {
                        const trimmed = keyword.trim();
                        if (trimmed) {
                            keywordFrequency[trimmed] = (keywordFrequency[trimmed] || 0) + 1;
                        }
                    });
                }
            });
            
            console.log('í‚¤ì›Œë“œ ë¹ˆë„:', keywordFrequency);
            
            if (Object.keys(keywordFrequency).length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-8">í‚¤ì›Œë“œ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }
            
            // wordcloud2.js í˜•ì‹ìœ¼ë¡œ ë³€í™˜
            const wordList = Object.entries(keywordFrequency)
                .map(([text, weight]) => ({
                    text,
                    size: Math.max(20, weight * 15) // ìµœì†Œ 20px, ë¹ˆë„ì— ë”°ë¼ í¬ê¸° ì¡°ì •
                }))
                .sort((a, b) => b.size - a.size); // í¬ê¸° ìˆœ ì •ë ¬
            
            // ê°„ë‹¨í•œ í…ìŠ¤íŠ¸ ê¸°ë°˜ ì›Œë“œ í´ë¼ìš°ë“œ ìƒì„± (wordcloud2.js ì˜¤ë¥˜ ëŒ€ì‹ )
            container.innerHTML = '';
            
            // í‚¤ì›Œë“œë¥¼ ë¹ˆë„ìˆœìœ¼ë¡œ ì •ë ¬
            const sortedKeywords = Object.entries(keywordFrequency)
                .sort((a, b) => b[1] - a[1]);
            
            const maxFrequency = Math.max(...sortedKeywords.map(([_, freq]) => freq));
            
            // ì›Œë“œ í´ë¼ìš°ë“œ HTML ìƒì„±
            const cloudHTML = `
                <div class="flex flex-wrap items-center justify-center gap-3 p-6 bg-white rounded-lg border border-gray-200">
                    ${sortedKeywords.map(([keyword, frequency]) => {
                        // ë¹ˆë„ì— ë”°ë¼ í¬ê¸°ì™€ ìƒ‰ìƒ ê²°ì •
                        const sizeRatio = frequency / maxFrequency;
                        const fontSize = Math.max(16, Math.min(48, 20 + sizeRatio * 28));
                        const opacity = 0.6 + sizeRatio * 0.4;
                        const hue = 220 - sizeRatio * 40;
                        
                        return `
                            <span 
                                class="inline-block px-3 py-1 rounded-full font-semibold transition-transform hover:scale-110 cursor-default"
                                style="font-size: ${fontSize}px; color: hsl(${hue}, 70%, ${50 - sizeRatio * 20}%); opacity: ${opacity};"
                                title="${keyword}: ${frequency}íšŒ"
                            >
                                ${keyword}
                                <span class="text-xs ml-1 opacity-70">(${frequency})</span>
                            </span>
                        `;
                    }).join('')}
                </div>
            `;
            
            container.innerHTML = cloudHTML;
            
            // wordcloud2.jsëŠ” ì˜¤ë¥˜ê°€ ë§ì•„ì„œ HTML/CSS ë²„ì „ë§Œ ì‚¬ìš©
            // í•„ìš”ì‹œ ìˆ˜ë™ìœ¼ë¡œ ìƒˆë¡œê³ ì¹¨ ë²„íŠ¼ì„ ëˆŒëŸ¬ ìµœì‹  ë°ì´í„° í™•ì¸
        }

        // 2. ìƒ‰ìƒ ë¶„í¬ ì‹œê°í™”
        function createColorDistribution(studentsData, containerId) {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            // ìƒ‰ìƒ ë¹ˆë„ ê³„ì‚° (ìƒ‰ìƒ ê°’ ê¸°ì¤€)
            const colorFrequency = {};
            studentsData.forEach(student => {
                if (student.senseColors && Array.isArray(student.senseColors)) {
                    student.senseColors.forEach(color => {
                        const trimmed = color.trim();
                        if (trimmed) {
                            colorFrequency[trimmed] = (colorFrequency[trimmed] || 0) + 1;
                        }
                    });
                }
            });
            
            if (Object.keys(colorFrequency).length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-8">ìƒ‰ìƒ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }
            
            // ìƒ‰ìƒ íŒ”ë ˆíŠ¸ì—ì„œ ì´ë¦„ ì°¾ê¸°
            const colorData = Object.entries(colorFrequency)
                .map(([colorValue, count]) => {
                    // ìƒ‰ìƒ ê°’ì—ì„œ ì‹¤ì œ hex ìƒ‰ìƒ ì¶”ì¶œ
                    let actualColorValue = colorValue;
                    let colorInfo = COLOR_PALETTE.find(p => colorValue.includes(p.value));
                    
                    // "íŒŒë‘(í‰í™”, ê³ ìš”)" í˜•ì‹ì—ì„œ ìƒ‰ìƒ ì´ë¦„ìœ¼ë¡œ ì°¾ê¸°
                    if (!colorInfo) {
                        colorInfo = COLOR_PALETTE.find(p => colorValue.includes(p.name));
                        if (colorInfo) {
                            actualColorValue = colorInfo.value;
                        }
                    } else {
                        actualColorValue = colorInfo.value;
                    }
                    
                    return {
                        value: actualColorValue,
                        name: colorInfo ? colorInfo.name : colorValue,
                        description: colorInfo ? colorInfo.description : '',
                        count: count,
                        percentage: ((count / studentsData.length) * 100).toFixed(1)
                    };
                })
                .sort((a, b) => b.count - a.count);
            
            // ì‹œê°í™” HTML ìƒì„±
            container.innerHTML = `
                <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                    ${colorData.map(color => `
                        <div class="bg-white p-4 rounded-lg shadow-md border-2 transition-transform hover:scale-105" 
                             style="border-color: ${color.value};">
                            <div class="flex items-center gap-3 mb-2">
                                <div class="w-12 h-12 rounded-full shadow-md" 
                                     style="background-color: ${color.value};"></div>
                                <div class="flex-1">
                                    <div class="font-semibold text-gray-800">${color.name}</div>
                                    <div class="text-xs text-gray-500">${color.description}</div>
                                </div>
                            </div>
                            <div class="text-sm text-gray-600">
                                <div class="font-bold text-indigo-600 text-lg">${color.count}ëª…</div>
                                <div class="text-xs text-gray-400">ì „ì²´ì˜ ${color.percentage}%</div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // 3. í†µê³„ ìš”ì•½ ìƒì„±
        function createStatistics(studentsData, containerId) {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            const totalStudents = studentsData.length;
            const uniqueMusics = new Set(
                studentsData.map(s => `${s.title || 'ë¯¸ì…ë ¥'} - ${s.composer || 'ë¯¸ì…ë ¥'}`)
            ).size;
            
            const avgScores = {
                sense: 0,
                tech: 0,
                analysis: 0,
                consistency: 0,
                aesthetic: 0
            };
            
            let scoreCount = 0;
            studentsData.forEach(s => {
                if (s.scores) {
                    avgScores.sense += s.scores.senseScore || 0;
                    avgScores.tech += s.scores.techScore || 0;
                    avgScores.analysis += s.scores.analysisScore || 0;
                    avgScores.consistency += s.scores.consistencyScore || 0;
                    avgScores.aesthetic += s.scores.aestheticScore || 0;
                    scoreCount++;
                }
            });
            
            if (scoreCount > 0) {
                Object.keys(avgScores).forEach(key => {
                    avgScores[key] = (avgScores[key] / scoreCount).toFixed(1);
                });
            }
            
            container.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
                        <div class="text-sm text-blue-600 font-medium">ì´ í•™ìƒ ìˆ˜</div>
                        <div class="text-3xl font-bold text-blue-700 mt-2">${totalStudents}ëª…</div>
                    </div>
                    <div class="bg-green-50 p-4 rounded-lg border border-green-200">
                        <div class="text-sm text-green-600 font-medium">ê°ìƒí•œ ì•…ê³¡ ìˆ˜</div>
                        <div class="text-3xl font-bold text-green-700 mt-2">${uniqueMusics}ê³¡</div>
                    </div>
                    <div class="bg-purple-50 p-4 rounded-lg border border-purple-200">
                        <div class="text-sm text-purple-600 font-medium">í‰ê·  ê°ê°ì  ë¯¼ê°ë„</div>
                        <div class="text-3xl font-bold text-purple-700 mt-2">${avgScores.sense}ì </div>
                    </div>
                </div>
            `;
        }

        // 4. í•™ìƒ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        async function fetchStudentsData(filters = {}) {
            try {
                let url = `${API_BASE_URL}/api/students-data`;
                const params = new URLSearchParams();
                
                if (filters.title) params.append('title', filters.title);
                if (filters.composer) params.append('composer', filters.composer);
                if (filters.limit) params.append('limit', filters.limit);
                
                if (params.toString()) {
                    url += '?' + params.toString();
                }
                
                const response = await fetch(url, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    cache: 'no-cache'
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data.success) {
                    return data.students || [];
                } else {
                    console.error('ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:', data.error);
                    return [];
                }
            } catch (error) {
                // ì˜¤ë¥˜ë¥¼ í•œ ë²ˆë§Œ ë¡œê·¸ë¡œ ì¶œë ¥
                if (!window._fetchErrorLogged) {
                    console.error('í•™ìƒ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:', error.message);
                    window._fetchErrorLogged = true;
                    setTimeout(() => { window._fetchErrorLogged = false; }, 5000); // 5ì´ˆ í›„ ë¦¬ì…‹
                }
                return [];
            }
        }

        // 5. ë¹„êµ í˜ì´ì§€ ë Œë”ë§
        function renderComparisonPage() {
            return `
                <div class="space-y-6">
                    <h2 class="text-2xl font-bold text-indigo-700 flex items-center">
                        ${icons.BarChart(24)}
                        <span class="ml-2">ğŸ“Š ê°ê°ì  ê°ìƒ ë¹„êµ ë¶„ì„</span>
                    </h2>
                    
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center gap-2">
                                <span class="text-2xl">ğŸ’¡</span>
                                <div>
                                    <p class="text-sm font-semibold text-blue-800">ì‹¤ì‹œê°„ ë°ì´í„° ì—…ë°ì´íŠ¸</p>
                                    <p class="text-xs text-blue-600">í•™ìƒë“¤ì´ ì™„ë£Œ ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ìë™ìœ¼ë¡œ ë°ì´í„°ê°€ ìˆ˜ì§‘ë©ë‹ˆë‹¤. ìƒˆë¡œê³ ì¹¨ ë²„íŠ¼ì„ ëˆŒëŸ¬ ìµœì‹  ë°ì´í„°ë¥¼ í™•ì¸í•˜ì„¸ìš”.</p>
                                </div>
                            </div>
                            <button onclick="refreshComparison()" 
                                    class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors text-sm font-semibold shadow-md">
                                ğŸ”„ ìƒˆë¡œê³ ì¹¨
                            </button>
                        </div>
                    </div>
                    
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-xl font-semibold text-gray-700">í‚¤ì›Œë“œ í´ë¼ìš°ë“œ</h3>
                            <span class="text-sm text-gray-500" id="data-count-info">ë¡œë”© ì¤‘...</span>
                        </div>
                        <div id="keyword-cloud-container" class="w-full flex justify-center items-center bg-gray-50 p-4 rounded-lg min-h-[500px]"></div>
                    </div>
                    
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h3 class="text-xl font-semibold text-gray-700 mb-4">ìƒ‰ìƒ ë¶„í¬</h3>
                        <div id="color-distribution-container"></div>
                    </div>
                    
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <h3 class="text-xl font-semibold text-gray-700 mb-4">í†µê³„ ìš”ì•½</h3>
                        <div id="statistics-container"></div>
                    </div>
                </div>
            `;
        }

        // 6. ë¹„êµ í˜ì´ì§€ ì´ˆê¸°í™”
        async function initComparisonPage() {
            // ì¤‘ë³µ í˜¸ì¶œ ë°©ì§€
            if (state.loading || state.comparisonPageInitialized) {
                console.log('ì´ë¯¸ ì´ˆê¸°í™” ì¤‘ì´ê±°ë‚˜ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ì¤‘ë³µ í˜¸ì¶œì„ ê±´ë„ˆëœë‹ˆë‹¤.');
                return;
            }
            
            state.loading = true;
            state.comparisonPageInitialized = true; // ì´ˆê¸°í™” ì‹œì‘ í‘œì‹œ
            
            // render() í˜¸ì¶œí•˜ì§€ ì•Šê³  ì§ì ‘ DOM ì—…ë°ì´íŠ¸
            const container = document.getElementById('keyword-cloud-container');
            if (container) {
                container.innerHTML = '<p class="text-gray-500 text-center py-8">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>';
            }
            
            const studentsData = await fetchStudentsData();
            
            if (studentsData.length === 0) {
                // ë°ì´í„°ê°€ ì—†ì„ ë•Œ ë” ëª…í™•í•œ ì•ˆë‚´ ë©”ì‹œì§€
                const container = document.getElementById('keyword-cloud-container');
                if (container) {
                    container.innerHTML = `
                        <div class="w-full text-center py-12">
                            <div class="text-6xl mb-4">ğŸ“­</div>
                            <h3 class="text-xl font-semibold text-gray-700 mb-2">ì•„ì§ ì œì¶œëœ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤</h3>
                            <p class="text-gray-500 mb-4">
                                í•™ìƒë“¤ì´ ê°ìƒë¬¸ì„ ì‘ì„±í•˜ê³  <strong>ì™„ë£Œ ë²„íŠ¼</strong>ì„ ëˆŒëŸ¬ì•¼<br>
                                ë¹„êµ ë¶„ì„ ë°ì´í„°ê°€ ìˆ˜ì§‘ë©ë‹ˆë‹¤.
                            </p>
                            <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 text-left max-w-md mx-auto text-sm text-gray-700">
                                <p class="font-semibold mb-2">ğŸ“‹ ë°ì´í„° ìˆ˜ì§‘ ë°©ë²•:</p>
                                <ol class="list-decimal list-inside space-y-1">
                                    <li>í•™ìƒì´ 1~3ë‹¨ê³„ ê°ìƒ ì…ë ¥</li>
                                    <li>AI ì§„ë‹¨ ë° ë³´ì™„ ë‚´ìš© ì…ë ¥</li>
                                    <li>ìµœì¢… ê°ìƒë¬¸ ì™„ì„±</li>
                                    <li><strong>ì™„ë£Œ ë²„íŠ¼ í´ë¦­</strong> â† ì´ ë‹¨ê³„ì—ì„œ ë°ì´í„° ì €ì¥</li>
                                </ol>
                            </div>
                            <button onclick="refreshComparison()" 
                                    class="mt-6 px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors font-semibold">
                                ğŸ”„ ìƒˆë¡œê³ ì¹¨
                            </button>
                        </div>
                    `;
                }
                
                const colorContainer = document.getElementById('color-distribution-container');
                if (colorContainer) {
                    colorContainer.innerHTML = '<p class="text-gray-500 text-center py-8">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                }
                
                const statsContainer = document.getElementById('statistics-container');
                if (statsContainer) {
                    statsContainer.innerHTML = '<p class="text-gray-500 text-center py-8">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                }
                
                state.loading = false;
                state.comparisonPageInitialized = false; // ì‹¤íŒ¨ ì‹œ í”Œë˜ê·¸ ë¦¬ì…‹
                return;
            }
            
            createKeywordCloud(studentsData, 'keyword-cloud-container');
            createColorDistribution(studentsData, 'color-distribution-container');
            createStatistics(studentsData, 'statistics-container');
            
            // ë°ì´í„° ê°œìˆ˜ í‘œì‹œ ì—…ë°ì´íŠ¸
            const countInfo = document.getElementById('data-count-info');
            if (countInfo) {
                countInfo.textContent = `ì´ ${studentsData.length}ëª…ì˜ ë°ì´í„°`;
            }
            
            state.loading = false;
            // render() í˜¸ì¶œí•˜ì§€ ì•ŠìŒ - ë¬´í•œ ë£¨í”„ ë°©ì§€
        }

        // 7. ìƒˆë¡œê³ ì¹¨ í•¨ìˆ˜
        async function refreshComparison() {
            if (state.loading) {
                console.log('ì´ë¯¸ ë¡œë”© ì¤‘ì…ë‹ˆë‹¤. ìƒˆë¡œê³ ì¹¨ì„ ê±´ë„ˆëœë‹ˆë‹¤.');
                return;
            }
            await initComparisonPage();
        }

        function renderPage5() {
            // Initialize radar chart after render
            setTimeout(() => initRadarChart('radar-chart-container'), 100);

            return `
                <div class="space-y-6">
                    <h2 class="text-2xl font-bold text-indigo-700 flex items-center">
                        ${icons.Feather(24)}
                        <span class="ml-2">ìµœì¢… ê°ìƒ ë³´ê³ ì„œ ë° í™œìš© ì „ëµ</span>
                    </h2>

                    <h3 class="text-xl font-semibold text-gray-700">1. ê°ìƒ ëŠ¥ë ¥ ì§€í‘œ ì‹œê°í™” (AI ë¶„ì„ ê²°ê³¼)</h3>
                    <div id="radar-chart-container" class="w-full flex justify-center items-center bg-white p-4 rounded-xl shadow-lg border border-indigo-200"></div>
                    
                    <div class="grid grid-cols-5 gap-2 text-center text-xs font-semibold text-gray-700 bg-gray-100 p-2 rounded-lg">
                        <div class="flex flex-col items-center justify-center">
                            ${icons.Eye(14)}
                            <span class="mt-1">ê°ê°ì <br>ë¯¼ê°ë„</span>
                            <span class="text-indigo-600 font-bold">${state.appData.scores[0]}ì </span>
                        </div>
                        <div class="flex flex-col items-center justify-center">
                            ${icons.Gauge(14)}
                            <span class="mt-1">ê¸°ìˆ ì <br>ì •í™•ë„</span>
                            <span class="text-indigo-600 font-bold">${state.appData.scores[1]}ì </span>
                        </div>
                        <div class="flex flex-col items-center justify-center">
                            ${icons.BarChart(14)}
                            <span class="mt-1">ë¶„ì„ì <br>ì´í•´ë„</span>
                            <span class="text-indigo-600 font-bold">${state.appData.scores[2]}ì </span>
                        </div>
                        <div class="flex flex-col items-center justify-center">
                            ${icons.MessageCircle(14)}
                            <span class="mt-1">ë…¼ë¦¬ì <br>ì¼ê´€ì„±</span>
                            <span class="text-indigo-600 font-bold">${state.appData.scores[3]}ì </span>
                        </div>
                        <div class="flex flex-col items-center justify-center">
                            ${icons.Lightbulb(14)}
                            <span class="mt-1">ì‹¬ë¯¸ì <br>í†µì°°ë ¥</span>
                            <span class="text-indigo-600 font-bold">${state.appData.scores[4]}ì </span>
                        </div>
                    </div>

                    <div class="space-y-4">
                        <h3 class="text-xl font-semibold text-indigo-600">2. ê°ìƒë¬¸ ë¹„êµ</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="bg-white p-4 rounded-lg shadow-md border border-indigo-200">
                                <h4 class="font-bold text-lg text-indigo-600 mb-2">ğŸ“ í•™ìƒì˜ ë³´ì™„ëœ ìµœì¢… ê°ìƒë¬¸</h4>
                                <div class="prose text-gray-800 text-sm whitespace-pre-wrap max-h-96 overflow-y-auto">
                                    ${state.appData.finalAppreciation || "ìµœì¢… ê°ìƒë¬¸ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆê±°ë‚˜ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤."}
                                </div>
                            </div>
                            <div class="bg-white p-4 rounded-lg shadow-md border border-green-200">
                                <h4 class="font-bold text-lg text-green-600 mb-2">â­ ëª¨ë²” ê°ìƒë¬¸ ì˜ˆì‹œ</h4>
                                <div class="prose text-gray-800 text-sm whitespace-pre-wrap max-h-96 overflow-y-auto bg-green-50 p-3 rounded">
                                    ${state.appData.feedback.modelAppreciation || "ëª¨ë²” ê°ìƒë¬¸ì´ ìƒì„±ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤."}
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="space-y-3 bg-white p-4 rounded-lg shadow-md border border-green-200">
                        <h3 class="text-xl font-semibold text-green-600">3. ë¯¸ë˜ í™œë™ ì—°ê³„ í™œìš© ì „ëµ</h3>
                        <div class="text-sm space-y-2">
                            <p><strong class="text-blue-700">â–¶ ì—°ì£¼ ì „ëµ:</strong> ${state.appData.strategy.performance}</p>
                            <p><strong class="text-blue-700">â–¶ ê°ìƒ ì „ëµ:</strong> ${state.appData.strategy.appreciation}</p>
                            <p><strong class="text-blue-700">â–¶ ì°½ì‘ ì „ëµ:</strong> ${state.appData.strategy.composition}</p>
                        </div>
                    </div>
                    
                    <div class="text-center mt-6">
                        <button onclick="state.page = 6; render();" 
                                class="px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors font-semibold shadow-lg">
                            ğŸ“Š ì „ì²´ ë¹„êµ ë¶„ì„ ë³´ê¸°
                        </button>
                    </div>
                </div>
            `;
        }

        function renderFooter() {
            const buttonText = state.loading ? "AI ë¶„ì„ ì¤‘..." : 
                state.page === 1 || state.page === 2 ? "ë‹¤ìŒ ë‹¨ê³„ë¡œ ì´ë™" :
                state.page === 3 ? "AI ì§„ë‹¨ ì‹œì‘" :
                state.page === 4 ? "ìµœì¢… ê°ìƒë¬¸ ì™„ì„±" :
                "ì™„ë£Œ";
            
            const disabled = state.loading || state.page === 6;
            const buttonClass = disabled 
                ? 'bg-gray-400' 
                : 'bg-indigo-600 hover:bg-indigo-700 shadow-xl';

            return `
                <footer class="fixed bottom-0 left-0 right-0 max-w-4xl mx-auto bg-white p-4 border-t shadow-2xl">
                    <button onclick="handleNext()" ${disabled ? 'disabled' : ''} 
                        class="w-full py-3 px-4 rounded-lg font-bold text-white transition-colors duration-300 ${buttonClass}">
                        ${buttonText}
                    </button>
                </footer>
            `;
        }

        function renderModal() {
            if (!state.showErrorModal) return '';
            
            return `
                <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                    <div class="bg-white p-6 rounded-xl shadow-2xl max-w-sm w-full space-y-4">
                        <h3 class="text-xl font-bold text-red-600 flex items-center">
                            ${icons.X(20)}
                            <span class="ml-2">ì˜¤ë¥˜ ë°œìƒ</span>
                        </h3>
                        <p class="text-gray-700">${state.errorMessage}</p>
                        <button onclick="closeModal()" 
                            class="w-full py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors">
                            ë‹«ê¸°
                        </button>
                    </div>
                </div>
            `;
        }

        // =========================
        // Main Render Function
        // =========================
        function render() {
            const pageContent = 
                state.page === 1 ? renderPage1() :
                state.page === 2 ? renderPage2() :
                state.page === 3 ? renderPage3() :
                state.page === 4 ? renderPage4() :
                state.page === 5 ? renderPage5() :
                state.page === 6 ? renderComparisonPage() :
                '<div>ì•Œ ìˆ˜ ì—†ëŠ” í˜ì´ì§€</div>';
            
            // Page 6 ì´ˆê¸°í™” (í•œ ë²ˆë§Œ ì‹¤í–‰)
            if (state.page === 6 && !state.comparisonPageInitialized) {
                // í˜ì´ì§€ê°€ 6ìœ¼ë¡œ ë³€ê²½ë˜ì—ˆê³  ì•„ì§ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ì„ ë•Œë§Œ ì‹¤í–‰
                setTimeout(() => initComparisonPage(), 100);
            } else if (state.page !== 6) {
                // ë‹¤ë¥¸ í˜ì´ì§€ë¡œ ì´ë™í•˜ë©´ ì´ˆê¸°í™” í”Œë˜ê·¸ ë¦¬ì…‹
                state.comparisonPageInitialized = false;
            }

            const html = `
                <div class="max-w-4xl mx-auto p-4 sm:p-6 bg-gray-50 rounded-xl shadow-2xl min-h-screen">
                    ${renderHeader()}
                    ${renderStepIndicator()}
                    <div class="mt-4 pb-24">
                        ${pageContent}
                    </div>
                    ${renderFooter()}
                    ${renderModal()}
                </div>
            `;

            document.getElementById('app').innerHTML = html;
        }

        // =========================
        // Event Handlers (Global)
        // =========================
        function updateField(field, value) {
            state.appData[field] = value;
        }

        function toggleKeyword(keyword) {
            const idx = state.appData.senseKeywords.indexOf(keyword);
            if (idx > -1) {
                state.appData.senseKeywords.splice(idx, 1);
            } else {
                if (state.appData.senseKeywords.length < 3) {
                    state.appData.senseKeywords.push(keyword);
                }
            }
            render();
        }

        function toggleColor(colorValue) {
            const idx = state.appData.senseColors.indexOf(colorValue);
            if (idx > -1) {
                // ì´ë¯¸ ì„ íƒëœ ìƒ‰ìƒì´ë©´ ì œê±°
                state.appData.senseColors.splice(idx, 1);
            } else {
                // ìµœëŒ€ 4ê°œê¹Œì§€ ì„ íƒ ê°€ëŠ¥
                if (state.appData.senseColors.length < 4) {
                    state.appData.senseColors.push(colorValue);
                }
            }
            render();
        }

        // =========================
        // User ID ìƒì„±
        // =========================
        function generateUserId() {
            // ê°„ë‹¨í•œ ê³ ìœ  ID ìƒì„± (íƒ€ì„ìŠ¤íƒ¬í”„ + ëœë¤)
            return 'user_' + Date.now() + '_' + Math.random().toString(36).substring(2, 9);
        }

        // =========================
        // App Initialization
        // =========================
        window.addEventListener('DOMContentLoaded', () => {
            // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ì‚¬ìš©ì ID ë¶ˆëŸ¬ì˜¤ê¸° ë˜ëŠ” ìƒì„±
            const storedUserId = localStorage.getItem('melodymind_userId');
            if (storedUserId) {
                state.userId = storedUserId;
            } else {
                state.userId = generateUserId();
                localStorage.setItem('melodymind_userId', state.userId);
            }
            
            console.log(`ğŸµ ì‚¬ìš©ì ID: ${state.userId}`);
            render();
        });
    </script>
</body>
</html>
